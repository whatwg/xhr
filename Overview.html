<!DOCTYPE html><html lang="en-US"><meta charset="utf-8">
<meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport">
<meta content="#3c790a" name="theme-color">
<title>XMLHttpRequest Standard</title>
<link href="https://resources.whatwg.org/standard.css" rel="stylesheet">
<link href="https://resources.whatwg.org/logo-xhr.svg" rel="icon">

<div class="head">

<p><a class="logo" href="https://whatwg.org/"><img alt="WHATWG" height="100" src="https://resources.whatwg.org/logo-xhr.svg" width="100"></a>
<h1 id="xmlhttprequest-ls">XMLHttpRequest</h1>
<h2 class="no-num no-toc" id="living-standard-—-last-updated-15-september-2016">Living Standard — Last Updated 15 September 2016</h2>

<dl>
 <dt>Participate:
 <dd><a href="https://github.com/whatwg/xhr">GitHub whatwg/xhr</a>
 (<a href="https://github.com/whatwg/xhr/issues/new">file an issue</a>,
 <a href="https://github.com/whatwg/xhr/issues">open issues</a>,
 <a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WebAppsWG&amp;component=XHR&amp;resolution=---">legacy open bugs</a>)
 <dd><a href="https://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Commits:
 <dd><a href="https://github.com/whatwg/xhr/commits">GitHub whatwg/xhr/commits</a>
 <dd><a href="https://twitter.com/xhrstandard">@xhrstandard</a>

 <dt id="xmlhttprequest-tests">Tests:
 <dd><a href="https://w3c-test.org/XMLHttpRequest/">XMLHttpRequest tests</a> are hosted in
  the <a href="https://github.com/w3c/web-platform-tests/">W3C Web platform testsuite</a>
  — contributions welcome!

 <dt>Translation <small>(non-normative)</small>:
 <dd title="Japanese"><a href="https://triple-underscore.github.io/XHR-ja.html" hreflang="ja" lang="ja">日本語</a>
</dl>

<script async="" src="https://resources.whatwg.org/file-issue.js"></script>
<script async="" src="annotate_spec.js"></script>
<script defer="" id="head" src="https://resources.whatwg.org/dfn.js"></script>

</div>



<h2 class="no-num no-toc" id="specabstract">Abstract</h2>

<p>XMLHttpRequest defines an API that provides scripted client functionality for
transferring data between a client and a server.



<h2 class="no-num no-toc" id="toc">Table of Contents</h2>


<!--begin-toc-->
<ol class="toc">
 <li><a href="#introduction"><span class="secno">1 </span>Introduction</a>
  <ol>
   <li><a href="#specification-history"><span class="secno">1.1 </span>Specification history</a></ol></li>
 <li><a href="#conformance"><span class="secno">2 </span>Conformance</a>
  <ol>
   <li><a href="#extensibility"><span class="secno">2.1 </span>Extensibility</a></ol></li>
 <li><a href="#terminology"><span class="secno">3 </span>Terminology</a></li>
 <li><a href="#interface-xmlhttprequest"><span class="secno">4 </span>Interface <code title="">XMLHttpRequest</code></a>
  <ol>
   <li><a href="#constructors"><span class="secno">4.1 </span>Constructors</a></li>
   <li><a href="#garbage-collection"><span class="secno">4.2 </span>Garbage collection</a></li>
   <li><a href="#event-handlers"><span class="secno">4.3 </span>Event handlers</a></li>
   <li><a href="#states"><span class="secno">4.4 </span>States</a></li>
   <li><a href="#request"><span class="secno">4.5 </span>Request</a>
    <ol>
     <li><a href="#the-open()-method"><span class="secno">4.5.1 </span>The <code title="">open()</code> method</a></li>
     <li><a href="#the-setrequestheader()-method"><span class="secno">4.5.2 </span>The <code title="">setRequestHeader()</code> method</a></li>
     <li><a href="#the-timeout-attribute"><span class="secno">4.5.3 </span>The <code title="">timeout</code> attribute</a></li>
     <li><a href="#the-withcredentials-attribute"><span class="secno">4.5.4 </span>The <code title="">withCredentials</code> attribute</a></li>
     <li><a href="#the-upload-attribute"><span class="secno">4.5.5 </span>The <code title="">upload</code> attribute</a></li>
     <li><a href="#the-send()-method"><span class="secno">4.5.6 </span>The <code title="">send()</code> method</a></li>
     <li><a href="#the-abort()-method"><span class="secno">4.5.7 </span>The <code title="">abort()</code> method</a></ol></li>
   <li><a href="#xmlhttprequest-response"><span class="secno">4.6 </span>Response</a>
    <ol>
     <li><a href="#the-responseurl-attribute"><span class="secno">4.6.1 </span>The <code title="">responseURL</code> attribute</a></li>
     <li><a href="#the-status-attribute"><span class="secno">4.6.2 </span>The <code title="">status</code> attribute</a></li>
     <li><a href="#the-statustext-attribute"><span class="secno">4.6.3 </span>The <code title="">statusText</code> attribute</a></li>
     <li><a href="#the-getresponseheader()-method"><span class="secno">4.6.4 </span>The <code title="">getResponseHeader()</code> method</a></li>
     <li><a href="#the-getallresponseheaders()-method"><span class="secno">4.6.5 </span>The <code title="">getAllResponseHeaders()</code> method</a></li>
     <li><a href="#response-body"><span class="secno">4.6.6 </span>Response body</a></li>
     <li><a href="#the-overridemimetype()-method"><span class="secno">4.6.7 </span>The <code title="">overrideMimeType()</code> method</a></li>
     <li><a href="#the-responsetype-attribute"><span class="secno">4.6.8 </span>The <code title="">responseType</code> attribute</a></li>
     <li><a href="#the-response-attribute"><span class="secno">4.6.9 </span>The <code title="">response</code> attribute</a></li>
     <li><a href="#the-responsetext-attribute"><span class="secno">4.6.10 </span>The <code title="">responseText</code> attribute</a></li>
     <li><a href="#the-responsexml-attribute"><span class="secno">4.6.11 </span>The <code title="">responseXML</code> attribute</a></ol></li>
   <li><a href="#events"><span class="secno">4.7 </span>Events summary</a></ol></li>
 <li><a href="#interface-formdata"><span class="secno">5 </span>Interface <code title="">FormData</code></a></li>
 <li><a href="#interface-progressevent"><span class="secno">6 </span>Interface <code title="">ProgressEvent</code></a>
  <ol>
   <li><a href="#firing-events-using-the-progressevent-interface"><span class="secno">6.1 </span>Firing events using the <code title="">ProgressEvent</code> interface</a></li>
   <li><a href="#suggested-names-for-events-using-the-progressevent-interface"><span class="secno">6.2 </span>Suggested names for events using the <code title="">ProgressEvent</code> interface</a></li>
   <li><a href="#security-considerations"><span class="secno">6.3 </span>Security Considerations</a></li>
   <li><a href="#example"><span class="secno">6.4 </span>Example</a></ol></li>
 <li><a class="no-num" href="#references">References</a></li>
 <li><a class="no-num" href="#acknowledgments">Acknowledgments</a></ol>
<!--end-toc-->



<h2 id="introduction"><span class="secno">1 </span>Introduction</h2>

<p><em>This section is non-normative.</em>

<p>The <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object is an API for
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetching</a> resources.

<p>The name <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> is historical and has no bearing on its
functionality.

<div class="example">
 <p>Some simple code to do something with data from an XML document
 fetched over the network:

 <pre><code>function processData(data) {
  // taking care of data
}

function handler() {
  if(this.status == 200 &amp;&amp;
    this.responseXML != null &amp;&amp;
    this.responseXML.getElementById('test').textContent) {
    // success!
    processData(this.responseXML.getElementById('test').textContent);
  } else {
    // something went wrong
    …
  }
}

var client = new XMLHttpRequest();
client.onload = handler;
client.open("GET", "unicorn.xml");
client.send();</code></pre>

 <p>If you just want to log a message to the server:

 <pre><code>function log(message) {
  var client = new XMLHttpRequest();
  client.open("POST", "/log");
  client.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
  client.send(message);
}</code></pre>

 <p>Or if you want to check the status of a document on the server:

 <pre><code>function fetchStatus(address) {
  var client = new XMLHttpRequest();
  client.onload = function() {
    // in case of network errors this might not give reliable results
    returnStatus(this.status);
  }
  client.open("HEAD", address);
  client.send();
}</code></pre>
</div>


<h3 id="specification-history"><span class="secno">1.1 </span>Specification history</h3>

<p>The <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object was initially defined as part of
the WHATWG's HTML effort. (Based on Microsoft's implementation many years prior.)
It moved to the W3C in 2006. Extensions (e.g. progress events and
cross-origin requests) to <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> were developed in a
separate draft (XMLHttpRequest Level 2) until end of 2011, at which point
the two drafts were merged and <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> became a single
entity again from a standards perspective. End of 2012 it moved back to the
WHATWG.

<p>Discussion that led to the current draft can be found in the following mailing list
archives:

<ul class="brief">
 <li><a href="https://lists.w3.org/Archives/Public/public-whatwg-archive/">whatwg@whatwg.org</a>
 <li><a href="https://lists.w3.org/Archives/Public/public-webapps/">public-webapps@w3.org</a>
 <li><a href="https://lists.w3.org/Archives/Public/public-webapi/">public-webapi@w3.org</a>
 <li><a href="https://lists.w3.org/Archives/Public/public-appformats/">public-appformats@w3.org</a>
</ul>



<h2 id="conformance"><span class="secno">2 </span>Conformance</h2>

<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<a href="#refsRFC2119">[RFC2119]</a>


<h3 id="extensibility"><span class="secno">2.1 </span>Extensibility</h3>

<p>User agents, Working Groups, and other interested parties are
<em>strongly encouraged</em> to discuss new features with the WHATWG
community.



<h2 id="terminology"><span class="secno">3 </span>Terminology</h2>

<p>This specification uses terminology, cross-linked throughout, from DOM,
DOM Parsing and Serialization, Encoding, Fetch, File API, HTML, HTTP, URL, Web IDL, and
XML.

<a href="#refsDOM">[DOM]</a>
<a href="#refsDOMPS">[DOMPS]</a>
<a href="#refsENCODING">[ENCODING]</a>
<a href="#refsFETCH">[FETCH]</a>
<a href="#refsFILEAPI">[FILEAPI]</a>
<a href="#refsHTML">[HTML]</a>
<a href="#refsHTTP">[HTTP]</a>
<a href="#refsURL">[URL]</a>
<a href="#refsWEBIDL">[WEBIDL]</a>
<a href="#refsXML">[XML]</a> <a href="#refsXMLNS">[XMLNS]</a>

<p>It uses the typographic conventions from HTML. <a href="#refsHTML">[HTML]</a>

<p>The term <dfn id="user-credentials">user credentials</dfn> for the purposes of this
specification means cookies, HTTP authentication, and TLS client certificates.
Specifically it does not refer to proxy authentication or the
<code title="http-origin">Origin</code> header.
<a href="#refsCOOKIES">[COOKIES]</a> <!-- XXX ref? -->



<h2 id="interface-xmlhttprequest"><span class="secno">4 </span>Interface <code title="">XMLHttpRequest</code></h2>

<pre class="idl">[Exposed=(Window,DedicatedWorker,SharedWorker)]
interface <dfn id="xmlhttprequesteventtarget">XMLHttpRequestEventTarget</dfn> : <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a> {
  // <a href="#event-handlers">event handlers</a>
  attribute <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-xhr-onloadstart" title="handler-xhr-onloadstart">onloadstart</a>;
  attribute <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-xhr-onprogress" title="handler-xhr-onprogress">onprogress</a>;
  attribute <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-xhr-onabort" title="handler-xhr-onabort">onabort</a>;
  attribute <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-xhr-onerror" title="handler-xhr-onerror">onerror</a>;
  attribute <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-xhr-onload" title="handler-xhr-onload">onload</a>;
  attribute <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-xhr-ontimeout" title="handler-xhr-ontimeout">ontimeout</a>;
  attribute <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-xhr-onloadend" title="handler-xhr-onloadend">onloadend</a>;
};

[Exposed=(Window,DedicatedWorker,SharedWorker)]
interface <dfn id="xmlhttprequestupload">XMLHttpRequestUpload</dfn> : <a href="#xmlhttprequesteventtarget">XMLHttpRequestEventTarget</a> {
};

enum <dfn id="xmlhttprequestresponsetype">XMLHttpRequestResponseType</dfn> {
  "",
  "arraybuffer",
  "blob",
  "document",
  "json",
  "text"
};

[<a href="#dom-xmlhttprequest" title="dom-XMLHttpRequest">Constructor</a>,
 Exposed=(Window,DedicatedWorker,SharedWorker)]
interface <dfn id="xmlhttprequest">XMLHttpRequest</dfn> : <a href="#xmlhttprequesteventtarget">XMLHttpRequestEventTarget</a> {
  // <a href="#event-handlers">event handler</a>
  attribute <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a> <a href="#handler-xhr-onreadystatechange" title="handler-xhr-onreadystatechange">onreadystatechange</a>;

  // <a href="#states">states</a>
  const unsigned short <a href="#dom-xmlhttprequest-unsent" title="dom-XMLHttpRequest-UNSENT">UNSENT</a> = 0;
  const unsigned short <a href="#dom-xmlhttprequest-opened" title="dom-XMLHttpRequest-OPENED">OPENED</a> = 1;
  const unsigned short <a href="#dom-xmlhttprequest-headers_received" title="dom-XMLHttpRequest-HEADERS_RECEIVED">HEADERS_RECEIVED</a> = 2;
  const unsigned short <a href="#dom-xmlhttprequest-loading" title="dom-XMLHttpRequest-LOADING">LOADING</a> = 3;
  const unsigned short <a href="#dom-xmlhttprequest-done" title="dom-XMLHttpRequest-DONE">DONE</a> = 4;
  readonly attribute unsigned short <a href="#dom-xmlhttprequest-readystate" title="dom-XMLHttpRequest-readyState">readyState</a>;

  // <a href="#request">request</a>
  void <a href="#dom-xmlhttprequest-open" title="dom-XMLHttpRequest-open">open</a>(ByteString <var>method</var>, USVString <var title="">url</var>);
  void <a href="#dom-xmlhttprequest-open" title="dom-XMLHttpRequest-open">open</a>(ByteString <var>method</var>, USVString <var title="">url</var>, boolean <var>async</var>, optional USVString? <var>username</var> = null, optional USVString? <var>password</var> = null);
  void <a href="#dom-xmlhttprequest-setrequestheader" title="dom-XMLHttpRequest-setRequestHeader">setRequestHeader</a>(ByteString <var>name</var>, ByteString <var>value</var>);
           attribute unsigned long <a href="#dom-xmlhttprequest-timeout" title="dom-XMLHttpRequest-timeout">timeout</a>;
           attribute boolean <a href="#dom-xmlhttprequest-withcredentials" title="dom-XMLHttpRequest-withCredentials">withCredentials</a>;
  readonly attribute <a href="#xmlhttprequestupload">XMLHttpRequestUpload</a> <a href="#dom-xmlhttprequest-upload" title="dom-XMLHttpRequest-upload">upload</a>;
  void <a href="#dom-xmlhttprequest-send" title="dom-XMLHttpRequest-send">send</a>(optional (<a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#document">Document</a> or <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#bodyinit">BodyInit</a>)? <var>body</var> = null);
  void <a href="#dom-xmlhttprequest-abort" title="dom-XMLHttpRequest-abort">abort</a>();

  // <a href="#response">response</a>
  readonly attribute USVString <a href="#dom-xmlhttprequest-responseurl" title="dom-XMLHttpRequest-responseURL">responseURL</a>;
  readonly attribute unsigned short <a href="#dom-xmlhttprequest-status" title="dom-XMLHttpRequest-status">status</a>;
  readonly attribute ByteString <a href="#dom-xmlhttprequest-statustext" title="dom-XMLHttpRequest-statusText">statusText</a>;
  ByteString? <a href="#dom-xmlhttprequest-getresponseheader" title="dom-XMLHttpRequest-getResponseHeader">getResponseHeader</a>(ByteString <var>name</var>);
  ByteString <a href="#dom-xmlhttprequest-getallresponseheaders" title="dom-XMLHttpRequest-getAllResponseHeaders">getAllResponseHeaders</a>();
  void <a href="#dom-xmlhttprequest-overridemimetype" title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType</a>(DOMString <var>mime</var>);
           attribute <a href="#xmlhttprequestresponsetype">XMLHttpRequestResponseType</a> <a href="#dom-xmlhttprequest-responsetype" title="dom-XMLHttpRequest-responseType">responseType</a>;
  readonly attribute any <a href="#dom-xmlhttprequest-response" title="dom-XMLHttpRequest-response">response</a>;
  readonly attribute USVString <a href="#dom-xmlhttprequest-responsetext" title="dom-XMLHttpRequest-responseText">responseText</a>;
  [Exposed=Window] readonly attribute <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#document">Document</a>? <a href="#dom-xmlhttprequest-responsexml" title="dom-XMLHttpRequest-responseXML">responseXML</a>;
};</pre>

<p>An <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object has an associated
<a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object.

<p>An <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object has an associated
<dfn id="concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</dfn>, which is one of
<i title="">unsent</i>,
<i title="">opened</i>,
<i title="">headers received</i>,
<i title="">loading</i>, and
<i title="">done</i>. Unless stated otherwise it is <i title="">unsent</i>.

<p>An <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object has an associated
<dfn id="send-flag"><code>send()</code> flag</dfn>. Unless stated otherwise it is unset.

<p>An <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object has an associated <dfn id="stop-timeout-flag">stop timeout flag</dfn>.
Unless stated otherwise it is unset.


<h3 id="constructors"><span class="secno">4.1 </span>Constructors</h3>

<dl class="domintro">
 <dt><code><var title="">client</var> = new <a href="#dom-xmlhttprequest" title="dom-XMLHttpRequest">XMLHttpRequest</a>()</code>
 <dd>Returns a new <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object.
</dl>

<p>The <dfn id="dom-xmlhttprequest" title="dom-XMLHttpRequest"><code>XMLHttpRequest()</code></dfn> constructor, when
invoked, must return a new <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object.


<h3 id="garbage-collection"><span class="secno">4.2 </span>Garbage collection</h3>
<!-- Based on EventSource and WebSocket. Not sure what I am doing. -->

<p>An <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object must not be garbage collected if its
<a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is either
<i title="">opened</i> with the <a href="#send-flag"><code>send()</code> flag</a> set,
<i title="">headers received</i>, or <i title="">loading</i>, and it has one or more
<a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-listener" title="concept-event-listener">event listeners</a>
registered whose <b>type</b> is one of
<a href="#event-xhr-readystatechange"><code title="event-xhr-readystatechange">readystatechange</code></a>,
<a href="#event-xhr-progress"><code title="event-xhr-progress">progress</code></a>,
<a href="#event-xhr-abort"><code title="event-xhr-abort">abort</code></a>,
<a href="#event-xhr-error"><code title="event-xhr-error">error</code></a>,
<a href="#event-xhr-load"><code title="event-xhr-load">load</code></a>,
<a href="#event-xhr-timeout"><code title="event-xhr-timeout">timeout</code></a>, and
<a href="#event-xhr-loadend"><code title="event-xhr-loadend">loadend</code></a>.
<!-- No need to mention upload event listeners as they happen during /opened/. -->

<p>If an <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object is garbage collected while its
connection is still open, the user agent must <a href="#terminate-the-request">terminate the request</a>.


<h3 id="event-handlers"><span class="secno">4.3 </span>Event handlers</h3>

<p>The following are the
<a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers">event handlers</a> (and their corresponding
<a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" title="event handler event type">event handler event types</a>)
that must be supported on objects implementing an interface that inherits
from <a href="#xmlhttprequesteventtarget"><code>XMLHttpRequestEventTarget</code></a> as attributes:

<table>
 <thead>
  <tr>
   <th><a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" title="event handlers">event handler</a>
   <th><a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type">event handler event type</a>
 <tbody>
  <tr>
   <td><dfn id="handler-xhr-onloadstart" title="handler-xhr-onloadstart"><code>onloadstart</code></dfn>
   <td><a href="#event-xhr-loadstart"><code title="event-xhr-loadstart">loadstart</code></a>
  <tr>
   <td><dfn id="handler-xhr-onprogress" title="handler-xhr-onprogress"><code>onprogress</code></dfn>
   <td><a href="#event-xhr-progress"><code title="event-xhr-progress">progress</code></a>
  <tr>
   <td><dfn id="handler-xhr-onabort" title="handler-xhr-onabort"><code>onabort</code></dfn>
   <td><a href="#event-xhr-abort"><code title="event-xhr-abort">abort</code></a>
  <tr>
   <td><dfn id="handler-xhr-onerror" title="handler-xhr-onerror"><code>onerror</code></dfn>
   <td><a href="#event-xhr-error"><code title="event-xhr-error">error</code></a>
  <tr>
   <td><dfn id="handler-xhr-onload" title="handler-xhr-onload"><code>onload</code></dfn>
   <td><a href="#event-xhr-load"><code title="event-xhr-load">load</code></a>
  <tr>
   <td><dfn id="handler-xhr-ontimeout" title="handler-xhr-ontimeout"><code>ontimeout</code></dfn>
   <td><a href="#event-xhr-timeout"><code title="event-xhr-timeout">timeout</code></a>
  <tr>
   <td><dfn id="handler-xhr-onloadend" title="handler-xhr-onloadend"><code>onloadend</code></dfn>
   <td><a href="#event-xhr-loadend"><code title="event-xhr-loadend">loadend</code></a>
</table>

<p>The following is the
<a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" title="event handlers">event handler</a>
(and its corresponding
<a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type">event handler event type</a>) that must be
supported as attribute solely by the
<a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object:

<table>
 <thead>
  <tr>
   <th><a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" title="event handlers">event handler</a>
   <th><a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type">event handler event type</a>
 <tbody>
  <tr>
   <td><dfn id="handler-xhr-onreadystatechange" title="handler-xhr-onreadystatechange"><code>onreadystatechange</code></dfn>
   <td><a href="#event-xhr-readystatechange"><code title="event-xhr-readystatechange">readystatechange</code></a></td>
</table>


<h3 id="states"><span class="secno">4.4 </span>States</h3>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-readystate" title="dom-XMLHttpRequest-readyState">readyState</a></code>
 <dd><p>Returns <var title="">client</var>'s
 <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a>.
</dl>

<p>The <dfn id="dom-xmlhttprequest-readystate" title="dom-XMLHttpRequest-readyState"><code>readyState</code></dfn>
attribute's getter must return the value from the table below in the cell of the second
column, from the row where the value in the cell in the first column is
<a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#context-object">context object</a>'s
<a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a>:

<table>
 <tr>
  <td><i title="">unsent</i>
  <td><dfn id="dom-xmlhttprequest-unsent" title="dom-XMLHttpRequest-UNSENT"><code>UNSENT</code></dfn> (numeric value 0)
  <td>The object has been constructed.
 <tr>
  <td><i title="">opened</i>
  <td><dfn id="dom-xmlhttprequest-opened" title="dom-XMLHttpRequest-OPENED"><code>OPENED</code></dfn> (numeric value 1)
  <td>The <a href="#dom-xmlhttprequest-open"><code title="dom-XMLHttpRequest-open">open()</code></a> method has been successfully
   invoked. During this state request headers can be set using
   <a href="#dom-xmlhttprequest-setrequestheader"><code title="dom-XMLHttpRequest-setRequestHeader">setRequestHeader()</code></a> and the
   fetch can be initiated using the <a href="#dom-xmlhttprequest-send"><code title="dom-XMLHttpRequest-send">send()</code></a>
   method.
 <tr>
  <td><i title="">headers received</i>
  <td><dfn id="dom-xmlhttprequest-headers_received" title="dom-XMLHttpRequest-HEADERS_RECEIVED"><code>HEADERS_RECEIVED</code></dfn>
   (numeric value 2)
  <td>All redirects (if any) have been followed and all HTTP headers of the
   <a href="#response">response</a> have been received.
 <tr>
  <td><i title="">loading</i>
  <td><dfn id="dom-xmlhttprequest-loading" title="dom-XMLHttpRequest-LOADING"><code>LOADING</code></dfn> (numeric value 3)
  <td>The <a href="#response">response</a>'s
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a> is being received.
 <tr>
  <td><i title="">done</i>
  <td><dfn id="dom-xmlhttprequest-done" title="dom-XMLHttpRequest-DONE"><code>DONE</code></dfn> (numeric value 4)
  <td>The data transfer has been completed or something went wrong during the transfer
   (e.g. infinite redirects).
</table>


<h3 id="request"><span class="secno">4.5 </span>Request</h3>

<p>Each <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object has the following
request-associated concepts:

<dfn id="request-method">request method</dfn>,
<dfn id="request-url">request URL</dfn>,
<dfn id="author-request-headers">author request headers</dfn>,
<dfn id="request-body">request body</dfn>,
<dfn id="synchronous-flag">synchronous flag</dfn>,
<dfn id="upload-complete-flag">upload complete flag</dfn>, and
<dfn id="upload-listener-flag">upload listener flag</dfn>.

<p>The <a href="#author-request-headers">author request headers</a> is an initially empty
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-list" title="concept-header-list">header list</a>.

<p>The <a href="#request-body">request body</a> is initially null.

<p>The <a href="#synchronous-flag">synchronous flag</a>, <a href="#upload-complete-flag">upload complete flag</a>, and
<a href="#upload-listener-flag">upload listener flag</a> are initially unset.

<hr>

<p>To <dfn id="terminate-the-request">terminate the request</dfn>,
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch-terminate" title="concept-fetch-terminate">terminate</a> the
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetch</a> algorithm operated by the
<a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object with reason <i title="">fatal</i>.



<h4 id="the-open()-method"><span class="secno">4.5.1 </span>The <code title="">open()</code> method</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-open" title="dom-XMLHttpRequest-open">open</a>(<var title="">method</var>, <var title="">url</var> [, <var title="">async</var> = true [, <var title="">username</var> = null [, <var title="">password</var> = null]]])</code>

 <dd>
  <p>Sets the <a href="#request-method">request method</a>, <a href="#request-url">request URL</a>, and
  <a href="#synchronous-flag">synchronous flag</a>.

  <p>Throws a <code>SyntaxError</code> exception if
  either <var title="">method</var> is not a valid HTTP method or
  <var title="">url</var> cannot be parsed.

  <p>Throws a <code>SecurityError</code> exception
  if <var title="">method</var> is a case-insensitive match for
  `<code title="">CONNECT</code>`, `<code title="">TRACE</code>` or `<code title="">TRACK</code>`.

  <p>Throws an <code>InvalidAccessError</code> exception if <var title="">async</var> is false,
  <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
  <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is a <a href="https://html.spec.whatwg.org/multipage/browsers.html#window"><code class="external" data-anolis-spec="html">Window</code></a>
  object, and the <a href="#dom-xmlhttprequest-timeout"><code title="dom-XMLHttpRequest-timeout">timeout</code></a> attribute is not zero or the
  <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> attribute is not the empty string.
</dl>

<p class="critical no-backref" id="sync-warning">Synchronous <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a>
outside of workers is in the process of being removed from the web platform as it has
detrimental effects to the end user's experience. (This is a long process that takes many
years.) Developers must not pass false for the <var title="">async</var> argument when
<a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
<a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is a <a href="https://html.spec.whatwg.org/multipage/browsers.html#window"><code class="external" data-anolis-spec="html">Window</code></a>
object. User agents are strongly encouraged to warn about such usage in developer tools and may
experiment with <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throwing</a> an
<code>InvalidAccessError</code> exception when it occurs.

<p>The
<dfn id="dom-xmlhttprequest-open" title="dom-XMLHttpRequest-open"><code>open(<var title="">method</var>, <var title="">url</var>, <var title="">async</var>, <var title="">username</var>, <var title="">password</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>If <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#context-object">context object</a>'s
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a> has a
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document">responsible document</a> and it is <em>not</em>
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active">fully active</a>,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an <code>InvalidStateError</code> exception.

 <li><p>If <var>method</var> is not a
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-method" title="concept-method">method</a>,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> a
 <code>SyntaxError</code> exception.

 <li><p>If <var>method</var> is a <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#forbidden-method">forbidden method</a>,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> a
 <code>SecurityError</code> exception.

 <li><p><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-method-normalize" title="concept-method-normalize">Normalize</a>
 <var>method</var>.

 <li><p>Let <var title="">parsedURL</var> be the result of
 <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#concept-url-parser" title="concept-url-parser">parsing</a> <var title="">url</var> with
 <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#context-object">context object</a>'s
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a>'s
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url">API base URL</a>.

 <li><p>If <var title="">parsedURL</var> is failure,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> a
 <code>SyntaxError</code> exception.

 <li>
  <p>If the <var>async</var> argument is omitted, set <var>async</var> to true, and set
  <var title="">username</var> and <var title="">password</var> to null.

  <p class="note">Unfortunately legacy content prevents treating the <var>async</var>
  argument being <code title="">undefined</code> identical from it being omitted.

 <li>
  <p>If <var title="">parsedURL</var>'s <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#concept-url-host" title="concept-url-host">host</a>
  is non-null, run these substeps:

  <ol>
   <li><p>If the <var title="">username</var> argument is not null,
   <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#set-the-username">set the username</a> given <var title="">parsedURL</var> and
   <var>username</var>.

   <li><p>If the <var title="">password</var> argument is not null,
   <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#set-the-password">set the password</a> given <var title="">parsedURL</var> and
   <var>password</var>.
  </ol>

 <li><p>If <var>async</var> is false, <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is a <a href="https://html.spec.whatwg.org/multipage/browsers.html#window"><code class="external" data-anolis-spec="html">Window</code></a>
 object, and the <a href="#dom-xmlhttprequest-timeout"><code title="dom-XMLHttpRequest-timeout">timeout</code></a> attribute value is not zero
 or the <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> attribute value is not the
 empty string, then <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidAccessError</code> exception.

 <li>
  <p><a href="#terminate-the-request">Terminate the request</a>.

  <p class="note">A <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetch</a> can be
  ongoing at this point.
  <!-- also unsets the send() flag -->

 <li>
  <p>Set variables associated with the object as follows:

  <ul>
   <li><p>Unset the <a href="#stop-timeout-flag">stop timeout flag</a> and <a href="#upload-listener-flag">upload listener flag</a>.
   <li><p>Set <a href="#request-method">request method</a> to <var>method</var>.
   <li><p>Set <a href="#request-url">request URL</a> to <var title="">parsedURL</var>.
   <li><p>Set the <a href="#synchronous-flag">synchronous flag</a>, if <var>async</var> is false, and unset
   the <a href="#synchronous-flag">synchronous flag</a> otherwise.
   <li><p>Empty <a href="#author-request-headers">author request headers</a>.
   <li><p>Set <a href="#response">response</a> to a
   <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-network-error" title="concept-network-error">network error</a>.
   <li><p>Set <a href="#received-bytes">received bytes</a> to the empty byte sequence.
   <li><p>Set <a href="#response-arraybuffer-object">response <code>ArrayBuffer</code> object</a> to null.
   <li><p>Set <a href="#response-blob-object">response <code>Blob</code> object</a> to null.
   <li><p>Set <a href="#response-document-object">response <code>Document</code> object</a> to null.
   <li><p>Set <a href="#response-json-object">response JSON object</a> to null.
  </ul>

 <li>
  <p>If the <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not
  <i title="">opened</i>, run these substeps:

  <ol>
   <li><p>Set <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> to
   <i title="">opened</i>.

   <li><p><a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">Fire an event</a> named <a href="#event-xhr-readystatechange"><code title="event-xhr-readystatechange">readystatechange</code></a>.
  </ol>
</ol>



<h4 id="the-setrequestheader()-method"><span class="secno">4.5.2 </span>The <code title="">setRequestHeader()</code> method</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-setrequestheader" title="dom-XMLHttpRequest-setRequestHeader">setRequestHeader</a>(<var>name</var>, <var>value</var>)</code>

 <dd>
  <p>Combines a <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header" title="concept-header">header</a> in
  <a href="#author-request-headers">author request headers</a>.

  <p>Throws an <code>InvalidStateError</code>
  exception if either <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not
  <i title="">opened</i> or the <a href="#send-flag"><code>send()</code> flag</a> is set.

  <p>Throws a <code>SyntaxError</code> exception if
  <var>name</var> is not a header name or if <var>value</var> is not a header value.
 </dd>
</dl>

<p class="note">As indicated in the algorithm below certain headers cannot
be set and are left up to the user agent. In addition there are certain
other headers the user agent will take control of if they are not set by
the author as indicated at the end of the
<a href="#dom-xmlhttprequest-send"><code title="dom-XMLHttpRequest-send">send()</code></a> method section.

<p>The
<dfn id="dom-xmlhttprequest-setrequestheader" title="dom-XMLHttpRequest-setRequestHeader"><code>setRequestHeader(<var>name</var>, <var>value</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not
 <i title="">opened</i>, <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.

 <li><p>If the <a href="#send-flag"><code>send()</code> flag</a> is set,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.

 <li><p><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-value-normalize" title="concept-header-value-normalize">Normalize</a>
 <var>value</var>.

 <li>
  <p>If <var>name</var> is not a
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-name" title="concept-header-name">name</a> or <var>value</var>
  is not a <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-value" title="concept-header-value">value</a>,
  <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> a
  <code>SyntaxError</code> exception.

  <p class="note no-backref">An empty byte sequence represents an empty
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header" title="concept-header">header</a>
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-value" title="concept-header-value">value</a>.

 <li><p>Terminate these steps if <var>name</var> is a
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#forbidden-header-name">forbidden header name</a>.

 <li><p><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-list-combine" title="concept-header-list-combine">Combine</a>
 <var>name</var>/<var>value</var> in <a href="#author-request-headers">author request headers</a>.
</ol>

<div class="example">
 <p>Some simple code demonstrating what happens when setting the same
 header twice:

 <pre><code>// The following script:
var client = new XMLHttpRequest();
client.open('GET', 'demo.cgi');
client.setRequestHeader('X-Test', 'one');
client.setRequestHeader('X-Test', 'two');
client.send();

// …results in the following header being sent:
X-Test: one, two</code></pre>
</div>


<h4 id="the-timeout-attribute"><span class="secno">4.5.3 </span>The <code title="">timeout</code> attribute</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-timeout" title="dom-XMLHttpRequest-timeout">timeout</a></code>
 <dd>
  <p>Can be set to a time in milliseconds. When set to a non-zero value
  will cause <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetching</a> to
  terminate after the given time has passed. When the time has passed, the request has
  not yet completed, and the <a href="#synchronous-flag">synchronous flag</a> is unset, a
  <a href="#event-xhr-timeout"><code title="event-xhr-timeout">timeout</code></a> event will then be
  <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-dispatch" title="concept-event-dispatch">dispatched</a>,
  or a <code>TimeoutError</code> exception will be
  <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">thrown</a> otherwise
  (for the <a href="#dom-xmlhttprequest-send"><code title="dom-XMLHttpRequest-send">send()</code></a> method).
  <p>When set: throws an
  <code>InvalidAccessError</code> exception if
  the <a href="#synchronous-flag">synchronous flag</a> is set and
  <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
  <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is a <a href="https://html.spec.whatwg.org/multipage/browsers.html#window"><code class="external" data-anolis-spec="html">Window</code></a>
  object.
 </dd>
</dl>

<p>The
<dfn id="dom-xmlhttprequest-timeout" title="dom-XMLHttpRequest-timeout"><code>timeout</code></dfn>
attribute must return its value. Initially its value must be zero.

<p>Setting the <a href="#dom-xmlhttprequest-timeout"><code title="dom-XMLHttpRequest-timeout">timeout</code></a>
attribute must run these steps:

<ol>
 <li><p>If <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is a <a href="https://html.spec.whatwg.org/multipage/browsers.html#window"><code class="external" data-anolis-spec="html">Window</code></a>
 object and the <a href="#synchronous-flag">synchronous flag</a> is set,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidAccessError</code> exception.

 <li><p>Set its value to the new value.
</ol>

<p class="note">This implies that the
<a href="#dom-xmlhttprequest-timeout"><code title="dom-XMLHttpRequest-timeout">timeout</code></a> attribute can be
set while <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetching</a> is in
progress. If that occurs it will still be measured relative to the start
of <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetching</a>.


<h4 id="the-withcredentials-attribute"><span class="secno">4.5.4 </span>The <code title="">withCredentials</code> attribute</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-withcredentials" title="dom-XMLHttpRequest-withCredentials">withCredentials</a></code>
 <dd>
  <p>True when <a href="#user-credentials">user credentials</a> are to be included in a
  cross-origin request. False when they are to be excluded in a
  cross-origin request and when cookies are to be ignored in its response.
  Initially false.

  <p>When set: throws an
  <code>InvalidStateError</code> exception if
  <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not <i title="">unsent</i> or
  <i title="">opened</i>, or if the <a href="#send-flag"><code>send()</code> flag</a> is set.
 </dd>
</dl>

<p>The
<dfn id="dom-xmlhttprequest-withcredentials" title="dom-XMLHttpRequest-withCredentials"><code>withCredentials</code></dfn>
attribute must return its value. Initially its value must be false.

<p>Setting the
<a href="#dom-xmlhttprequest-withcredentials"><code title="dom-XMLHttpRequest-withCredentials">withCredentials</code></a>
attribute must run these steps:

<ol>
 <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not
 <i title="">unsent</i> or <i title="">opened</i>,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.

 <li><p>If the <a href="#send-flag"><code>send()</code> flag</a> is set,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.

 <li><p>Set the <a href="#dom-xmlhttprequest-withcredentials"><code title="dom-XMLHttpRequest-withCredentials">withCredentials</code></a>
 attribute's value to the given value.
</ol>

<p class="note">The <a href="#dom-xmlhttprequest-withcredentials"><code title="dom-XMLHttpRequest-withCredentials">withCredentials</code></a>
attribute has no effect when
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetching</a>
<a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" title="same origin">same-origin</a> resources.


<h4 id="the-upload-attribute"><span class="secno">4.5.5 </span>The <code title="">upload</code> attribute</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-upload" title="dom-XMLHttpRequest-upload">upload</a></code>
 <dd><p>Returns the associated <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a>
 object. It can be used to gather transmission information when data is
 transferred to a server.
</dl>

<p>The
<dfn id="dom-xmlhttprequest-upload" title="dom-XMLHttpRequest-upload"><code>upload</code></dfn>
attribute must return the associated
<a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object.

<p class="note">As indicated earlier, each <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a>
object has an associated <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object.


<h4 id="the-send()-method"><span class="secno">4.5.6 </span>The <code title="">send()</code> method</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-send" title="dom-XMLHttpRequest-send">send</a>([<var title="">body</var> = null])</code>
 <dd>
  <p>Initiates the request. The optional argument provides the
  <a href="#request-body">request body</a>. The argument is ignored if
  <a href="#request-method">request method</a> is <code>GET</code> or
  <code>HEAD</code>.

  <p>Throws an <code>InvalidStateError</code> exception if either
  <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not <i title="">opened</i> or the
  <a href="#send-flag"><code>send()</code> flag</a> is set.
</dl>

<p>The <dfn id="dom-xmlhttprequest-send" title="dom-XMLHttpRequest-send"><code>send(<var>body</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not
 <i title="">opened</i>, <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.

 <li><p>If the <a href="#send-flag"><code>send()</code> flag</a> is set,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.

 <li><p>If the <a href="#request-method">request method</a> is <code>GET</code> or
 <code>HEAD</code>, set <var title="">body</var> to null.

 <li>
  <p>If <var title="">body</var> is null, go to the next step.

  <p>Otherwise, let <var>encoding</var> be null, <var>Content-Type</var> be null, and then
  follow these rules, depending on <var title="">body</var>:

  <dl class="switch">
   <dt id="dom-xmlhttprequest-send-document"><a href="https://dom.spec.whatwg.org/#document"><code class="external" data-anolis-spec="dom">Document</code></a>
   <dd>
    <p>Set <var>encoding</var> to `<code title="">UTF-8</code>`.

    <p>If <var>body</var> is an <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#html-document">HTML document</a>, set
    <var>Content-Type</var> to `<code>text/html</code>`, and set <var>Content-Type</var>
    to `<code>application/xml</code>` otherwise. Then append `<code>;charset=UTF-8</code>`
    to <var>Content-Type</var>.

    <p>Set <a href="#request-body">request body</a> to <var>body</var>,
    <a class="external" data-anolis-spec="domps" href="https://dvcs.w3.org/hg/innerhtml/raw-file/tip/index.html#dfn-concept-fragment-serializing-algorithm" title="concept-serialize">serialized</a> with the
    <i title="">require well-formed flag</i> set,
    <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-obtain-unicode" title="convert a DOMString to a sequence of Unicode characters">converted to Unicode</a>,
    and <a class="external" data-anolis-spec="encoding" href="https://encoding.spec.whatwg.org/#utf-8-encode" title="utf-8 encode">utf-8 encoded</a>.
    Rethrow any exceptions.

    <p class="note">If <var>body</var> cannot be
    <a class="external" data-anolis-spec="domps" href="https://dvcs.w3.org/hg/innerhtml/raw-file/tip/index.html#dfn-concept-fragment-serializing-algorithm" title="concept-serialize">serialized</a>, an
    <code>InvalidStateError</code> exception is thrown.

   <dt id="dom-xmlhttprequest-send-bodyinit"><a href="https://fetch.spec.whatwg.org/#bodyinit"><code class="external" data-anolis-spec="fetch">BodyInit</code></a>
   <dd>
    <p>If <var>body</var> is a string, set <var>encoding</var> to
    `<code title="">UTF-8</code>`.

    <p>Set <a href="#request-body">request body</a> and <var>Content-Type</var> to the result of
    <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-bodyinit-extract" title="concept-BodyInit-extract">extracting</a>
    <var>body</var>.
  </dl>

  <p>If <var>Content-Type</var> is non-null and <a href="#author-request-headers">author request headers</a>
  contains no <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header" title="concept-header">header</a>
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-name" title="concept-header-name">named</a>
  `<code>Content-Type</code>`,
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-list-append" title="concept-header-list-append">append</a>
  `<code>Content-Type</code>`/<var title="">Content-Type</var> to
  <a href="#author-request-headers">author request headers</a>.

  <p>Otherwise, if the <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header" title="concept-header">header</a>
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-name" title="concept-header-name">named</a>
  `<code>Content-Type</code>` in <a href="#author-request-headers">author request headers</a> has a
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-value" title="concept-header-value">value</a> that is a
  <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/infrastructure.html#valid-mime-type">valid MIME type</a>, which has a
  `<code>charset</code>` parameter whose value is not a case-insensitive
  match for <var title="">encoding</var>, and <var title="">encoding</var>
  is not null, then set all the `<code>charset</code>` parameters whose value is not a
  case-insensitive match for <var title="">encoding</var> of that
  `<code>Content-Type</code>`
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header" title="concept-header">header</a>'s
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-value" title="concept-header-value">value</a> to
  <var title="">encoding</var>.
  <!-- XXX could still be better with case-insensitive and parameter cross-ref -->

  <!-- reminder: if we ever change this to always include charset it has
  to be included as the first parameter for compatibility reasons -->

 <li><p>If one or more event listeners are registered on the associated
 <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object, then set <a href="#upload-listener-flag">upload listener flag</a>.

 <li>
  <p>Let <var title="">req</var> be a new
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request" title="concept-request">request</a>, initialized as
  follows:

  <dl>
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-method" title="concept-request-method">method</a>
   <dd><a href="#request-method">request method</a>
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-url" title="concept-request-url">url</a>
   <dd><a href="#request-url">request URL</a>
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-header-list" title="concept-request-header-list">header list</a>
   <dd><a href="#author-request-headers">author request headers</a>
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#unsafe-request-flag">unsafe-request flag</a>
   <dd>Set.
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-body" title="concept-request-body">body</a>
   <dd><a href="#request-body">request body</a>
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-client" title="concept-request-client">client</a>
   <dd><a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#context-object">context object</a>'s
   <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a>
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#synchronous-flag">synchronous flag</a>
   <dd>Set if the <a href="#synchronous-flag">synchronous flag</a> is set.
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-mode" title="concept-request-mode">mode</a>
   <dd>"<code>cors</code>"
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#use-cors-preflight-flag">use-CORS-preflight flag</a>
   <dd>Set if <a href="#upload-listener-flag">upload listener flag</a> is set.
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" title="concept-request-credentials-mode">credentials mode</a>
   <dd>If the <a href="#dom-xmlhttprequest-withcredentials"><code title="dom-XMLHttpRequest-withCredentials">withCredentials</code></a>
   attribute value is true, "<code>include</code>", and "<code>same-origin</code>"
   otherwise.
   <dt><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag" title="concept-request-use-url-credentials-flag">use URL credentials flag</a>
   <dd>Set if either <a href="#request-url">request URL</a>'s
   <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#concept-url-username" title="concept-url-username">username</a>
   is not the empty string or <a href="#request-url">request URL</a>'s
   <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#concept-url-password" title="concept-url-password">password</a> is non-null.
  </dl>

 <li><p>Unset the <a href="#upload-complete-flag">upload complete flag</a>.

 <li><p>If <var title="">req</var>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-body" title="concept-request-body">body</a> is null,
 set the <a href="#upload-complete-flag">upload complete flag</a>.

 <li><p>Set the <a href="#send-flag"><code>send()</code> flag</a>.

 <li>
  <p>If the <a href="#synchronous-flag">synchronous flag</a> is unset, run these substeps:

  <ol>
   <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named <a href="#event-xhr-loadstart"><code title="event-xhr-loadstart">loadstart</code></a> with 0 and 0.

   <li><p>If the <a href="#upload-complete-flag">upload complete flag</a> is unset and <a href="#upload-listener-flag">upload listener flag</a> is
   set, then <a href="#concept-event-fire-progress" title="concept-event-fire-progress">fire a progress event</a> named
   <a href="#event-xhr-loadstart"><code title="event-xhr-loadstart">loadstart</code></a> on the
   <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object with 0 and <var title="">req</var>'s
   <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-body" title="concept-request-body">body</a>'s
   <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-total-bytes" title="concept-body-total-bytes">total bytes</a>.

   <li>
    <p><a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">Fetch</a> <var title="">req</var>.
    Handle the <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" title="concept-task">tasks</a>
    <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" title="queue a task">queued</a> on the
    <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source">networking task source</a> per below.

    <p>Run these subsubsteps <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>:

    <ol>
     <li><p>Let <var>milliseconds</var> be zero.

     <li>
      <p>Every millisecond, as long as the <a href="#stop-timeout-flag">stop timeout flag</a> is unset,
      <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask">queue a microtask</a> to run these subsubsubsteps:

      <ol>
       <li><p>Increase <var>milliseconds</var> by one.

       <li><p>If <var>milliseconds</var> is equal or greater than
       the <a href="#dom-xmlhttprequest-timeout"><code title="dom-XMLHttpRequest-timeout">timeout</code></a> attribute value and
       the <a href="#dom-xmlhttprequest-timeout"><code title="dom-XMLHttpRequest-timeout">timeout</code></a> attribute value is not
       zero, <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch-terminate" title="concept-fetch-terminate">terminate</a>
       <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetching</a> with reason
       <i title="">timeout</i>.
      </ol>
    </ol>

    <p>To <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#process-request-body">process request body</a> for
    <var title="">request</var>, run these subsubsteps:

    <ol>
     <li><p>If not roughly 50ms have passed since these subsubsteps were last invoked,
     terminate these subsubsteps.

     <li><p>If <a href="#upload-listener-flag">upload listener flag</a> is set, then
     <a href="#concept-event-fire-progress" title="concept-event-fire-progress">fire a progress event</a> named
     <a href="#event-xhr-progress"><code title="event-xhr-progress">progress</code></a> on the
     <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object with <var title="">request</var>'s
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-body" title="concept-request-body">body</a>'s
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-transmitted" title="concept-body-transmitted">transmitted bytes</a> and
     <var title="">request</var>'s
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-body" title="concept-request-body">body</a>'s
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-total-bytes" title="concept-body-total-bytes">total bytes</a>.
     <!-- upload complete flag can never be set here I hope -->
    </ol>

    <p class="note">These subsubsteps are only invoked when new bytes are transmitted.

    <p>To <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#process-request-end-of-body">process request end-of-body</a> for
    <var title="">request</var>, run these subsubsteps:

    <ol>
     <li><p>Set the <a href="#upload-complete-flag">upload complete flag</a>.

     <li><p>If <a href="#upload-listener-flag">upload listener flag</a> is unset, then terminate these subsubsteps.

     <li><p>Let <var title="">transmitted</var> be <var title="">request</var>'s
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-body" title="concept-request-body">body</a>'s
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-transmitted" title="concept-body-transmitted">transmitted bytes</a>.

     <li><p>Let <var title="">length</var> be <var title="">request</var>'s
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-request-body" title="concept-request-body">body</a>'s
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-total-bytes" title="concept-body-total-bytes">total bytes</a>.

     <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named
     <a href="#event-xhr-progress"><code title="event-xhr-progress">progress</code></a> on the
     <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object with <var title="">transmitted</var> and
     <var title="">length</var>.

     <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named
     <a href="#event-xhr-load"><code title="event-xhr-load">load</code></a> on the
     <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object with <var title="">transmitted</var> and
     <var title="">length</var>.

     <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named
     <a href="#event-xhr-loadend"><code title="event-xhr-loadend">loadend</code></a> on the
     <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object with <var title="">transmitted</var> and
     <var title="">length</var>.
    </ol>
    <!-- upload complete flag can never be set here I hope -->

    <p>To <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#process-response">process response</a> for <var title="">response</var>,
    run these subsubsteps:

    <ol>
     <li><p>If the <a href="#stop-timeout-flag">stop timeout flag</a> is unset, set the
     <a href="#stop-timeout-flag">stop timeout flag</a>.

     <li><p>Set <a href="#response">response</a> to <var title="">response</var>.

     <li><p><a href="#handle-errors">Handle errors</a> for <var title="">response</var>.

     <li><p>If <a href="#response">response</a> is a
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-network-error" title="concept-network-error">network error</a>,
     return.

     <li><p>Set <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> to
     <i title="">headers received</i>.

     <li><p><a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">Fire an event</a> named
     <a href="#event-xhr-readystatechange"><code title="event-xhr-readystatechange">readystatechange</code></a>.

     <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not
     <i>headers received</i>, then return.

     <li><p>If <var>response</var>'s
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a> is null,
     then run <a href="#handle-response-end-of-body">handle response end-of-body</a> and return.

     <li>
      <p>Let <var>reader</var> be the result of
      <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-get-reader" title="concept-get-reader">getting a reader</a> from
      <var>response</var>'s <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a>'s
      <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-stream" title="concept-body-stream">stream</a>.

      <p><span class="note no-backref">This operation will not throw an exception.</span>

     <li>
      <p>Let <var>read</var> be the result of
      <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-read-chunk-from-readablestream" title="concept-read-chunk-from-readablestream">reading a chunk</a>
      from <var>response</var>'s
      <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a>'s
      <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-stream" title="concept-body-stream">stream</a> with <var>reader</var>.

      <p>When <var>read</var> is fulfilled with an object whose <code>done</code> property is false
      and whose <code>value</code> property is a <code>Uint8Array</code> object, run these
      subsubsubsteps and then run the above subsubstep again:

      <ol>
       <li><p>Append the <code>value</code> property to <a href="#received-bytes">received bytes</a>.

       <li><p>If not roughly 50ms have passed since these subsubsubsteps were last invoked,
       then terminate these subsubsubsteps.

       <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is
       <i>headers received</i>, then set
       <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> to <i>loading</i> and
       <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">fire an event</a> named
       <a href="#event-xhr-readystatechange"><code title="event-xhr-readystatechange">readystatechange</code></a>.

       <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named
       <a href="#event-xhr-progress"><code title="event-xhr-progress">progress</code></a> with <var>response</var>'s
       <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a>'s
       <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-transmitted" title="concept-body-transmitted">transmitted bytes</a> and
       <var>response</var>'s <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a>'s
       <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-total-bytes" title="concept-body-total-bytes">total bytes</a>.
      </ol>

      <p>When <var>read</var> is fulfilled with an object whose <code>done</code> property is true,
      run <a href="#handle-response-end-of-body">handle response end-of-body</a> for <var>response</var>.

      <p>When <var>read</var> is rejected with an exception, run <a href="#handle-errors">handle errors</a> for
      <var>response</var>.
    </ol>
  </ol>

 <li>
  <p>Otherwise, if the <a href="#synchronous-flag">synchronous flag</a> is set, run these substeps:

  <ol>
   <li>
    <p>Let <var title="">response</var> be the result of
    <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetching</a> <var title="">req</var>.

    <p>If the <a href="#dom-xmlhttprequest-timeout"><code title="dom-XMLHttpRequest-timeout">timeout</code></a> attribute value is not
    zero, <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch-terminate" title="concept-fetch-terminate">terminate</a> this
    <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetch</a> if it has not returned
    within the amount of milliseconds from the
    <a href="#dom-xmlhttprequest-timeout"><code title="dom-XMLHttpRequest-timeout">timeout</code></a> attribute value with reason
    <i title="">timeout</i>.

   <li><p>If <var>response</var>'s
   <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a> is null,
   then run <a href="#handle-response-end-of-body">handle response end-of-body</a> and return.

   <li>
    <p>Let <var>reader</var> be the result of
    <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-get-reader" title="concept-get-reader">getting a reader</a> from
    <var>response</var>'s <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a>'s
    <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-stream" title="concept-body-stream">stream</a>.

    <p><span class="note no-backref">This operation will not throw an exception.</span>

   <li><p>Let <var>promise</var> be the result of
   <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-read-all-bytes-from-readablestream" title="concept-read-all-bytes-from-ReadableStream">reading all
   bytes</a> from <var>response</var>'s
   <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a>'s
   <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-stream" title="concept-body-stream">stream</a> with <var>reader</var>.

   <li><p>Wait for <var>promise</var> to be fulfilled or rejected.

   <li><p>If <var>promise</var> is fulfilled with <var>bytes</var>, then append <var>bytes</var>
   to <a href="#received-bytes">received bytes</a>.

   <li><p>Run <a href="#handle-response-end-of-body">handle response end-of-body</a> for <var title="">response</var>.
  </ol>
</ol>

<p id="handle-response-end-of-file">To <dfn id="handle-response-end-of-body">handle response end-of-body</dfn> for
<var title="">response</var>, run these steps:

<ol>
 <li><p>If the <a href="#synchronous-flag">synchronous flag</a> is set, set <a href="#response">response</a> to
 <var title="">response</var>.

 <li><p><a href="#handle-errors">Handle errors</a> for <var title="">response</var>.

 <li><p>If <a href="#response">response</a> is a
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-network-error" title="concept-network-error">network error</a>, return.

 <li><p>If the <a href="#synchronous-flag">synchronous flag</a> is unset, update <a href="#response">response</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a> using
 <var title="">response</var>.

 <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named
 <a href="#event-xhr-progress"><code title="event-xhr-progress">progress</code></a> with <var>transmitted</var> and <var>length</var>.

 <li><p>Set <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> to <i title="">done</i>.

 <li><p>Unset the <a href="#send-flag"><code>send()</code> flag</a>.

 <li><p><a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">Fire an event</a> named <a href="#event-xhr-readystatechange"><code title="event-xhr-readystatechange">readystatechange</code></a>.

 <li><p>Let <var title="">transmitted</var> be <var title="">response</var>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-transmitted" title="concept-body-transmitted">transmitted bytes</a>.

 <li><p>Let <var title="">length</var> be <var title="">response</var>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-body-total-bytes" title="concept-body-total-bytes">total bytes</a>.

 <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named <a href="#event-xhr-load"><code title="event-xhr-load">load</code></a>
 with <var title="">transmitted</var> and <var title="">length</var>.

 <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named <a href="#event-xhr-loadend"><code title="event-xhr-loadend">loadend</code></a>
 with <var title="">transmitted</var> and <var title="">length</var>.
</ol>

<p>To <dfn id="handle-errors">handle errors</dfn> for <var title="">response</var> run these steps:

<ol>
 <li><p>If the <a href="#send-flag"><code>send()</code> flag</a> is unset, return.

 <li><p>If <var title="">response</var> is a
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-network-error" title="concept-network-error">network error</a>, run the
 <a href="#request-error-steps">request error steps</a> for event <a href="#event-xhr-error"><code title="event-xhr-error">error</code></a> and
 exception <code>NetworkError</code>.

 <li>
  <p>Otherwise, if <var title="">response</var> has a
  <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-termination-reason" title="concept-response-termination-reason">termination reason</a>:

  <dl class="switch">
   <dt><i title="">end-user abort</i>
   <dd><p>Run the <a href="#request-error-steps">request error steps</a> for event
   <a href="#event-xhr-abort"><code title="event-xhr-abort">abort</code></a> and exception
   <code>AbortError</code>.

   <dt><i title="">fatal</i>
   <dd>
    <ol>
     <li><p>Set <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> to
     <i title="">done</i>.

     <li><p>Unset the <a href="#send-flag"><code>send()</code> flag</a>.

     <li><p>Set <a href="#response">response</a> to a
     <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-network-error" title="concept-network-error">network error</a>.
    </ol>

   <dt><i title="">timeout</i>
   <dd><p>Run the <a href="#request-error-steps">request error steps</a> for event
   <a href="#event-xhr-timeout"><code title="event-xhr-timeout">timeout</code></a> and exception
   <code>TimeoutError</code>.
  </dl>
</ol>

<p>The <dfn id="request-error-steps">request error steps</dfn> for event <var title="">event</var> and optionally an
exception <var>exception</var> are:

<ol>
 <li><p>Set <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> to <i title="">done</i>.

 <li><p>Unset the <a href="#send-flag"><code>send()</code> flag</a>.

 <li><p>Set <a href="#response">response</a> to a
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-network-error" title="concept-network-error">network error</a>.

 <li><p>If the <a href="#synchronous-flag">synchronous flag</a> is set,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an <var>exception</var>
 exception.

 <li>
  <p><a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">Fire an event</a> named <a href="#event-xhr-readystatechange"><code title="event-xhr-readystatechange">readystatechange</code></a>.

  <p class="note">At this point it is clear that the <a href="#synchronous-flag">synchronous flag</a> is unset.

 <li>
  <p>If the <a href="#upload-complete-flag">upload complete flag</a> is unset, follow these substeps:

  <ol>
   <li><p>Set the <a href="#upload-complete-flag">upload complete flag</a>.

   <li><p>If <a href="#upload-listener-flag">upload listener flag</a> is unset, then terminate these substeps.

   <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named
   <var title="">event</var> on the <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> object with 0 and 0.

   <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named
   <a href="#event-xhr-loadend"><code title="event-xhr-loadend">loadend</code></a> on the <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a>
   object with 0 and 0.
  </ol>

 <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named
 <var title="">event</var> with 0 and 0.

 <li><p><a href="#concept-event-fire-progress" title="concept-event-fire-progress">Fire a progress event</a> named
 <a href="#event-xhr-loadend"><code title="event-xhr-loadend">loadend</code></a> with 0 and 0.
</ol>


<h4 id="the-abort()-method"><span class="secno">4.5.7 </span>The <code title="">abort()</code> method</h4>

  <dl class="domintro">
   <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-abort" title="dom-XMLHttpRequest-abort">abort</a>()</code>
   <dd>Cancels any network activity.
  </dl>

<p>The <dfn id="dom-xmlhttprequest-abort" title="dom-XMLHttpRequest-abort"><code>abort()</code></dfn> method, when invoked, must
run these steps:

<ol>
 <li><p><a href="#terminate-the-request">Terminate the request</a>.

 <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is either
 <i title="">opened</i> with the <a href="#send-flag"><code>send()</code> flag</a> set,
 <i title="">headers received</i>, or <i title="">loading</i>, run the
 <a href="#request-error-steps">request error steps</a> for event <a href="#event-xhr-abort"><code title="event-xhr-abort">abort</code></a>.

 <li>
  <p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is <i>done</i>, set
  <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> to <i>unsent</i>.

  <p class="note">No <a href="#event-xhr-readystatechange"><code title="event-xhr-readystatechange">readystatechange</code></a> event
  is dispatched.
</ol>



<h3 id="xmlhttprequest-response"><span class="secno">4.6 </span>Response</h3>

<p>An <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> has an associated <dfn id="response">response</dfn>. Unless stated
otherwise it is a
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-network-error" title="concept-network-error">network error</a>.

<p>An <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> also has an associated <dfn id="received-bytes">received bytes</dfn> (a byte
sequence). Unless stated otherwise it is the empty byte sequence.

<h4 id="the-responseurl-attribute"><span class="secno">4.6.1 </span>The <code title="">responseURL</code> attribute</h4>

<p>The <dfn id="dom-xmlhttprequest-responseurl" title="dom-XMLHttpRequest-responseURL"><code>responseURL</code></dfn> attribute
must return the empty string if <a href="#response">response</a>'s
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-url" title="concept-response-url">url</a> is null and its
<a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#concept-url-serializer" title="concept-url-serializer">serialization</a> with the
<i title="">exclude fragment flag</i> set otherwise.


<h4 id="the-status-attribute"><span class="secno">4.6.2 </span>The <code title="">status</code> attribute</h4>

<p>The
<dfn id="dom-xmlhttprequest-status" title="dom-XMLHttpRequest-status"><code>status</code></dfn>
attribute must return the <a href="#response">response</a>'s
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-status" title="concept-response-status">status</a>.


<h4 id="the-statustext-attribute"><span class="secno">4.6.3 </span>The <code title="">statusText</code> attribute</h4>

<p>The
<dfn id="dom-xmlhttprequest-statustext" title="dom-XMLHttpRequest-statusText"><code>statusText</code></dfn>
attribute must return the <a href="#response">response</a>'s
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-status-message" title="concept-response-status-message">status message</a>.


<h4 id="the-getresponseheader()-method"><span class="secno">4.6.4 </span>The <code title="">getResponseHeader()</code> method</h4>

<p>The
<dfn id="dom-xmlhttprequest-getresponseheader" title="dom-XMLHttpRequest-getResponseHeader"><code>getResponseHeader(<var>name</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <a href="#response">response</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-header-list" title="concept-response-header-list">header list</a> has <em>no</em>
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header" title="concept-header">header</a> whose
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-name" title="concept-header-name">name</a> is <var>name</var>, then return
 null.

 <li><p>Return the
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-value-combined" title="concept-header-value-combined">combined value</a> given
 <var>name</var> and <a href="#response">response</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-header-list" title="concept-response-header-list">header list</a>.
</ol>

<p class="note no-backref">The Fetch Standard filters <a href="#response">response</a>'s
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-header-list" title="concept-response-header-list">header list</a>.
<a href="#refsFETCH">[FETCH]</a>

<div class="example">

 <p>For the following script:

 <pre><code>var client = new XMLHttpRequest();
client.open("GET", "unicorns-are-teh-awesome.txt", true);
client.send();
client.onreadystatechange = function() {
  if(this.readyState == this.HEADERS_RECEIVED) {
    print(client.getResponseHeader("Content-Type"));
  }
}</code></pre>

 <p>The <code>print()</code> function will get to process something
 like:

 <pre><code>text/plain; charset=UTF-8</code></pre>
</div>


<h4 id="the-getallresponseheaders()-method"><span class="secno">4.6.5 </span>The <code title="">getAllResponseHeaders()</code> method</h4>

<p>The
<dfn id="dom-xmlhttprequest-getallresponseheaders" title="dom-XMLHttpRequest-getAllResponseHeaders"><code>getAllResponseHeaders()</code></dfn>
method, when invoked, must run these steps:</p>

<ol>
 <li><p>Let <var>output</var> be an empty byte sequence.

 <li><p>Let <var>headers</var> be the result of running
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-list-sort-and-combine" title="concept-header-list-sort-and-combine">sort and combine</a>
 with <a href="#response">response</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-header-list" title="concept-response-header-list">header list</a>.

 <li>
  <p>For each <var>header</var> in <var>headers</var>, run these substeps:

  <ol>
   <li><p>Append <var>header</var>'s
   <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-name" title="concept-header-name">name</a>, followed by a 0x3A 0x20 byte
   pair, followed by <var>header</var>'s
   <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-header-value" title="concept-header-value">value</a>, to <var>output</var>.

   <li><p>If <var>header</var> is not the last pair in <var>headers</var>, then append a 0x0D 0x0A
   byte pair, to <var>output</var>.
  </ol>

 <li><p>Return <var>output</var>.
</ol>

<p class="note no-backref">The Fetch Standard filters <a href="#response">response</a>'s
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-header-list" title="concept-response-header-list">header list</a>.
<a href="#refsFETCH">[FETCH]</a>

<div class="example">
 <p>For the following script:

 <pre><code>var client = new XMLHttpRequest();
client.open("GET", "narwhals-too.txt", true);
client.send();
client.onreadystatechange = function() {
  if(this.readyState == this.HEADERS_RECEIVED) {
    print(this.getAllResponseHeaders());
  }
}</code></pre>

 <p>The <code>print()</code> function will get to process something
 like:

 <pre><code>Date: Sun, 24 Oct 2004 04:58:38 GMT
Server: Apache/1.3.31 (Unix)
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/plain; charset=utf-8</code></pre>
</div>


<h4 id="response-body"><span class="secno">4.6.6 </span>Response body</h4>

<p>The <dfn id="response-mime-type">response MIME type</dfn> is the
MIME type the `<code title="">Content-Type</code>` header contains excluding any
parameters and
<a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#converted-to-ascii-lowercase">converted to ASCII lowercase</a>, or null if
the response header can not be parsed or was omitted. The
<dfn id="override-mime-type">override MIME type</dfn> is initially null
and can get a value if
<a href="#dom-xmlhttprequest-overridemimetype"><code title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType()</code></a>
is invoked. <dfn id="final-mime-type">Final MIME type</dfn> is the
<a href="#override-mime-type">override MIME type</a> unless that is null in which case it is
the <a href="#response-mime-type">response MIME type</a>.

<p>The <dfn id="response-charset">response charset</dfn> is the value of
the <code>charset</code> parameter of the `<code title="">Content-Type</code>` header
or null if there was no `<code title="">charset</code>` parameter or the header could
not be parsed or was omitted. The
<dfn id="override-charset">override charset</dfn> is initially null and
can get a value if <a href="#dom-xmlhttprequest-overridemimetype"><code title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType()</code></a> is invoked.
<dfn id="final-charset">Final charset</dfn> is the
<a href="#override-charset">override charset</a> unless
that is null in which case it is the <a href="#response-charset">response charset</a>.

<hr>

<p>An <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a> object has an associated
<dfn id="response-arraybuffer-object">response <code>ArrayBuffer</code> object</dfn>,
<dfn id="response-blob-object">response <code>Blob</code> object</dfn>,
<dfn id="response-document-object">response <code>Document</code> object</dfn>, and a
<dfn id="response-json-object">response JSON object</dfn>. Their shared initial value is null.


<p>An <dfn id="arraybuffer-response">arraybuffer response</dfn> is the return value of these steps:

<ol>
 <li><p>If <a href="#response-arraybuffer-object">response <code>ArrayBuffer</code> object</a> is non-null, return it.

 <li>
  <p>Set <a href="#response-arraybuffer-object">response <code>ArrayBuffer</code> object</a> to a new <code>ArrayBuffer</code>
  object representing <a href="#received-bytes">received bytes</a>. If this throws an exception, then set
  <a href="#response-arraybuffer-object">response <code>ArrayBuffer</code> object</a> to null and set <a href="#received-bytes">received bytes</a>
  to the empty byte sequence.

  <p class="note">Allocating an <code>ArrayBuffer</code> buffer is not guaranteed to succeed.
  <a href="#refsECMASCRIPT">[ECMASCRIPT]</a>

 <li><p>Return <a href="#response-arraybuffer-object">response <code>ArrayBuffer</code> object</a>.
</ol>


<p>A <dfn id="blob-response">blob response</dfn> is the return value of these steps:

<ol>
 <li><p>If <a href="#response-blob-object">response <code>Blob</code> object</a> is non-null, return it.

 <li><p>Let <var title="">type</var> be the empty string, if <a href="#final-mime-type">final MIME type</a> is
 null, and <a href="#final-mime-type">final MIME type</a> otherwise.

 <li><p>Set <a href="#response-blob-object">response <code>Blob</code> object</a> to a new
 <a href="https://w3c.github.io/FileAPI/#blob"><code class="external" data-anolis-spec="fileapi">Blob</code></a> object representing <a href="#received-bytes">received bytes</a> with
 <a href="https://w3c.github.io/FileAPI/#dfn-type"><code class="external" data-anolis-spec="fileapi" title="dom-Blob-type">type</code></a> <var title="">type</var> and
 return it.
</ol>


<p>A <dfn id="document-response">document response</dfn> is the return value of these steps:

<ol>
 <li><p>If <a href="#response-document-object">response <code>Document</code> object</a> is non-null, return it.

 <li><p>If <a href="#response">response</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a> is null, then return null.

 <li><p>If <a href="#final-mime-type">final MIME type</a> is not null,
 <code>text/html</code>, <code>text/xml</code>,
 <code>application/xml</code>, or does not end in
 <code title="">+xml</code>, return null.

 <li>
  <p>If <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is
  the empty string and <a href="#final-mime-type">final MIME type</a> is
  <code>text/html</code>, return null.

  <p class="note">This is restricted to
  <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> being
  "<code title="">document</code>" in order to prevent breaking legacy
  content.

 <li>
  <p>If <a href="#final-mime-type">final MIME type</a> is <code>text/html</code>, run these
  substeps:

  <ol>
   <li><p>Let <var>charset</var> be the <a href="#final-charset">final charset</a>.

   <li><p>If <var>charset</var> is null,
   <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/syntax.html#prescan-a-byte-stream-to-determine-its-encoding" title="prescan a byte stream to determine its encoding">prescan</a>
   the first 1024 bytes of <a href="#received-bytes">received bytes</a> and if
   that does not terminate unsuccessfully then let <var>charset</var> be
   the return value.

   <li><p>If <var>charset</var> is null, set <var>charset</var> to
   <a class="external" data-anolis-spec="encoding" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a>.

   <li><p>Let <var title="">document</var> be a
   <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-document" title="concept-document">document</a> that
   represents the result parsing <a href="#received-bytes">received bytes</a> following the rules set
   forth in the HTML Standard for an HTML parser with scripting disabled and
   <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/syntax.html#a-known-definite-encoding">a known definite encoding</a> <var>charset</var>.
   <a href="#refsHTML">[HTML]</a>

   <li><p>Flag <var title="">document</var> as an
   <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#html-document">HTML document</a>.
  </ol>

 <li>
  <p>Otherwise, let <var title="">document</var> be a
  <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-document" title="concept-document">document</a>
  that represents the result of running the <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/xhtml.html#xml-parser">XML parser</a>
  with <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/xhtml.html#xml-scripting-support-disabled">XML scripting support disabled</a> on
  <a href="#received-bytes">received bytes</a>. If that fails (unsupported character encoding,
  namespace well-formedness error, etc.), then return null.
  <a href="#refsHTML">[HTML]</a>

  <p class="note">Resources referenced will not be loaded and no associated XSLT will be
  applied. <!-- XXX more formally?! -->

 <li><p>If <var>charset</var> is null, set <var>charset</var> to
 <a class="external" data-anolis-spec="encoding" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a>.
 <!-- can only happen in the XML case -->

 <li><p>Set <var title="">document</var>'s
 <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-document-encoding" title="concept-document-encoding">encoding</a> to
 <var>charset</var>.

 <li><p>Set <var title="">document</var>'s
 <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-document-content-type" title="concept-document-content-type">content type</a>
 to <a href="#final-mime-type">final MIME type</a>.

 <li><p>Set <var title="">document</var>'s
 <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-document-url" title="concept-document-url">URL</a> to
 <a href="#response">response</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-url" title="concept-response-url">url</a>.

 <li><p>Set <var title="">document</var>'s <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> to
 <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#context-object">context object</a>'s
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a>'s
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>.

 <li><p>Set <a href="#response-document-object">response <code>Document</code> object</a> to
 <var title="">document</var> and return it.
</ol>


<p>A <dfn id="json-response">JSON response</dfn> is the return value of these steps:

<ol>
 <li><p>If <a href="#response-json-object">response JSON object</a> is non-null, return it.

 <li><p>If <a href="#response">response</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a> is null, then return null.

 <li><p>Let <var>JSON text</var> be the result of running
 <a class="external" data-anolis-spec="encoding" href="https://encoding.spec.whatwg.org/#utf-8-decode">utf-8 decode</a> on <a href="#received-bytes">received bytes</a>.

 <li><p>Let <var>JSON object</var> be the result of invoking the initial value of the
 <code title="">parse</code> property of the <code title="">JSON</code> object, with
 <var>JSON text</var> as its only argument. If that threw an exception, return null.
 <a href="#refsECMASCRIPT">[ECMASCRIPT]</a>

 <li><p>Set <a href="#response-json-object">response JSON object</a> to <var>JSON object</var> and return it.
</ol>


<p>A <dfn id="text-response">text response</dfn> is the return value of these steps:

<ol>
 <li><p>If <a href="#response">response</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a> is null, then return the
 empty string.

 <li><p>Let <var>charset</var> be the <a href="#final-charset">final charset</a>.

 <li>
  <p>If <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is
  the empty string, <var>charset</var> is null, and
  <a href="#final-mime-type">final MIME type</a> is either null, <code>text/xml</code>,
  <code>application/xml</code> or ends in <code title="">+xml</code>, use the
  rules set forth in the XML specifications to determine the encoding. Let
  <var>charset</var> be the determined encoding.
  <a href="#refsXML">[XML]</a> <a href="#refsXMLNS">[XMLNS]</a>

  <p class="note">This is restricted to
  <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> being
  the empty string to keep the non-legacy
  <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> value
  "<code title="">text</code>" simple.

 <li><p>If <var>charset</var> is null, set <var>charset</var> to
 <a class="external" data-anolis-spec="encoding" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a>.

 <li><p>Return the result of running
 <a class="external" data-anolis-spec="encoding" href="https://encoding.spec.whatwg.org/#decode">decode</a> on <a href="#received-bytes">received bytes</a> using fallback
 encoding <var>charset</var>.
</ol>

<p class="note">Authors are strongly encouraged to always encode their
resources using <a class="external" data-anolis-spec="encoding" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a>.



<h4 id="the-overridemimetype()-method"><span class="secno">4.6.7 </span>The <code title="">overrideMimeType()</code> method</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-overridemimetype" title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType</a>(<var title="">mime</var>)</code>
 <dd>
  <p>Sets the `<code title="">Content-Type</code>` header for <a href="#response">response</a> to
  <var title="">mime</var>.

  <p>Throws an <code>InvalidStateError</code> exception if
  <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is
  <i title="">loading</i> or <i title="">done</i>.

  <p>Throws a <code>SyntaxError</code> exception if
  <var title="">mime</var> is not a valid MIME type.
 </dd>
</dl>

<p>The
<dfn id="dom-xmlhttprequest-overridemimetype" title="dom-XMLHttpRequest-overrideMimeType"><code>overrideMimeType(<var title="">mime</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is
 <i title="">loading</i> or <i title="">done</i>,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.

 <li><p>If parsing <var title="">mime</var> analogously to the value of
 the `<code title="">Content-Type</code>` header fails,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> a
 <code>SyntaxError</code> exception.

 <li><p>If <var title="">mime</var> is successfully parsed, set
 <a href="#override-mime-type">override MIME type</a> to its MIME type,
 excluding any parameters, and
 <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#converted-to-ascii-lowercase">converted to ASCII lowercase</a>.

 <li><p>If a `<code title="">charset</code>` parameter is successfully parsed, set
 <a href="#override-charset">override charset</a> to its value.
</ol>



<h4 id="the-responsetype-attribute"><span class="secno">4.6.8 </span>The <code title="">responseType</code> attribute</h4>


<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-responsetype" title="dom-XMLHttpRequest-responseType">responseType</a></code> [ = <var>value</var> ]
 <dd>
  <p>Returns the response type.
  <p>Can be set to change the response type. Values are:
  the empty string (default),
  "<code title="">arraybuffer</code>",
  "<code title="">blob</code>",
  "<code title="">document</code>",
  "<code title="">json</code>", and
  "<code title="">text</code>".
  <p>When set: setting to "<code title="">document</code>" is ignored if
  <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
  <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is <em>not</em> a
  <a href="https://html.spec.whatwg.org/multipage/browsers.html#window"><code class="external" data-anolis-spec="html">Window</code></a> object.
  <p>When set: throws an
  <code>InvalidStateError</code> exception if
  <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is <i title="">loading</i> or
  <i title="">done</i>.
  <p>When set: throws an
  <code>InvalidAccessError</code> exception if the
  <a href="#synchronous-flag">synchronous flag</a> is set and
  <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
  <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is a <a href="https://html.spec.whatwg.org/multipage/browsers.html#window"><code class="external" data-anolis-spec="html">Window</code></a>
  object.
</dl>


<p>The
<dfn id="dom-xmlhttprequest-responsetype" title="dom-XMLHttpRequest-responseType"><code>responseType</code></dfn>
attribute must return its value. Initially its value must be the empty
string.

<p>Setting the
<a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a>
attribute must run these steps:

<ol>
 <li><p>If <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is <em>not</em> a
 <a href="https://html.spec.whatwg.org/multipage/browsers.html#window"><code class="external" data-anolis-spec="html">Window</code></a> object and the given value is
 "<code title="">document</code>", terminate these steps.

 <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is
 <i title="">loading</i> or <i title="">done</i>,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.

 <li><p>If <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is a <a href="https://html.spec.whatwg.org/multipage/browsers.html#window"><code class="external" data-anolis-spec="html">Window</code></a>
 object and the <a href="#synchronous-flag">synchronous flag</a> is set,
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidAccessError</code> exception.

 <li><p>Set the
 <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a>
 attribute's value to the given value.
</ol>




<h4 id="the-response-attribute"><span class="secno">4.6.9 </span>The <code title="">response</code> attribute</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-response" title="dom-XMLHttpRequest-response">response</a></code>
 <dd><p>Returns the <a href="#response">response</a>'s
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-response-body" title="concept-response-body">body</a>.
</dl>

<p>The
<dfn id="dom-xmlhttprequest-response" title="dom-XMLHttpRequest-response"><code>response</code></dfn>
attribute must return the result of running these
steps:

<dl class="switch">
 <dt>If <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a>
 is the empty string or "<code title="">text</code>"</dt>
 <dd>
  <ol>
   <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not
   <i title="">loading</i> or <i title="">done</i>, return the empty string.

   <li><p>Return the <a href="#text-response">text response</a>.
  </ol>

 <dt>Otherwise</dt>
 <dd>
  <ol>
   <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not
   <i title="">done</i>, return null.

   <li>
    <dl class="switch">
     <dt>If
     <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is
     "<code title="">arraybuffer</code>"</dt>
     <dd><p>Return the <a href="#arraybuffer-response">arraybuffer response</a>.

     <dt>If
     <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is
     "<code title="">blob</code>"</dt>
     <dd><p>Return the <a href="#blob-response">blob response</a>.

     <dt>If
     <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is
     "<code title="">document</code>"</dt>
     <dd><p>Return the <a href="#document-response">document response</a>.

     <dt>If
     <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is
     "<code title="">json</code>"</dt>
     <dd><p>Return the <a href="#json-response">JSON response</a>.
    </dl>
  </ol>
</dl>



<h4 id="the-responsetext-attribute"><span class="secno">4.6.10 </span>The <code title="">responseText</code> attribute</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-responsetext" title="dom-XMLHttpRequest-responseText">responseText</a></code>
 <dd>
  <p>Returns the <a href="#text-response">text response</a>.

  <p>Throws an <code>InvalidStateError</code>
  exception if
  <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is not
  the empty string or "<code title="">text</code>".
</dl>

<p>The
<dfn id="dom-xmlhttprequest-responsetext" title="dom-XMLHttpRequest-responseText"><code>responseText</code></dfn>
attribute must return the result of running these
steps:

<ol>

 <li><p>If <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is not the
 empty string or "<code title="">text</code>",
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.


 <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not
 <i title="">loading</i> or <i title="">done</i>, return the empty string.

 <li><p>Return the <a href="#text-response">text response</a>.
</ol>


<h4 id="the-responsexml-attribute"><span class="secno">4.6.11 </span>The <code title="">responseXML</code> attribute</h4>

<dl class="domintro">
 <dt><code><var title="">client</var> . <a href="#dom-xmlhttprequest-responsexml" title="dom-XMLHttpRequest-responseXML">responseXML</a></code>
 <dd>
  <p>Returns the <a href="#document-response">document response</a>.

  <p>Throws an <code>InvalidStateError</code>
  exception if
  <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is not
  the empty string or "<code title="">document</code>".
</dl>

<p>The
<dfn id="dom-xmlhttprequest-responsexml" title="dom-XMLHttpRequest-responseXML"><code>responseXML</code></dfn>
attribute must return the result of running these steps:

<ol>
 <li><p>If
 <a href="#dom-xmlhttprequest-responsetype"><code title="dom-XMLHttpRequest-responseType">responseType</code></a> is not
 the empty string or "<code title="">document</code>",
 <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-throw" title="throw">throw</a> an
 <code>InvalidStateError</code> exception.

 <li><p>If <a href="#concept-xmlhttprequest-state" title="concept-XMLHttpRequest-state">state</a> is not <i title="">done</i>,
 return null.

 <li><p>Return the <a href="#document-response">document response</a>.
</ol>

<p class="note">The
<a href="#dom-xmlhttprequest-responsexml"><code title="dom-XMLHttpRequest-responseXML">responseXML</code></a> attribute
has XML in its name for historical reasons. It also returns HTML resources
as <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-document" title="concept-document">documents</a>.


<h3 id="events"><span class="secno">4.7 </span>Events summary</h3>

<p><em>This section is non-normative.</em>

<p>The following events are dispatched on <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a>
and/or <a href="#xmlhttprequestupload"><code>XMLHttpRequestUpload</code></a> objects:

<table>
 <thead>
  <tr>
   <th>Event name</th>
   <th>Interface</th>
   <th>Dispatched when…</th>
 <tbody>
  <tr>
   <td><dfn id="event-xhr-readystatechange" title="event-xhr-readystatechange"><code>readystatechange</code></dfn></td>
   <td><a href="https://dom.spec.whatwg.org/#event"><code class="external" data-anolis-spec="dom">Event</code></a></td>
   <td>The <a href="#dom-xmlhttprequest-readystate"><code title="dom-XMLHttpRequest-readyState">readyState</code></a> attribute changes
   value, except when it changes to <a href="#dom-xmlhttprequest-unsent" title="dom-XMLHttpRequest-UNSENT">UNSENT</a>.
  <tr>
   <td><dfn id="event-xhr-loadstart" title="event-xhr-loadstart"><code>loadstart</code></dfn></td>
   <td><a href="#progressevent"><code>ProgressEvent</code></a></td>
   <td>The fetch initiates.
  <tr>
   <td><dfn id="event-xhr-progress" title="event-xhr-progress"><code>progress</code></dfn></td>
   <td><a href="#progressevent"><code>ProgressEvent</code></a></td>
   <td>Transmitting data.
  <tr>
   <td><dfn id="event-xhr-abort" title="event-xhr-abort"><code>abort</code></dfn></td>
   <td><a href="#progressevent"><code>ProgressEvent</code></a></td>
   <td>When the fetch has been aborted. For instance, by invoking the
   <a href="#dom-xmlhttprequest-abort"><code title="dom-XMLHttpRequest-abort">abort()</code></a> method.</td>
  <tr>
   <td><dfn id="event-xhr-error" title="event-xhr-error"><code>error</code></dfn></td>
   <td><a href="#progressevent"><code>ProgressEvent</code></a></td>
   <td>The fetch failed.
  <tr>
   <td><dfn id="event-xhr-load" title="event-xhr-load"><code>load</code></dfn></td>
   <td><a href="#progressevent"><code>ProgressEvent</code></a></td>
   <td>The fetch succeeded.
  <tr>
   <td><dfn id="event-xhr-timeout" title="event-xhr-timeout"><code>timeout</code></dfn></td>
   <td><a href="#progressevent"><code>ProgressEvent</code></a></td>
   <td>The author specified timeout has passed before the fetch completed.
  <tr>
   <td><dfn id="event-xhr-loadend" title="event-xhr-loadend"><code>loadend</code></dfn></td>
   <td><a href="#progressevent"><code>ProgressEvent</code></a></td>
   <td>The fetch completed (success or failure).
</table>



<h2 id="interface-formdata"><span class="secno">5 </span>Interface <code title="">FormData</code></h2>

<pre class="idl">typedef (<a class="external" data-anolis-spec="fileapi" href="https://w3c.github.io/FileAPI/#file">File</a> or USVString) <dfn id="formdataentryvalue">FormDataEntryValue</dfn>;

[<a href="#dom-formdata" title="dom-FormData">Constructor</a>(optional <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/forms.html#htmlformelement">HTMLFormElement</a> <var>form</var>),
 Exposed=(Window,Worker)]
interface <dfn id="formdata">FormData</dfn> {
  void <a href="#dom-formdata-append" title="dom-FormData-append">append</a>(USVString <var>name</var>, USVString <var>value</var>);
  void <a href="#dom-formdata-append" title="dom-FormData-append">append</a>(USVString <var>name</var>, <a class="external" data-anolis-spec="fileapi" href="https://w3c.github.io/FileAPI/#blob">Blob</a> <var>value</var>, optional USVString <var>filename</var>);
  void <a href="#dom-formdata-delete" title="dom-FormData-delete">delete</a>(USVString <var>name</var>);
  <a href="#formdataentryvalue">FormDataEntryValue</a>? <a href="#dom-formdata-get" title="dom-FormData-get">get</a>(USVString <var>name</var>);
  sequence&lt;<a href="#formdataentryvalue">FormDataEntryValue</a>&gt; <a href="#dom-formdata-getall" title="dom-FormData-getAll">getAll</a>(USVString <var>name</var>);
  boolean <a href="#dom-formdata-has" title="dom-FormData-has">has</a>(USVString <var>name</var>);
  void <a href="#dom-formdata-append" title="dom-FormData-append">set</a>(USVString <var>name</var>, USVString <var>value</var>);
  void <a href="#dom-formdata-append" title="dom-FormData-append">set</a>(USVString <var>name</var>, <a class="external" data-anolis-spec="fileapi" href="https://w3c.github.io/FileAPI/#blob">Blob</a> <var>value</var>, optional USVString <var>filename</var>);
  iterable&lt;USVString, <a href="#formdataentryvalue">FormDataEntryValue</a>&gt;;
};</pre>

<p>The <a href="#formdata"><code>FormData</code></a> object represents an ordered list of
<dfn id="concept-formdata-entry" title="concept-FormData-entry">entries</dfn>. Each
<a href="#concept-formdata-entry" title="concept-FormData-entry">entry</a> consists of a
<dfn id="concept-formdata-entry-name" title="concept-FormData-entry-name">name</dfn> and a
<dfn id="concept-formdata-entry-value" title="concept-FormData-entry-value">value</dfn>.

<p>For the purposes of interaction with other algorithms, an
<a href="#concept-formdata-entry" title="concept-FormData-entry">entry</a>'s type is "string" if its
<a href="#concept-formdata-entry-value" title="concept-FormData-entry-value">value</a> is a string and "file" otherwise. If
an <a href="#concept-formdata-entry" title="concept-FormData-entry">entry</a>'s type is "file", its filename is
the empty string if <a href="#concept-formdata-entry-value" title="concept-FormData-entry-value">value</a> is not
a <a href="https://w3c.github.io/FileAPI/#file"><code class="external" data-anolis-spec="fileapi">File</code></a> object, and otherwise its filename is the
value of <a href="#concept-formdata-entry" title="concept-FormData-entry">entry</a>'s
<a href="#concept-formdata-entry-value" title="concept-FormData-entry-value">value</a>'s
<a href="https://w3c.github.io/FileAPI/#dfn-name"><code class="external" data-anolis-spec="fileapi" title="dom-File-name">name</code></a> attribute.

<p>To <dfn id="create-an-entry">create an entry</dfn> for <var>name</var>, <var>value</var>, and optionally a
<var>filename</var>, run these steps:

<ol>
 <li><p>Let <var>entry</var> be a new <a href="#concept-formdata-entry" title="concept-FormData-entry">entry</a>.

 <li><p>Set <var>entry</var>'s <a href="#concept-formdata-entry-name" title="concept-FormData-entry-name">name</a> to
 <var>name</var>.

 <li><p>If <var>value</var> is a <a href="https://w3c.github.io/FileAPI/#blob"><code class="external" data-anolis-spec="fileapi">Blob</code></a> object and not a
 <a href="https://w3c.github.io/FileAPI/#file"><code class="external" data-anolis-spec="fileapi">File</code></a> object, then set <var>value</var> to a new
 <a href="https://w3c.github.io/FileAPI/#file"><code class="external" data-anolis-spec="fileapi">File</code></a> object, representing the same bytes, whose
 <a href="https://w3c.github.io/FileAPI/#dfn-name"><code class="external" data-anolis-spec="fileapi" title="dom-File-name">name</code></a> attribute value is
 "<code title="">blob</code>".
 <!-- XXX at some point File API should get internal slots for this -->

 <li><p>If <var>value</var> is (now) a <a href="https://w3c.github.io/FileAPI/#file"><code class="external" data-anolis-spec="fileapi">File</code></a> object and
 <var title="">filename</var> is given, then set <var>value</var> to a new
 <a href="https://w3c.github.io/FileAPI/#file"><code class="external" data-anolis-spec="fileapi">File</code></a> object, representing the same bytes, whose
 <a href="https://w3c.github.io/FileAPI/#dfn-name"><code class="external" data-anolis-spec="fileapi" title="dom-File-name">name</code></a> attribute value is
 <var>filename</var>.

 <li><p>Set <var>entry</var>'s <a href="#concept-formdata-entry-value" title="concept-FormData-entry-value">value</a> to
 <var>value</var>.

 <li><p>Return <var>entry</var>.
</ol>

<hr>

<p>The
<dfn id="dom-formdata" title="dom-FormData"><code>FormData(<var>form</var>)</code></dfn>
constructor must run these steps:

<ol>
 <li><p>Let <var title="">fd</var> be a new <a href="#formdata"><code>FormData</code></a> object.

 <li><p>If <var>form</var> is given, set <var title="">fd</var>'s
 <a href="#concept-formdata-entry" title="concept-FormData-entry">entries</a> to the result of
 <a class="external" data-anolis-spec="html" href="https://html.spec.whatwg.org/multipage/forms.html#constructing-form-data-set">constructing the form data set</a> for <var>form</var>.

 <li><p>Return <var title="">fd</var>.
</ol>

<p>The
<dfn id="dom-formdata-append" title="dom-FormData-append"><code>append(<var>name</var>, <var>value</var>, <var>filename</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>Let <var>entry</var> be the result of <a href="#create-an-entry" title="create an entry">creating an entry</a>
 with <var>name</var>, <var>value</var>, and <var>filename</var> if given.

 <li><p>Append <var>entry</var> to <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#context-object">context object</a>'s list of
 <a href="#concept-formdata-entry" title="concept-FormData-entry">entries</a>.
</ol>

<p>The
<dfn id="dom-formdata-delete" title="dom-FormData-delete"><code>delete(<var>name</var>)</code></dfn>
method, when invoked, must remove all <a href="#concept-formdata-entry" title="concept-FormData-entry">entries</a>
whose <a href="#concept-formdata-entry-name" title="concept-FormData-entry-name">name</a> is <var>name</var>.

<p>The <dfn id="dom-formdata-get" title="dom-FormData-get"><code>get(<var>name</var>)</code></dfn> method, when
invoked, must return the <a href="#concept-formdata-entry-value" title="concept-FormData-entry-value">value</a> of the first
<a href="#concept-formdata-entry" title="concept-FormData-entry">entry</a> whose
<a href="#concept-formdata-entry-name" title="concept-FormData-entry-name">name</a> is <var>name</var>, and null
otherwise.

<p>The <dfn id="dom-formdata-getall" title="dom-FormData-getAll"><code>getAll(<var>name</var>)</code></dfn> method,
when invoked, must return the <a href="#concept-formdata-entry-value" title="concept-FormData-entry-value">values</a> of
all <a href="#concept-formdata-entry" title="concept-FormData-entry">entries</a> whose
<a href="#concept-formdata-entry-name" title="concept-FormData-entry-name">name</a> is <var>name</var>, in list order, and
the empty sequence otherwise.

<p>The <dfn id="dom-formdata-has" title="dom-FormData-has"><code>has(<var>name</var>)</code></dfn> method, when
invoked, must return true if there is an <a href="#concept-formdata-entry" title="concept-FormData-entry">entry</a>
whose <a href="#concept-formdata-entry-name" title="concept-FormData-entry-name">name</a> is <var>name</var>, and false
otherwise.

<p>The
<dfn id="dom-formdata-set" title="dom-FormData-set"><code>set(<var>name</var>, <var>value</var>, <var>filename</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>Let <var>entry</var> be the result of <a href="#create-an-entry" title="create an entry">creating an entry</a>
 with <var>name</var>, <var>value</var>, and <var>filename</var> if given.

 <li><p>If there are any <a href="#concept-formdata-entry" title="concept-FormData-entry">entries</a> in
 <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#context-object">context object</a>'s list of
 <a href="#concept-formdata-entry" title="concept-FormData-entry">entries</a> whose
 <a href="#concept-formdata-entry-name" title="concept-FormData-entry-name">name</a> is <var>name</var>, then replace the first such
 <a href="#concept-formdata-entry" title="concept-FormData-entry">entry</a> with <var>entry</var> and remove the others.

 <li><p>Otherwise, append <var>entry</var> to <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#context-object">context object</a>'s
 list of <a href="#concept-formdata-entry" title="concept-FormData-entry">entries</a>.
</ol>

<p>The <a class="external" data-anolis-spec="webidl" href="https://heycam.github.io/webidl/#dfn-value-pairs-to-iterate-over">value pairs to iterate over</a> are the
<a href="#concept-formdata-entry" title="concept-FormData-entry">entries</a> with the key being the
<a href="#concept-formdata-entry-name" title="concept-FormData-entry-name">name</a> and the value the
<a href="#concept-formdata-entry-value" title="concept-FormData-entry-value">value</a>.



<h2 id="interface-progressevent"><span class="secno">6 </span>Interface <code title="">ProgressEvent</code></h2>

<pre class="idl">[<a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-constructor" title="concept-event-constructor">Constructor</a>(DOMString <var title="">type</var>, optional <a href="#progresseventinit">ProgressEventInit</a> <var title="">eventInitDict</var>),
 Exposed=(Window,DedicatedWorker,SharedWorker)]
interface <dfn id="progressevent">ProgressEvent</dfn> : <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#event">Event</a> {
  readonly attribute boolean <a href="#dom-progressevent-lengthcomputable" title="dom-ProgressEvent-lengthComputable">lengthComputable</a>;
  readonly attribute unsigned long long <a href="#dom-progressevent-loaded" title="dom-ProgressEvent-loaded">loaded</a>;
  readonly attribute unsigned long long <a href="#dom-progressevent-total" title="dom-ProgressEvent-total">total</a>;
};

dictionary <dfn id="progresseventinit">ProgressEventInit</dfn> : <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#eventinit">EventInit</a> {
  boolean <span title="dom-ProgressEventInit-lengthComputable">lengthComputable</span> = false;
  unsigned long long <span title="dom-ProgressEventInit-loaded">loaded</span> = 0;
  unsigned long long <span title="dom-ProgressEventInit-total">total</span> = 0;
};</pre>

<p><a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event" title="concept-event">Events</a> using
the <a href="#progressevent"><code>ProgressEvent</code></a> interface indicate some kind of
progression.

<p>The
<dfn id="dom-progressevent-lengthcomputable" title="dom-ProgressEvent-lengthComputable"><code>lengthComputable</code></dfn>,
<dfn id="dom-progressevent-loaded" title="dom-ProgressEvent-loaded"><code>loaded</code></dfn>, and
<dfn id="dom-progressevent-total" title="dom-ProgressEvent-total"><code>total</code></dfn>
attributes must return the value they were initialized to.


<h3 id="firing-events-using-the-progressevent-interface"><span class="secno">6.1 </span>Firing events using the <code title="">ProgressEvent</code> interface</h3>

<p>To
<dfn id="concept-event-fire-progress" title="concept-event-fire-progress">fire a progress event named <var>e</var></dfn>
given <var title="">transmitted</var> and <var title="">length</var>,
<a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-fire" title="concept-event-fire">fire an event named <var>e</var></a>
with an <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event" title="concept-event">event</a>
using the <a href="#progressevent"><code>ProgressEvent</code></a> interface that also meets these
conditions:

<ul class="brief">
 <li><p>Set the <a href="#dom-progressevent-loaded"><code title="dom-ProgressEvent-loaded">loaded</code></a> attribute value to
 <var title="">transmitted</var>.

 <li><p>If <var title="">length</var> is not 0, set the
 <a href="#dom-progressevent-lengthcomputable"><code title="dom-ProgressEvent-lengthComputable">lengthComputable</code></a> attribute value to
 true and the <a href="#dom-progressevent-total"><code title="dom-ProgressEvent-total">total</code></a> attribute value to
 <var title="">length</var>.
</ul>


<h3 id="suggested-names-for-events-using-the-progressevent-interface"><span class="secno">6.2 </span>Suggested names for events using the <code title="">ProgressEvent</code> interface</h3>

<p><em>This section is non-normative.</em>

<p>The suggested <a href="https://dom.spec.whatwg.org/#dom-event-type"><code class="external" data-anolis-spec="dom" title="dom-Event-type">type</code></a>
attribute values for use with
<a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event" title="concept-event">events</a> using the
<a href="#progressevent"><code>ProgressEvent</code></a> interface are summarized in the table below.
Specification editors are free to tune the details to their specific
scenarios, though are strongly encouraged to discuss their usage with the
WHATWG community to ensure input from people familiar with the subject.

<table>
 <tbody>
  <tr>
   <th><a href="https://dom.spec.whatwg.org/#dom-event-type"><code class="external" data-anolis-spec="dom" title="dom-Event-type">type</code></a> attribute value
   <th>Description
   <th>Times
   <th>When
  <tr>
   <th><code title="">loadstart</code>
   <td>Progress has begun.
   <td>Once.
   <td>First.
  <tr>
   <th><code title="">progress</code>
   <td>In progress.
   <td>Once or more.
   <td>After <code title="">loadstart</code> has been
    <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-dispatch" title="concept-event-dispatch">dispatched</a>.
  <tr>
   <th><code title="">error</code>
   <td>Progression failed.
   <td rowspan="4">Zero or once (mutually exclusive).
   <td rowspan="4">After the last <code title="">progress</code> has
    been
    <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-dispatch" title="concept-event-dispatch">dispatched</a>.
  <tr>
   <th><code>abort</code>
   <td>Progression is terminated.
  <tr>
   <th><code title="">timeout</code>
   <td>Progression is terminated due to preset time expiring.
  <tr>
   <th><code>load</code>
   <td>Progression is successful.
  <tr>
   <th><code title="">loadend</code>
   <td>Progress has stopped.
   <td>Once.</td>
   <td>After one of <code title="">error</code>, <code title="">abort</code>,
    <code title="">timeout</code> or <code title="">load</code> has been
    <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-dispatch" title="concept-event-dispatch">dispatched</a>.
</table>

<p>The <code title="">error</code>, <code title="">abort</code>, <code title="">timeout</code>, and
<code title="">load</code> event types are mutually exclusive.

<p>Throughout the web platform the <code title="">error</code>, <code title="">abort</code>,
<code title="">timeout</code> and <code title="">load</code> event types have
their <a href="https://dom.spec.whatwg.org/#dom-event-bubbles"><code class="external" data-anolis-spec="dom" title="dom-Event-bubbles">bubbles</code></a> and
<a href="https://dom.spec.whatwg.org/#dom-event-cancelable"><code class="external" data-anolis-spec="dom" title="dom-Event-cancelable">cancelable</code></a>
attributes initialized to false, so it is suggested that for consistency all
<a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event" title="concept-event">events</a> using the
<a href="#progressevent"><code>ProgressEvent</code></a> interface do the same.


<h3 id="security-considerations"><span class="secno">6.3 </span>Security Considerations</h3>

<p>For cross-origin requests some kind of opt-in, e.g. the
<a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#cors-protocol">CORS protocol</a> defined in the Fetch Standard, has to be
used before <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event" title="concept-event">events</a> using the
<a href="#progressevent"><code>ProgressEvent</code></a> interface are
<a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#concept-event-dispatch" title="concept-event-dispatch">dispatched</a>
as information (e.g. size) would be revealed that cannot be obtained
otherwise. <a class="informative" href="#refsFETCH">[FETCH]</a>


<h3 id="example"><span class="secno">6.4 </span>Example</h3>

<div class="example">
 <p>In this example <a href="#xmlhttprequest"><code>XMLHttpRequest</code></a>, combined with concepts
 defined in the sections before, and the HTML
 <a href="https://html.spec.whatwg.org/multipage/forms.html#the-progress-element"><code class="external" data-anolis-spec="html">progress</code></a> element are used together to
 display the process of
 <a class="external" data-anolis-spec="fetch" href="https://fetch.spec.whatwg.org/#concept-fetch" title="concept-fetch">fetching</a> a resource.

 <pre>&lt;!DOCTYPE html&gt;
&lt;title&gt;Waiting for Magical Unicorns&lt;/title&gt;
&lt;progress id=p&gt;&lt;/progress&gt;
&lt;script&gt;
  var progressBar = document.getElementById("p"),
      client = new XMLHttpRequest()
  client.open("GET", "magical-unicorns")
  client.onprogress = function(pe) {
    if(pe.lengthComputable) {
      progressBar.max = pe.total
      progressBar.value = pe.loaded
    }
  }
  client.onloadend = function(pe) {
    progressBar.value = pe.loaded
  }
  client.send()
&lt;/script&gt;</pre>

 <p>Fully working code would of course be more elaborate and deal with more
 scenarios, such as network errors or the end user terminating the request.
</div>



<h2 class="no-num" id="references">References</h2>
<div id="anolis-references"><dl><dt id="refsCOOKIES">[COOKIES]
<dd><cite><a href="https://tools.ietf.org/html/rfc6265">HTTP State Management Mechanism</a></cite>, Adam Barth. IETF.

<dt id="refsDOM">[DOM]
<dd><cite><a href="https://dom.spec.whatwg.org/">DOM</a></cite>, Anne van Kesteren, Aryeh Gregor and Ms2ger. WHATWG.

<dt id="refsDOMPS">[DOMPS]
<dd><cite><a href="https://dvcs.w3.org/hg/innerhtml/raw-file/tip/index.html">DOM Parsing and Serialization</a></cite>, Travis Leithead. W3C.

<dt id="refsECMASCRIPT">[ECMASCRIPT]
<dd><cite><a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript Language Specification</a></cite>. ECMA.

<dt id="refsENCODING">[ENCODING]
<dd><cite><a href="https://encoding.spec.whatwg.org/">Encoding</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsFETCH">[FETCH]
<dd><cite><a href="https://fetch.spec.whatwg.org/">Fetch</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsFILEAPI">[FILEAPI]
<dd><cite><a href="https://w3c.github.io/FileAPI/">File API</a></cite>, Arun Ranganathan and Jonas Sicking. W3C.

<dt id="refsHTML">[HTML]
<dd><cite><a href="https://html.spec.whatwg.org/multipage/">HTML</a></cite>, Ian Hickson. WHATWG.

<dt id="refsHTTP">[HTTP]
<dd><cite><a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a></cite>, Roy Fielding and Julian Reschke. IETF.

<dd><cite><a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a></cite>, Roy Fielding and Julian Reschke. IETF.

<dd><cite><a href="https://tools.ietf.org/html/rfc7232">Hypertext Transfer Protocol (HTTP/1.1): Conditional Requests</a></cite>, Roy Fielding and Julian Reschke. IETF.

<dd><cite><a href="https://tools.ietf.org/html/rfc7234">Hypertext Transfer Protocol (HTTP/1.1): Caching</a></cite>, Roy Fielding and Julian Reschke. IETF.

<dd><cite><a href="https://tools.ietf.org/html/rfc7235">Hypertext Transfer Protocol (HTTP/1.1): Authentication</a></cite>, Roy Fielding and Julian Reschke. IETF.

<dt id="refsRFC2119">[RFC2119]
<dd><cite><a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a></cite>, Scott Bradner. IETF.

<dt id="refsURL">[URL]
<dd><cite><a href="https://url.spec.whatwg.org/">URL</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsWEBIDL">[WEBIDL]
<dd><cite><a href="https://heycam.github.io/webidl/">Web IDL</a></cite>, Cameron McCormack. W3C.

<dt id="refsXML">[XML]
<dd><cite><a href="https://www.w3.org/TR/xml/">Extensible Markup Language</a></cite>, Tim Bray, Jean Paoli, C. M. Sperberg-McQueen et al.. W3C.

<dt id="refsXMLNS">[XMLNS]
<dd><cite><a href="https://www.w3.org/TR/xml-names/">Namespaces in XML</a></cite>, Tim Bray, Dave Hollander, Andrew Layman et al.. W3C.

</dl></div>



<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

<p>Thanks to
Addison Phillips,
Adrian Bateman,
Ahmed Kamel,
Alan Thomas,
Alex Hopmann,
Alex Vincent,
Alexey Proskuryakov,
Andrea Marchesini,
Asbjørn Ulsberg,
Boris Zbarsky,
Björn Höhrmann,
Caitlin Potter,
Cameron McCormack,
Chris Marrin,
Christophe Jolif,
Charles McCathieNevile,
Dan Winship,
David Andersson,
David Flanagan,
David Håsäther,
David Levin,
Dean Jackson,
Denis Sureau,
Domenic Denicola,
Dominik Röttsches,
Doug Schepers,
Douglas Livingstone,
Elliott Sprehn,
Elliotte Harold,
Eric Lawrence,
Eric Uhrhane,
Erik Arvidsson,
Erik Dahlström,
Feras Moussa,
Geoffrey Sneddon,
Gideon Cohn,
Glenn Adams,
Gorm Haug Eriksen,
Håkon Wium Lie,
Hallvord R. M. Steen,
Henri Sivonen,
Hiroshige Hayashizaki,
Huub Schaeks,
Ian Davis,
Ian Hickson,
Ivan Herman,
Jake Archibald,
Jared Jacobs,
Jarred Nicholls,
Jeff Walden,
Jens Lindström,
Jim Deegan,
Jim Ley,
Joe Farro,
Jonas Sicking,
Julian Reschke,
송정기 (Jungkee Song),
呂康豪 (Kang-Hao Lu),
Karl Dubost,
Keith Yeung,
Lachlan Hunt,
Maciej Stachowiak,
Magnus Kristiansen,
Manish Goregaokar,
Marc Hadley,
Marcos Caceres,
Mark Baker,
Mark Birbeck,
Mark Nottingham,
Mark S. Miller,
Martin Hassman,
Mohamed Zergaoui,
Ms2ger,
Odin Hørthe Omdal,
Olli Pettay,
Pawel Glowacki,
Peter Michaux,
Philip Jägenstedt,
Philip Taylor,
Robin Berjon,
Rune <span title="Fabulous">F.</span> Halvorsen,
Ruud Steltenpool,
Sergiu Dumitriu,
Shivakumar Jagalur Matt,
Sigbjørn Finne,
Simon Pieters,
Stewart Brodie,
Sunava Dutta,
Takeshi Kurosawa,
Takeshi Yoshino,
Thomas Roessler,
Thomas Wisniewski,
Tom Magliery,
Travis Leithead,
Yehuda Katz,
Youenn Fablet, and
Zhenbin Xu
for their contributions to this standard.

<p>Special thanks to the Microsoft employees who first implemented the
<code title="">XMLHttpRequest</code> interface, which was first widely deployed by the
Windows Internet Explorer browser.

<p>Special thanks to Ian Hickson for drafting an initial version of this specification in
the HTML Standard (then Web Applications 1.0). <a href="#refsHTML">[HTML]</a>

<p>Special thanks to the W3C SVG WG for drafting the original
<a href="#progressevent"><code>ProgressEvent</code></a> class as part of the
<a href="https://www.w3.org/TR/2008/REC-SVGTiny12-20081222/svgudom.html">SVG Micro DOM</a>.

<p>This standard is written by
<a href="https://annevankesteren.nl/" lang="nl">Anne van Kesteren</a>
(<a href="https://www.mozilla.org/">Mozilla</a>,
<a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>).

<p>Per <a href="https://creativecommons.org/publicdomain/zero/1.0/" rel="license">CC0</a>, to
the extent possible under law, the editor has waived all copyright and related or
neighboring rights to this work.
