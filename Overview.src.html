<!doctype html>
<html lang=en-US>
<meta charset=utf-8>
<title>XMLHttpRequest Standard</title>
<link href=http://www.whatwg.org/style/specification rel=stylesheet>
<link href=http://resources.whatwg.org/logo-xhr.svg rel=icon>

<div class="head">

<p><a class=logo href=//www.whatwg.org/><img alt=WHATWG src=//resources.whatwg.org/logo-xhr.svg width=100 height=100></a>
<h1 class="head" id="xmlhttprequest-ls">XMLHttpRequest</h1>
<h2 class="no-num no-toc">Living Standard &mdash; Last Updated [DATE: 3 August 2002]</h2>

<dl>
 <dt>This Version:
 <dd><a href=http://xhr.spec.whatwg.org/>http://xhr.spec.whatwg.org/</a>

 <dt>Participate:
 <dd>Send feedback to
  <a href="mailto:public-webapps@w3.org?subject==%5Bxhr%5D%20">public-webapps@w3.org</a>
  (<a href="http://lists.w3.org/Archives/Public/public-webapps/">archives</a>) or
  <a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WebAppsWG&amp;component=XHR">file a bug</a>
  (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WebAppsWG&amp;component=XHR&amp;resolution=---">open bugs</a>)

 <dd><a href="http://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Version History:
 <dd><a href=https://github.com/whatwg/xhr/commits>https://github.com/whatwg/xhr/commits</a>

 <dt>Editor:
 <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
  (<a href=http://www.mozilla.org/>Mozilla</a>)
  &lt;<a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>>
</dl>

<script src=//resources.whatwg.org/file-bug.js async></script>

<p class=copyright><a rel=license href="http://creativecommons.org/publicdomain/zero/1.0/"><img src="http://i.creativecommons.org/p/zero/1.0/80x15.png" alt=CC0></a>
To the extent possible under law, the editor has waived all copyright and
related or neighboring rights to this work. In addition, as of
[DATE: 01 Jan 1901], the editor has made this specification available
under the
<a rel=license
href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0">Open Web Foundation Agreement Version 1.0</a>,
which is available at
http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.

</div>



<h2 class="no-num no-toc" id="specabstract">Abstract</h2>

<p>The XMLHttpRequest specification defines an API that provides scripted
client functionality for transferring data between a client and a server.



<h2 class="no-num no-toc" id="toc">Table of Contents</h2>

<!--toc-->



<h2 id="introduction">Introduction</h2>

<p><em>This section is non-normative.</em>

<p>The <code>XMLHttpRequest</code> object is an API for
<span data-anolis-spec=html title=fetch>fetching</span> resources.

<p>The name <code>XMLHttpRequest</code> is historical and has no baring on its
functionality.

<div class="example">
 <p>Some simple code to do something with data from an XML document
 fetched over the network:

 <pre><code>function processData(data) {
  // taking care of data
}

function handler() {
  if(this.readyState == this.DONE) {
    if(this.status == 200 &amp;&amp;
       this.responseXML != null &amp;&amp;
       this.responseXML.getElementById('test').textContent) {
      // success!
      processData(this.responseXML.getElementById('test').textContent);
      return;
    }
    // something went wrong
    processData(null);
  }
}

var client = new XMLHttpRequest();
client.onreadystatechange = handler;
client.open("GET", "unicorn.xml");
client.send();</code></pre>

 <p>If you just want to log a message to the server:

 <pre><code>function log(message) {
  var client = new XMLHttpRequest();
  client.open("POST", "/log");
  client.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
  client.send(message);
}</code></pre>

 <p>Or if you want to check the status of a document on the server:

 <pre><code>function fetchStatus(address) {
  var client = new XMLHttpRequest();
  client.onreadystatechange = function() {
    // in case of network errors this might not give reliable results
    if(this.readyState == this.DONE)
      returnStatus(this.status);
  }
  client.open("HEAD", address);
  client.send();
}</code></pre>
</div>


<h3>Specification history</h3>

<p>The <code>XMLHttpRequest</code> object was initially defined as part of
the WHATWG's HTML effort. (Long after Microsoft shipped an implementation.)
It moved to the W3C in 2006. Extensions (e.g. progress events and
cross-origin requests) to <code>XMLHttpRequest</code> were developed in a
separate draft (XMLHttpRequest Level 2) until end of 2011, at which point
the two drafts were merged and <code>XMLHttpRequest</code> became a single
entity again from a standards perspective. End of 2012 it moved back to the
WHATWG.

<p>Historical discussion can be found in the following mailing list
archives:

<ul>
 <li><a href="http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/">whatwg@whatwg.org</a>
 <li><a href="http://lists.w3.org/Archives/Public/public-webapi/">public-webapi@w3.org</a>
 <li><a href="http://lists.w3.org/Archives/Public/public-appformats/">public-appformats@w3.org</a>
 <li><a href="http://lists.w3.org/Archives/Public/public-webapps/">public-webapps@w3.org</a>
</ul>



<h2 id="conformance">Conformance</h2>

<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<span data-anolis-ref>RFC2119</span>


<h3 id="extensibility">Extensibility</h3>

<p>User agents, Working Groups, and other interested parties are
<em>strongly encouraged</em> to discuss new features with the WHATWG
community.



<h2 id="terminology">Terminology</h2>

<p>This specification heavily borrows terminology, from
Cross-Origin Resource Sharing, DOM, DOM Parsing and Serialization, Encoding,
File API, HTML, HTTP, Typed Array, URL, Web IDL, and XML.

<span data-anolis-ref>CORS</span>
<span data-anolis-ref>DOM</span>
<span data-anolis-ref>DOMPS</span>
<span data-anolis-ref>ENCODING</span>
<span data-anolis-ref>FILEAPI</span>
<span data-anolis-ref>HTML</span>
<span data-anolis-ref>HTTP</span>
<span data-anolis-ref>TYPEDARRAY</span>
<span data-anolis-ref>URL</span>
<span data-anolis-ref>WEBIDL</span>
<span data-anolis-ref>XML</span> <span data-anolis-ref>XMLNS</span>

<p>The term <dfn>user credentials</dfn> for the purposes of this
specification means cookies, HTTP authentication, and client-side SSL
certificates. Specifically it does not refer to proxy authentication or the
<code title="http-origin">Origin</code> header.
<span data-anolis-ref>COOKIES</span> <!-- XXX ref? -->



<h2>Interface <code title>XMLHttpRequest</code></h2>

<pre class="idl">[NoInterfaceObject]
interface <dfn id="xmlhttprequesteventtarget">XMLHttpRequestEventTarget</dfn> : <span data-anolis-spec=dom>EventTarget</span> {
  // <a href="#event-handlers">event handlers</a>
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onloadstart">onloadstart</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onprogress">onprogress</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onabort">onabort</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onerror">onerror</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onload">onload</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-ontimeout">ontimeout</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onloadend">onloadend</span>;
};

interface <dfn id="xmlhttprequestupload">XMLHttpRequestUpload</dfn> : <span>XMLHttpRequestEventTarget</span> {
};

enum <dfn>XMLHttpRequestResponseType</dfn> {
  "",
  "arraybuffer",
  "blob",
  "document",
  "json",
  "text"
};

dictionary <dfn>XMLHttpRequestOptions</dfn> {
  boolean anon = false;
};

[<span title="dom-XMLHttpRequest">Constructor</span>(optional <span>XMLHttpRequestOptions</span> <var title>options</var>)]
interface <dfn id="xmlhttprequest">XMLHttpRequest</dfn> : <span>XMLHttpRequestEventTarget</span> {
  // <a href="#event-handlers">event handler</a>
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onreadystatechange">onreadystatechange</span>;

  // <a href="#states">states</a>
  const unsigned short <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span> = 0;
  const unsigned short <span title="dom-XMLHttpRequest-OPENED">OPENED</span> = 1;
  const unsigned short <span title="dom-XMLHttpRequest-HEADERS_RECEIVED">HEADERS_RECEIVED</span> = 2;
  const unsigned short <span title="dom-XMLHttpRequest-LOADING">LOADING</span> = 3;
  const unsigned short <span title="dom-XMLHttpRequest-DONE">DONE</span> = 4;
  readonly attribute unsigned short <span title="dom-XMLHttpRequest-readyState">readyState</span>;

  // <a href="#request">request</a>
  void <span title="dom-XMLHttpRequest-open">open</span>(ByteString <var>method</var>, DOMString <var title>url</var>, optional boolean <var>async</var> = true, optional DOMString? <var>username</var> = null, optional DOMString? <var>password</var> = null);
  void <span title="dom-XMLHttpRequest-setRequestHeader">setRequestHeader</span>(ByteString <var>header</var>, ByteString <var>value</var>);
           attribute unsigned long <span title="dom-XMLHttpRequest-timeout">timeout</span>;
           attribute boolean <span title="dom-XMLHttpRequest-withCredentials">withCredentials</span>;
  readonly attribute <span>XMLHttpRequestUpload</span> <span title="dom-XMLHttpRequest-upload">upload</span>;
  void <span title="dom-XMLHttpRequest-send">send</span>(optional (<span data-anolis-spec=typedarray>ArrayBufferView</span> or <span data-anolis-spec=fileapi>Blob</span> or <span data-anolis-spec=dom>Document</span> or DOMString or <span>FormData</span>)? <var>data</var> = null);
  void <span title="dom-XMLHttpRequest-abort">abort</span>();

  // <a href="#response">response</a>
  readonly attribute unsigned short <span title="dom-XMLHttpRequest-status">status</span>;
  readonly attribute ByteString <span title="dom-XMLHttpRequest-statusText">statusText</span>;
  ByteString? <span title="dom-XMLHttpRequest-getResponseHeader">getResponseHeader</span>(ByteString <var>header</var>);
  ByteString <span title="dom-XMLHttpRequest-getAllResponseHeaders">getAllResponseHeaders</span>();
  void <span title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType</span>(DOMString <var>mime</var>);
           attribute <span>XMLHttpRequestResponseType</span> <span title="dom-XMLHttpRequest-responseType">responseType</span>;
  readonly attribute any <span title="dom-XMLHttpRequest-response">response</span>;
  readonly attribute DOMString <span title="dom-XMLHttpRequest-responseText">responseText</span>;
  readonly attribute <span data-anolis-spec=dom>Document</span>? <span title="dom-XMLHttpRequest-responseXML">responseXML</span>;
};</pre>

<p>Each <code>XMLHttpRequest</code> object has a unique, associated
<code>XMLHttpRequestUpload</code> object.


<h3>Task sources</h3>

<p>Each <code>XMLHttpRequest</code> object has its own
<span data-anolis-spec=html>task source</span>. Namely, the
<dfn><code>XMLHttpRequest</code> task source</dfn>.


<h3 id="constructors">Constructors</h3>

<p>The <code>XMLHttpRequest</code> object has an associated
<dfn>anonymous flag</dfn>. If the <span>anonymous flag</span> is set,
<span>user credentials</span> and the
<span>source origin</span> are not exposed when
<span data-anolis-spec=html title=fetch>fetching</span> resources.

<p>When the <span data-anolis-spec=html>JavaScript global environment</span>
is a <span data-anolis-spec=html>document environment</span>, the
<code>XMLHttpRequest</code> object has an associated
<dfn title=concept-XMLHttpRequest-document>document</dfn>.

<dl class=domintro>
 <dt><code><var title>client</var> = new <span title=dom-XMLHttpRequest>XMLHttpRequest</span>()</code>
 <dd>Returns a new <code>XMLHttpRequest</code> object.

 <dt><code><var title>client</var> = new <span title=dom-XMLHttpRequest>XMLHttpRequest</span>({anon:true})</code>
 <dd>Returns a new <code>XMLHttpRequest</code> object that has its
 <span>anonymous flag</span> set.
</dl>

<p>The
<dfn title="dom-XMLHttpRequest"><code>XMLHttpRequest(<var title>options</var>)</code></dfn>
constructor must run these steps:

<ol>
 <li><p>Let <var title>xhr</var> be a new <code>XMLHttpRequest</code>
 object.

 <li><p>If <var title>options</var>'s <code title>anon</code> member is
 true, set <var title>xhr</var>'s <span>anonymous flag</span>.

 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>document environment</span>, set
 <span title=concept-XMLHttpRequest-document>document</span> to the
 <span data-anolis-spec=dom title=concept-document>document</span>
 associated with the global object of <var title>xhr</var>'s interface
 object.

 <li><p>Return <var title>xhr</var>.
</ol>


<h3>Garbage collection</h3>
<!-- Based on EventSource and WebSocket. Not sure what I am doing. -->

<p>An <code>XMLHttpRequest</code> object must not be garbage collected if
its state is <span title=dom-XMLHttpRequest-OPENED>OPENED</span> and the
<span><code>send()</code> flag</span> is set, its state is
<span title=dom-XMLHttpRequest-HEADERS_RECEIVED>HEADERS_RECEIVED</span>, or
its state is <span title=dom-XMLHttpRequest-LOADING>LOADING</span>, and
one of the following is true:

<ul>
 <li><p>It has one or more
 <span data-anolis-spec=dom title=concept-event-listener>event listeners</span>
 registered whose <b>type</b> is
 <code title=event-xhr-readystatechange>readystatechange</code>,
 <code title=event-xhr-progress>progress</code>,
 <code title=event-xhr-abort>abort</code>,
 <code title=event-xhr-error>error</code>,
 <code title=event-xhr-load>load</code>,
 <code title=event-xhr-timeout>timeout</code>, or
 <code title=event-xhr-loadend>loadend</code>.
 <li><p>The <span>upload complete flag</span> is unset and the associated
 <code>XMLHttpRequestUpload</code> object has one or more
 <span data-anolis-spec=dom title=concept-event-listener>event listeners</span>
 registered whose <b>type</b> is
 <code title=event-xhr-progress>progress</code>,
 <code title=event-xhr-abort>abort</code>,
 <code title=event-xhr-error>error</code>,
 <code title=event-xhr-load>load</code>,
 <code title=event-xhr-timeout>timeout</code>, or
 <code title=event-xhr-loadend>loadend</code>.
</ul>

<p>If an <code>XMLHttpRequest</code> object is garbage collected while its
connection is still open, the user agent must cancel any instance of the
<span data-anolis-spec=html>fetch</span> algorithm opened by this object,
discarding any <span data-anolis-spec=html title=concept-task>tasks</span>
<span data-anolis-spec=html title="queue a task">queued</span> for them, and
discarding any further data received from the network for them.


<h3 id="event-handlers">Event handlers</h3>

<p>The following are the
<span data-anolis-spec=html>event handlers</span> (and their corresponding
<span data-anolis-spec=html title="event handler event type">event handler event types</span>)
that must be supported on objects implementing an interface that inherits
from <code>XMLHttpRequestEventTarget</code> as attributes:

<table>
 <thead>
	<tr>
	 <th><span data-anolis-spec=html title="event handlers">event handler</span>
	 <th><span data-anolis-spec=html>event handler event type</span>
 <tbody>
	<tr>
	 <td><dfn title="handler-xhr-onloadstart"><code>onloadstart</code></dfn>
	 <td><code title="event-xhr-loadstart">loadstart</code>
	<tr>
	 <td><dfn title="handler-xhr-onprogress"><code>onprogress</code></dfn>
	 <td><code title="event-xhr-progress">progress</code>
	<tr>
	 <td><dfn title="handler-xhr-onabort"><code>onabort</code></dfn>
	 <td><code title="event-xhr-abort">abort</code>
	<tr>
	 <td><dfn title="handler-xhr-onerror"><code>onerror</code></dfn>
	 <td><code title="event-xhr-error">error</code>
	<tr>
	 <td><dfn title="handler-xhr-onload"><code>onload</code></dfn>
	 <td><code title="event-xhr-load">load</code>
	<tr>
	 <td><dfn title="handler-xhr-ontimeout"><code>ontimeout</code></dfn>
	 <td><code title="event-xhr-timeout">timeout</code>
	<tr>
	 <td><dfn title="handler-xhr-onloadend"><code>onloadend</code></dfn>
	 <td><code title="event-xhr-loadend">loadend</code>
</table>

<p>The following is the
<span data-anolis-spec=html title="event handlers">event handler</span>
(and its corresponding
<span data-anolis-spec=html>event handler event type</span>) that must be
supported as attribute solely by the
<code>XMLHttpRequest</code> object:

<table>
 <thead>
	<tr>
	 <th><span data-anolis-spec=html title="event handlers">event handler</span>
	 <th><span data-anolis-spec=html>event handler event type</span>
 <tbody>
	<tr>
	 <td><dfn title="handler-xhr-onreadystatechange"><code>onreadystatechange</code></dfn>
	 <td><code title="event-xhr-readystatechange">readystatechange</code></td>
</table>


<h3 id="states">States</h3>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title="dom-XMLHttpRequest-readyState">readyState</span></code>
 <dd><p>Returns the current state.
</dl>

<p>The <code>XMLHttpRequest</code> object can be in several states. The
<dfn title="dom-XMLHttpRequest-readyState"><code>readyState</code></dfn>
attribute must return the current state, which must be one of the
following values:

<dl>
 <dt><dfn title="dom-XMLHttpRequest-UNSENT"><code>UNSENT</code></dfn>
 (numeric value 0)</dt>
 <dd><p>The object has been constructed.</dd>

 <dt><dfn title="dom-XMLHttpRequest-OPENED"><code>OPENED</code></dfn>
 (numeric value 1)</dt>
 <dd><p>The <code title="dom-XMLHttpRequest-open">open()</code> method has been successfully invoked.
 During this state request headers can be set using
 <code title="dom-XMLHttpRequest-setRequestHeader">setRequestHeader()</code>
 and the request can be made using the
 <code title="dom-XMLHttpRequest-send">send()</code> method.</dd>

 <dt><dfn title="dom-XMLHttpRequest-HEADERS_RECEIVED"><code>HEADERS_RECEIVED</code></dfn>
 (numeric value 2)</dt>
 <dd><p>All redirects (if any) have been followed and all HTTP headers of
 the final response have been received. Several response members of the
 object are now available.</dd>

 <dt><dfn title="dom-XMLHttpRequest-LOADING"><code>LOADING</code></dfn>
 (numeric value 3)</dt>
 <dd><p>The <span>response entity body</span> is being received.</dd>

 <dt><dfn title="dom-XMLHttpRequest-DONE"><code>DONE</code></dfn>
 (numeric value 4)</dt>
 <dd><p>The data transfer has been completed or something went wrong
 during the transfer (e.g. infinite redirects).</dd>
</dl>

<p>The <dfn id="send-flag"><code>send()</code> flag</dfn> indicates
that the <code title="dom-XMLHttpRequest-send">send()</code> method has
been invoked. It is initially unset and is used during the
<span title="dom-XMLHttpRequest-OPENED">OPENED</span> state.

<p>The <dfn id="error-flag">error flag</dfn> indicates some type of
network error or fetch termination. It is initially unset.


<h3 id="request">Request</h3>

<p>Each <code>XMLHttpRequest</code> object has the following
request-associated concepts:

<dfn>request method</dfn>,
<dfn>request URL</dfn>,
<dfn id="author-request-headers">author request headers</dfn>,
<dfn>request entity body</dfn>,
<dfn>source origin</dfn>,
<dfn>referrer source</dfn>,
<dfn>synchronous flag</dfn>,
<dfn id="upload-complete-flag">upload complete flag</dfn>, and
<dfn id="upload-events-flag">upload events flag</dfn>.

<p>The <span>author request headers</span> is a list of HTTP header names
and corresponding header values. Comparisons against the HTTP header names
must be done in a case-insensitive manner. Initially it must be empty.

<p>The <span>request entity body</span> must initially be null.

<p>The <span>synchronous flag</span>,
<span>upload complete flag</span>, and
<span>upload events flag</span> must be initially unset.



<h4>The <code title>open()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-open>open</span>(<var title>method</var>, <var title>url</var> [, <var title>async</var> = true [, <var title>username</var> = null [, <var title>password</var> = null]]])</code>

 <dd>
	<p>Sets the <span>request method</span>, <span>request URL</span>, and
	<span>synchronous flag</span>.

	<p>Throws a "<code data-anolis-spec=dom>SyntaxError</code>" exception if
	either <var title>method</var> is not a valid HTTP method or
	<var title>url</var> cannot be parsed.

	<p>Throws a "<code data-anolis-spec=dom>SecurityError</code>" exception
	if <var title>method</var> is a case-insensitive match for
	<code>CONNECT</code>, <code>TRACE</code> or <code>TRACK</code>.

	<p>Throws an "<code data-anolis-spec=dom>InvalidAccessError</code>"
	exception if <var title>async</var> is false, the
	<span data-anolis-spec=html>JavaScript global environment</span> is a
	<span data-anolis-spec=html>document environment</span>, and either the
	<span>anonymous flag</span> is set, the
	<code title=dom-XMLHttpRequest-timeout>timeout</code> attribute is not
	zero, the
	<code title=dom-XMLHttpRequest-withCredentials>withCredentials</code>
	attribute is true, or the
	<code title=dom-XMLHttpRequest-responseType>responseType</code>
	attribute is not the empty string.
</dl>

<p>The
<dfn id="dom-xmlhttprequest-open" title="dom-XMLHttpRequest-open"><code>open(<var title>method</var>, <var title>url</var>, <var title>async</var>, <var title>username</var>, <var title>password</var>)</code></dfn>
method must run these steps (unless otherwise indicated):

<ol>
 <li><p>Let <var title>base</var> be null.

 <li>
  <p>If the <span data-anolis-spec=html>JavaScript global environment</span> is a
  <span data-anolis-spec=html>document environment</span>, run these steps:

  <ol>
   <li><p>If <span title=concept-XMLHttpRequest-document>document</span> is not
   <span data-anolis-spec=html>fully active</span>,
   <span data-anolis-spec=dom title=concept-throw>throw</span> an
   "<code data-anolis-spec=dom>InvalidStateError</code>" exception.

   <li><p>Set <var title>base</var> to the
   <span data-anolis-spec=html>document base URL</span> of
   <span title=concept-XMLHttpRequest-document>document</span>.

   <li><p>Set <span>source origin</span> to a globally unique identifier if the
   <span>anonymous flag</span> is set, and the <span data-anolis-spec=html>origin</span>
   of <span title=concept-XMLHttpRequest-document>document</span> otherwise.

   <li><p>Set <span>referrer source</span> to
   <span title=concept-XMLHttpRequest-document>document</span>.
  </ol>

 <li>
  <p>If the <span data-anolis-spec=html>JavaScript global environment</span> is a
  <span data-anolis-spec=html>worker environment</span>, run these steps:

  <ol>
   <li><p>Set <var title>base</var> to the
   <span data-anolis-spec=html>script's base URL</span>.

   <li><p>Set <span>source origin</span> to the
   <span data-anolis-spec=html title=concept-script>script</span>'s
   <span data-anolis-spec=html>origin</span>.

   <li><p>Set <span>referrer source</span> to the
   <span data-anolis-spec=html>script's referrer source</span>.
  </ol>

 <li><p>If <var>method</var> does not match the <span data-anolis-spec=http>Method</span>
 token production, <span data-anolis-spec=dom title=concept-throw>throw</span> a
 "<code data-anolis-spec=dom>SyntaxError</code>" exception.

 <li>
  <p>If <var>method</var> is a case-insensitive match for <code>CONNECT</code>,
  <code>DELETE</code>, <code>GET</code>, <code>HEAD</code>, <code>OPTIONS</code>,
  <code>POST</code>, <code>PUT</code>, <code>TRACE</code>, or <code>TRACK</code>, subtract
  0x20 from each byte in the range 0x61 (ASCII a) to 0x7A (ASCII z).

  <p class=note>If it does not match any of the above, it is passed
  through <em>literally</em>, including in the final request.
  <!-- WebKit (and supposedly Gecko) also uppercase: COPY, INDEX, LOCK,
  M-POST, MKCOL, MOVE, PROPFIND, PROPPATCH, and UNLOCK. -->

 <li>
  <p>If <var>method</var> is a case-sensitive match for <code>CONNECT</code>,
  <code>TRACE</code>, or <code>TRACK</code>,
  <span data-anolis-spec=dom title=concept-throw>throw</span> a
  "<code data-anolis-spec=dom>SecurityError</code>" exception.

  <p class=note>Allowing these methods would pose a security risk.
  <span data-anolis-ref>HTTPVERBSEC</span>

 <li><p>Let <var title>parsed URL</var> be the result of
 <span data-anolis-spec=url title=concept-url-parser>parsing</span> <var title>url</var>
 with <var title>base</var>.

 <li><p>If <var title>parsed URL</var> is failure,
 <span data-anolis-spec=dom title=concept-throw>throw</span> a
 "<code data-anolis-spec=dom>SyntaxError</code>" exception.

 <li>
  <p>If <var title>parsed URL</var>'s <span data-anolis-spec=url>relative flag</span> is
  set, run these substeps:

  <ol>
   <li><p>If the <var title>username</var> argument is not null, set
   <var title>parsed URL</var>'s
   <span data-anolis-spec=url title=concept-url-username>username</span> to
   <var>username</var>.

   <li><p>If the <var title>password</var> argument is not null, set
   <var title>parsed URL</var>'s
   <span data-anolis-spec=url title=concept-url-password>password</span> to
   <var>password</var>.
  </ol>

 <li><p>If <var>async</var> is false, the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>document environment</span>, and either the
 <span>anonymous flag</span> is set, the
 <code title=dom-XMLHttpRequest-timeout>timeout</code> attribute value is not zero, the
 <code title=dom-XMLHttpRequest-withCredentials>withCredentials</code> attribute value is
 true, or the <code title=dom-XMLHttpRequest-responseType>responseType</code> attribute
 value is not the empty string,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidAccessError</code>" exception.

 <li>
  <p>Set the <span>error flag</span>.

  <p class=note>This is meaningless unless the
  <code title=dom-XMLHttpRequest-send>send()</code> algorithm is running.

 <li><p>The user agent should cancel any network activity for which the object is
 responsible.
 <!-- we can hardly require it... -->

 <li><p>If there are any <span data-anolis-spec=html title=concept-task>tasks</span> from
 the object's <span><code>XMLHttpRequest</code> task source</span> in one of the
 <span data-anolis-spec=html title="task queue">task queues</span>, then remove them.

 <li>
  <p>Set variables associated with the object as follows:

  <ul>
   <li><p>Set <span>request method</span> to <var>method</var>.
   <li><p>Set <span>request URL</span> to <var title>parsed URL</var>.
   <li><p>If <var>async</var> is false, set the <span>synchronous flag</span>.
   <li><p>Set <span>author request headers</span> to the empty list.
   <li><p>Unset the <span><code>send()</code> flag</span>.
   <li><p>Set <span>response entity body</span> to null.
  </ul>

 <li><p>Change the state to <span title="dom-XMLHttpRequest-OPENED">OPENED</span>.

 <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.
</ol>



<h4>The <code title>setRequestHeader()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-setRequestHeader>setRequestHeader</span>(<var title>header</var>, <var title>value</var>)</code>

 <dd>
	<p>Appends an header to the list of
	<span>author request headers</span>, or if <var>header</var> is already
	in the list of <span>author request headers</span>, combines its value
	with <var>value</var>.

	<p>Throws an "<code data-anolis-spec=dom>InvalidStateError</code>"
	exception if the state is not
	<span title="dom-XMLHttpRequest-OPENED">OPENED</span> or if the
	<span><code>send()</code> flag</span> is set.

	<p>Throws a "<code data-anolis-spec=dom>SyntaxError</code>" exception if
	<var title>header</var> is not a valid HTTP header field name or if
	<var title>value</var> is not a valid HTTP header field value.
 </dd>
</dl>

<p class=note>As indicated in the algorithm below certain headers cannot
be set and are left up to the user agent. In addition there are certain
other headers the user agent will take control of if they are not set by
the author as indicated at the end of the
<code title="dom-XMLHttpRequest-send">send()</code> method section.


<p class=note>For non <span data-anolis-spec=html>same origin</span> requests using the HTTP
<code>GET</code> method a preflight request is made when headers other
than <code>Accept</code> and <code>Accept-Language</code> are set.


<p>The
<dfn id="dom-xmlhttprequest-setrequestheader" title="dom-XMLHttpRequest-setRequestHeader"><code>setRequestHeader(<var title>header</var>, <var title>value</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If the state is not <span title="dom-XMLHttpRequest-OPENED">OPENED</span>,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.

 <li><p>If the <span><code>send()</code> flag</span> is set,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.

 <li><p>If <var>header</var> does not match the
 <span data-anolis-spec=http>field-name</span> production,
 <span data-anolis-spec=dom title=concept-throw>throw</span> a
 "<code data-anolis-spec=dom>SyntaxError</code>" exception.

 <li>
	<p>If <var>value</var> does not match the
	<span data-anolis-spec=http>field-value</span> production,
	<span data-anolis-spec=dom title=concept-throw>throw</span> a
	"<code data-anolis-spec=dom>SyntaxError</code>" exception.

	<p class=note>An empty string represents an empty header field value.

 <li>
	<p>Terminate these steps if <var>header</var> is a case-insensitive
	match for one of the following headers:

	<ul class=brief>
	 <li><code>Accept-Charset</code>
	 <li><code>Accept-Encoding</code>
	 <li><code>Access-Control-Request-Headers</code>
	 <li><code>Access-Control-Request-Method</code>
	 <li><code>Connection</code>
	 <li><code>Content-Length</code>
	 <li><code>Cookie</code>
	 <li><code>Cookie2</code>
	 <li><code>Date</code>
	 <li><code>DNT</code>
	 <li><code>Expect</code>
	 <li><code>Host</code>
	 <li><code>Keep-Alive</code>
	 <li><code title>Origin</code>
	 <li><code>Referer</code>
	 <li><code>TE</code>
	 <li><code>Trailer</code>
	 <li><code>Transfer-Encoding</code>
	 <li><code>Upgrade</code>
	 <li><code>User-Agent</code>
	 <li><code>Via</code>
	</ul>

	<p>&hellip; or if the start of <var>header</var> is a case-insensitive
	match for <code>Proxy-</code> or <code>Sec-</code> (including when
	<var>header</var> is just <code>Proxy-</code> or <code>Sec-</code>).

	<p class=note>The above headers are controlled by the user agent to
	let it control those aspects of transport. This guarantees data
	integrity to some extent. Header names starting with <code>Sec-</code>
	are not allowed to be set to allow new headers to be minted that are
	guaranteed not to come from <code>XMLHttpRequest</code>.

 <li><p>If <var>header</var> is not in the
 <span>author request headers</span> list, append <var>header</var> with
 its associated <var>value</var> to the list and terminate these steps.

 <li>
	<p>If <var title>header</var> is in the <span>author request headers</span> list, append
	"<code>,</code>", followed by U+0020, followed by <var title>value</var>, to the
	value of the header matching <var title>header</var>.

	<p class=note>The XMLHttpRequest standard intentionally constraints the
	use of HTTP here in line with contemporary implementations.
</ol>

<div class="example">
 <p>Some simple code demonstrating what happens when setting the same
 header twice:

 <pre><code>// The following script:
var client = new XMLHttpRequest();
client.open('GET', 'demo.cgi');
client.setRequestHeader('X-Test', 'one');
client.setRequestHeader('X-Test', 'two');
client.send();

// &hellip;results in the following header being sent:
X-Test: one, two</code></pre>
</div>


<h4>The <code title>timeout</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title="dom-XMLHttpRequest-timeout">timeout</span></code>
 <dd>
	<p>Can be set to a time in milliseconds. When set to a non-zero value
	will cause <span title=fetch data-anolis-spec=html>fetching</span> to
	terminate after the given time has passed. When the time has passed, if
	the <span>synchronous flag</span> is unset, a
	<code title=event-xhr-timeout>timeout</code> event will then be
	<span title=concept-event-dispatch data-anolis-spec=dom>dispatched</span>,
	or a "<code data-anolis-spec=dom>TimeoutError</code>" exception will be
	<span data-anolis-spec=dom title=concept-throw>thrown</span> otherwise
	(for the <code title=dom-XMLHttpRequest>send()</code> method).
	<p>When set: throws an
	"<code data-anolis-spec=dom>InvalidAccessError</code>" exception if
	the <span>synchronous flag</span> is set and the
	<span data-anolis-spec=html>JavaScript global environment</span> is a
	<span data-anolis-spec=html>document environment</span>.
 </dd>
</dl>

<p>The
<dfn id="dom-xmlhttprequest-timeout" title="dom-XMLHttpRequest-timeout"><code>timeout</code></dfn>
attribute must return its value. Initially its value must be zero.

<p>Setting the <code title="dom-XMLHttpRequest-timeout">timeout</code>
attribute must run these steps:

<ol>
 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>document environment</span> and the
 <span>synchronous flag</span> is set,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidAccessError</code>" exception.

 <li><p>Set its value to the new value.
</ol>

<p class=note>This implies that the
<code title="dom-XMLHttpRequest-timeout">timeout</code> attribute can be
set while <span data-anolis-spec=html title=fetch>fetching</span> is in
progress. If that occurs it will still be measured relative to the start
of <span data-anolis-spec=html title=fetch>fetching</span>.


<h4>The <code title>withCredentials</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-withCredentials>withCredentials</span></code>
 <dd>
	<p>True when <span>user credentials</span> are to be included in a
	cross-origin request. False when they are to be excluded in a
	cross-origin request and when cookies are to be ignored in its response.
	Initially false.

	<p>When set: throws an
	"<code data-anolis-spec=dom>InvalidStateError</code>" exception if the
	state is not <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span> or
	<span title="dom-XMLHttpRequest-OPENED">OPENED</span>, or if
	the <span><code>send()</code> flag</span> is set.
	<p>When set: throws an
	"<code data-anolis-spec=dom>InvalidAccessError</code>" exception if
	either the <span>synchronous flag</span> is set and the
	<span data-anolis-spec=html>JavaScript global environment</span> is a
	<span data-anolis-spec=html>document environment</span> or if the
	<span>anonymous flag</span> is set.
 </dd>
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-withCredentials"><code>withCredentials</code></dfn>
attribute must return its value. Initially its value must be false.

<p>Setting the
<code title="dom-XMLHttpRequest-withCredentials">withCredentials</code>
attribute must run these steps:

<ol>
 <li><p>If the state is not <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span> or
 <span title="dom-XMLHttpRequest-OPENED">OPENED</span>,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.

 <li><p>If the <span><code>send()</code> flag</span> is set,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.

 <li><p>If the <span>anonymous flag</span> is set,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidAccessError</code>" exception.

 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>document environment</span> and the
 <span>synchronous flag</span> is set,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidAccessError</code>" exception.

 <li><p>Set the <code title="dom-XMLHttpRequest-withCredentials">withCredentials</code>
 attribute's value to the given value.
</ol>

<p class=note>The <code title="dom-XMLHttpRequest-withCredentials">withCredentials</code>
attribute has no effect when <span data-anolis-spec=html title=fetch>fetching</span>
<span data-anolis-spec=html title="same origin">same-origin</span> resources.


<h4>The <code title>upload</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-upload>upload</span></code>
 <dd><p>Returns the associated <code>XMLHttpRequestUpload</code>
 object. It can be used to gather transmission information when data is
 transferred to a server.
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-upload"><code>upload</code></dfn>
attribute must return the associated
<code>XMLHttpRequestUpload</code> object.

<p class=note>As indicated earlier, each <code>XMLHttpRequest</code>
object has an associated <code>XMLHttpRequestUpload</code> object.


<h4>The <code title>send()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-send>send</span>([<var title>data</var> = null])</code>
 <dd>
	<p>Initiates the request. The optional argument provides the
	<span>request entity body</span>. The argument is ignored if
	<span>request method</span> is <code>GET</code> or
	<code>HEAD</code>.

	<p>Throws an "<code data-anolis-spec=dom>InvalidStateError</code>"
	exception if the state is not
	<span title="dom-XMLHttpRequest-OPENED">OPENED</span> or if the
	<span><code>send()</code> flag</span> is set.
 </dd>
</dl>

<p>The <dfn title="dom-XMLHttpRequest-send"><code>send(<var>data</var>)</code></dfn>
method must run these steps (unless otherwise noted):

<ol>
 <li><p>If the state is not <span title="dom-XMLHttpRequest-OPENED">OPENED</span>,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.

 <li><p>If the <span><code>send()</code> flag</span> is set,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.

 <li><p>If the <span>request method</span> is <code>GET</code> or
 <code>HEAD</code>, set <var title>data</var> to null.

 <li>
	<p>If <var title>data</var> is null, do not include a
	<span>request entity body</span> and go to the next step.

	<p>Otherwise, let <var>encoding</var> be null, <var>mime type</var> be
	null, and then follow these rules, depending on <var title>data</var>:

	<dl class=switch>

	 <dt id="dom-XMLHttpRequest-send-ArrayBufferView"><code data-anolis-spec=typedarray>ArrayBufferView</code>
	 <dd><p>Let the <span>request entity body</span> be the raw data
	 represented by <var title>data</var>.</dd>

	 <dt id="dom-XMLHttpRequest-send-Blob"><code data-anolis-spec=fileapi>Blob</code>
	 <dd>
		<p>If the object's <code title>type</code> attribute value is not
		the empty string, let <var>mime type</var> be its value.

		<p class=note>See also <code data-anolis-spec=fileapi>Blob</code>'s
		<code data-anolis-spec=fileapi title=dom-Blob-type>type</code> attribute.

		<p>Let the <span>request entity body</span> be the raw data
		represented by <var>data</var>.
	 </dd>


	 <dt id="dom-XMLHttpRequest-send-document"><span data-anolis-spec=dom title=concept-document>document</span>
	 <dd>
		<p>Let <var title>encoding</var> be the
		<span data-anolis-spec=dom title=concept-document-encoding>encoding</span>
		of <var title>data</var>. If <var title>encoding</var> is
		<span data-anolis-spec=encoding>utf-16le</span> or
		<span data-anolis-spec=encoding>utf-16be</span>, set
		<var title>encoding</var> to
		<span data-anolis-spec=encoding>utf-8</span>.

		<p>If <var title>data</var> is an
		<span data-anolis-spec=dom>HTML document</span>, let
		<var>mime type</var> be "<code>text/html</code>", or let
		<var>mime type</var> be "<code>application/xml</code>" otherwise. Then
		append "<code>;charset=<var>encoding</var></code>" to
		<var>mime type</var>.

		<p><span data-anolis-spec=domps title=concept-serialize>Serialize</span>
		<var title>data</var>, and let the <span>request entity body</span> be the result,
		<span data-anolis-spec=webidl title="convert a DOMString to a sequence of Unicode characters">converted to Unicode</span>
		and <span data-anolis-spec=encoding title=encode>encoded</span> using
		encoding <var>encoding</var>. Re-throw any exception this
		throws.

		<p class=XXX>Should we only encode as utf-8? What happens in the face
		of an <span data-anolis-spec=encoding>encoder error</span>?

		<p class=note>In particular, if the document cannot be serialized an
		"<code data-anolis-spec=dom>InvalidStateError</code>" exception is
		thrown.

		<p class=note>Subsequent changes to the
		<span data-anolis-spec=dom title=concept-document>document</span> have
		no effect on what is transferred.
	 </dd>

	 <dt id="dom-XMLHttpRequest-send-a-string">a string
	 <dd>
		<p>Let <var>encoding</var> be "<code title>UTF-8</code>".

		<p>Let <var>mime type</var> be "<code>text/plain;charset=UTF-8</code>".

		<p>Let the <span>request entity body</span> be <var title>data</var>
		<span data-anolis-spec=webidl title="convert a DOMString to a sequence of Unicode characters">converted to Unicode</span>
		and <span data-anolis-spec=encoding title=encode>encoded</span> as
		<span data-anolis-spec=encoding>utf-8</span>.
	 </dd>

	 <dt id="dom-XMLHttpRequest-send-FormData"><code>FormData</code>
	 <dd>
		<p>Let the <span>request entity body</span> be the result of running
		the
		<span data-anolis-spec=html><code>multipart/form-data</code> encoding algorithm</span>
		with <var>data</var> as <var>form data set</var> and with
		<span data-anolis-spec=encoding>utf-8</span> as the
		explicit character encoding.
		<!-- need to provide explicit character encoding because otherwise the
				 encoding of the document is used -->

		<p>Let <var>mime type</var> be the concatenation of
		"<code title>multipart/form-data;</code>",
		a U+0020 SPACE character,
		"<code title>boundary=</code>", and the
		<span data-anolis-spec=html><code>multipart/form-data</code> boundary string</span>
		generated by the
		<span data-anolis-spec=html><code>multipart/form-data</code> encoding algorithm</span>.
	</dl>

	<p>If a <code>Content-Type</code> header is in
	<span>author request headers</span> and its value is a
	<span data-anolis-spec=html>valid MIME type</span> that has a
	<code>charset</code> parameter whose value is not a case-insensitive
	match for <var title>encoding</var>, and <var title>encoding</var>
	is not null, set all the <code>charset</code> parameters of that
	<code>Content-Type</code> header to <var title>encoding</var>.

	<p>If no <code>Content-Type</code> header is in
	<span>author request headers</span> and <var title>mime type</var> is
	not null, append a <code>Content-Type</code> header with value
	<var title>mime type</var> to <span>author request headers</span>.

	<!-- reminder: if we ever change this to always include charset it has
	to be included as the first parameter for compatibility reasons -->


 <li><p>If the <span>synchronous flag</span> is set, release the
 <span data-anolis-spec=html>storage mutex</span>.

 <li><p>Unset the <span>error flag</span>,
 <span>upload complete flag</span> and <span>upload events flag</span>.

 <li><p>If there is no <span>request entity body</span> or if it is empty,
 set the <span>upload complete flag</span>.

 <li><p>If the <span>synchronous flag</span> is unset and one or more
 event listeners are registered on the <code>XMLHttpRequestUpload</code>
 object, set the <span>upload events flag</span>.

 <li>
	<p>If the <span>synchronous flag</span> is unset, run these substeps:

	<ol>
	 <li><p>Set the <span><code>send()</code> flag</span>.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-loadstart">loadstart</code>.

	 <li><p>If the <span>upload complete flag</span> is unset,
	 <span title=concept-event-fire-progress>fire a progress event</span> named <code title="event-xhr-loadstart">loadstart</code>
	 on the <code>XMLHttpRequestUpload</code> object.

	 <li><p>Return the <code title="dom-XMLHttpRequest-send">send()</code>
	 method call, but continue running the steps in this algorithm.
	</ol>


 <li>
	<dl class=switch>
	 <dt>If the <span>source origin</span> and the <span>request URL</span>
	 are <span data-anolis-spec=html>same origin</span></dt>
	 <dt>If the <span>request URL</span>'s
	 <code data-anolis-spec=url title=concept-url-scheme>scheme</code> is
	 "<code title>data</code>"

	 <dd>
		<p>These are the <dfn>same-origin request steps</dfn>.

		<p><span data-anolis-spec=html>Fetch</span> the
		<span>request URL</span> from <i title>origin</i>
		<span>source origin</span>, using
		<span>referrer source</span> as
		<i title>override referrer source</i>, with the
		<i title>synchronous flag</i> set if the
		<span>synchronous flag</span> is set, using HTTP method
		<span>request method</span>, taking into account the
		<span>request entity body</span>, list of
		<span>author request headers</span>, and the rules listed at the end of
		this section.

		<dl class=switch>
		 <dt>If the <span>synchronous flag</span> is set</dt>
		 <dd>
			<p>While making the request also follow the
			<span>same-origin request event rules</span>.

			<!--
			 This cannot involve any task queue whatsoever because that would
			 mean other tasks on the task queue might get processed as well
			 which is counter to the whole idea of doing things synchronous.
			-->

			<p class=note>The
			<code title="dom-XMLHttpRequest-send">send()</code> method call will
			now be returned by virtue of this algorithm ending.
		 </dd>

		 <dt>If the <span>synchronous flag</span> is unset</dt>
		 <dd>

			<p><span>Make upload progress notifications</span>.

			<p><span>Make progress notifications</span>.


			<p>While processing the request, as data becomes available and when
			the user interferes with the request,
			<span data-anolis-spec=html title="queue a task">queue tasks</span>
			to update the <span>response entity body</span> and follow the
			<span>same-origin request event rules</span>.
		 </dd>
		</dl>
	 </dd>

	 <dt>Otherwise</dt>
	 <dd>
		<p>These are the <dfn>cross-origin request steps</dfn>.




		<p>Make a <span data-anolis-spec=cors>cross-origin request</span>,
		passing these as parameters:

		<dl>
		 <dt>request URL</dt>
		 <dd>The <span>request URL</span>.</dd>

		 <dt>request method</dt>
		 <dd>The <span>request method</span>.</dd>

		 <dt>author request headers</dt>
		 <dd>The list of <span>author request headers</span>.</dd>

		 <dt>request entity body</dt>
		 <dd>The <span>request entity body</span>.</dd>

		 <dt>source origin</dt>
		 <dd>The <span>source origin</span>.</dd>

		 <dt>referrer source
		 <dd>If the <span>anonymous flag</span> is set, the
		 <span data-anolis-spec=url>URL</span>
		 "<code title>about:blank</code>", and the
		 <span>referrer source</span> otherwise.

		 <dt>omit credentials flag</dt>
		 <dd>Set if
		 <code title="dom-XMLHttpRequest-withCredentials">withCredentials</code>
		 attribute's value is false.

		 <dt>force preflight flag</dt>
		 <dd>Set if the <span>upload events flag</span> is set.
		</dl>

		<dl class=switch>
		 <dt>If the <span>synchronous flag</span> is set</dt>
		 <dd>
			<p>While making the request also follow the
			<span>cross-origin request event rules</span>.

			<!--
			 This cannot involve any task queue whatsoever because that would
			 mean other tasks on the task queue might get processed as well
			 which is counter to the whole idea of doing things synchronous.
			-->

			<p class=note>The
			<code title="dom-XMLHttpRequest-send">send()</code> method call will
			now be returned by virtue of this algorithm ending.
		 </dd>

		 <dt>If the <span>synchronous flag</span> is unset</dt>
		 <dd>
			<p>While processing the request, as data becomes available and when
			the end user interferes with the request,
			<span data-anolis-spec=html title="queue a task">queue tasks</span>
			to update the <span>response entity body</span> and follow the
			<span>cross-origin request event rules</span>.
		 </dd>
		</dl>

	 </dd>
	</dl>

</ol>

<hr>

<p>If the user agent supports HTTP Authentication and
<code title="http-authorization">Authorization</code> is not in the list
of <span>author request headers</span>, it should
consider requests originating from the <code>XMLHttpRequest</code> object
to be part of the protection space that includes the accessed URIs and
send <code title="http-authorization">Authorization</code> headers and
handle <code>401 Unauthorized</code> requests appropriately.

<p>If authentication fails,
<span>source origin</span> and the
<span>request URL</span> are <span data-anolis-spec=html>same origin</span>,
<code title="http-authorization">Authorization</code> is not in the list
of <span>author request headers</span>,
<span>request URL</span>'s
<span data-anolis-spec=url title=concept-url-username>username</span> is
the empty string and <span>request URL</span>'s
<span data-anolis-spec=url title=concept-url-password>password</span> is
null, user agents should prompt the end user for their username and
password.
<!-- XXX this should probably be defined in "fetch" -->

<p>Otherwise, if authentication fails, user agents
must not prompt the end user for their username and
password. <span data-anolis-ref>HTTPAUTH</span>

<p class=note>Unfortunately end users are prompted because of legacy
content constraints. However, when possible this behavior is prohibited,
as it is bad UI. E.g. that is why the
<span data-anolis-spec=html>same origin</span> restriction is made above.

<hr>

<p>If the user agent implements a HTTP cache it should
respect <code>Cache-Control</code> headers in
<span>author request headers</span>
(e.g. <code>Cache-Control: no-cache</code> bypasses the cache). It
must not send <code>Cache-Control</code> or
<code>Pragma</code> request headers automatically unless the end user
explicitly requests such behavior (e.g. by reloading the page).

<p>For <code>304 Not Modified</code> responses that are a result of a
user agent generated conditional request the user agent
must act as if the server gave a <code>200 OK</code>
response with the appropriate content. The user agent
must allow <span>author request headers</span> to override automatic cache
validation (e.g. <code>If-None-Match</code> or
<code>If-Modified-Since</code>), in which case
<code>304 Not Modified</code> responses must be passed through.
<span data-anolis-ref>HTTP</span>

<hr>

<p>If the user agent implements server-driven content-negotiation
it must follow these constraints for the
<code>Accept</code> and <code>Accept-Language</code> request headers:

<ul>
 <li><p>Both headers must not be modified if they are in
 <span>author request headers</span>.

 <li><p>If not in <span>author request headers</span>,
 <code>Accept-Language</code> with an appropriate value should be appended
 to it.

 <li><p>If not in <span>author request headers</span>, <code>Accept</code>
 with value <code>*/*</code> must be appended to it.
</ul>

<p>Responses must have the content-encodings
automatically decoded. <span data-anolis-ref>HTTP</span>

<hr>

<p>Besides the <span>author request headers</span>, user agents
should not include additional request headers other than those mentioned
above or other than those authors are not allowed to set using
<code title="dom-XMLHttpRequest-setRequestHeader">setRequestHeader()</code>.
This ensures that authors have a predictable API.


<h4>Infrastructure for the <code title>send()</code> method</h4>

<p>The <dfn>same-origin request event rules</dfn> are as follows:

<dl class=switch>
 <dt>If the <span>error flag</span> is set
 <dd><p>Terminate these steps.

 <dt>If the response has an HTTP status code of 301, 302, 303, 307, or 308
 <dd>
	<p>If the redirect violates infinite loop precautions this is a
	<span>network error</span>.

	<p>Otherwise, run these steps:

	<ol>
	 <li><p>Set the <span>request URL</span> to the
	 <span data-anolis-spec=url>URL</span> conveyed by the
	 <code>Location</code> header.
	 <!-- XXX fetch: this requires parsing and such too. Either HTTP or
				Fetch needs to handle this. -->

	 <li><p>If the <span>source origin</span> and the
	 <span data-anolis-spec=html>origin</span> of <span>request URL</span>
	 are <span data-anolis-spec=html>same origin</span> transparently follow
	 the redirect while observing the
	 <span>same-origin request event rules</span>.

	 <li><p>Otherwise, follow the <span>cross-origin request steps</span>
	 and terminate the steps for this algorithm.
	</ol>

	<p class=note>HTTP places requirements on the user agent regarding the
	preservation of the <span>request method</span> and
	<span>request entity body</span> during redirects, and also requires end
	users to be notified of certain kinds of automatic redirections.
	<!-- XXX HTTP needs fixing here -->
 </dd>

 <dt>If the end user cancels the request</dt>
 <dd><p>This is an <span>abort error</span>.</dd>

 <dt>If there is a network error</dt>
 <dd>
	<p>In case of DNS errors, TLS negotiation failure, or other type of
	network errors, this is a <span>network error</span>. Do not request any
	kind of end user interaction.

	<p class=note>This does not include HTTP responses that indicate
	some type of error, such as HTTP status code 410.
 </dd>


 <dt>If <code title="dom-XMLHttpRequest-timeout">timeout</code> is not 0
 and since the request started the amount of milliseconds specified by
 <code title="dom-XMLHttpRequest-timeout">timeout</code> has passed</dt>
 <dd><p>This is a <span>timeout error</span>.</dd>


 <dt>Once all HTTP headers have been received, the
 <span>synchronous flag</span> is unset, and the HTTP status code of the
 response is not one of 301, 302, 303, 307, and 308
 <dd><p><span>Switch to the HEADERS_RECEIVED state</span>.</dd>

 <dt>Once the first byte (or more) of the
 <span>response entity body</span> has been received and the
 <span>synchronous flag</span> is unset</dt>
 <dt>If there is no <span>response entity body</span> and the
 <span>synchronous flag</span> is unset</dt>
 <dd><p><span>Switch to the LOADING state</span>.</dd>

 <dt>Once the whole <span>response entity body</span> has been
 received</dt>
 <dt>If there is no <span>response entity body</span> and the state is
 <span title="dom-XMLHttpRequest-LOADING">LOADING</span></dt>
 <dt>If there is no <span>response entity body</span> and the
 <span>synchronous flag</span> is set</dt>
 <dd><p><span>Switch to the DONE state</span>.</dd>
</dl>


<hr>

<p>The <dfn>cross-origin request event rules</dfn> are as follows:

<dl class=switch>
 <dt>If the <span>error flag</span> is set
 <dd><p>Terminate these steps.

 <dt>If the <span data-anolis-spec=cors>cross-origin request status</span>
 is <i>preflight complete</i> and the <span>synchronous flag</span> is
 unset</dt>
 <dd><p><span>Make upload progress notifications</span>.</dd>

 <dt>If the <span data-anolis-spec=cors>cross-origin request status</span>
 is <i title>network error</i></dt>
 <dd><p>This is a <span>network error</span>.</dd>

 <dt>If the <span data-anolis-spec=cors>cross-origin request status</span>
 is <i title>abort error</i></dt>
 <dd><p>This is an <span>abort error</span>.</dd>

 <dt>If <code title="dom-XMLHttpRequest-timeout">timeout</code> is not 0
 and since the request started the amount of milliseconds specified by
 <code title="dom-XMLHttpRequest-timeout">timeout</code> has passed</dt>
 <dd><p>This is a <span>timeout error</span>.</dd>

 <dt>Once all HTTP headers have been received, the
 <span data-anolis-spec=cors>cross-origin request status</span> is
 <i>success</i>, and the <span>synchronous flag</span> is unset</dt>
 <dd>
	<p><span>Switch to the HEADERS_RECEIVED state</span>.

	<p><span>Make progress notifications</span>.
 </dd>

 <dt>Once the first byte (or more) of the
 <span>response entity body</span> has been received, the
 <span data-anolis-spec=cors>cross-origin request status</span> is
 <i>success</i>, and the <span>synchronous flag</span> is unset</dt>
 <dt>If there is no <span>response entity body</span>, the
 <span data-anolis-spec=cors>cross-origin request status</span> is
 <i>success</i>, and the <span>synchronous flag</span> is unset</dt>
 <dd><p><span>Switch to the LOADING state</span>.</dd>

 <dt>Once the whole <span>response entity body</span> has been received
 and the <span data-anolis-spec=cors>cross-origin request status</span> is
 <i>success</i></dt>
 <dt>If there is no <span>response entity body</span>, the
 <span data-anolis-spec=cors>cross-origin request status</span> is
 <i>success</i>, and the state is
 <span title="dom-XMLHttpRequest-LOADING">LOADING</span></dt>
 <dt>If there is no <span>response entity body</span>, the
 <span data-anolis-spec=cors>cross-origin request status</span> is
 <i>success</i>, and the <span>synchronous flag</span> is set</dt>
 <dd><p><span>Switch to the DONE state</span>.</dd>
</dl>


<hr>

<p>When something is said to be a <dfn>network error</dfn> run the
<span>request error</span> steps for exception
"<code data-anolis-spec=dom>NetworkError</code>" and
event <code title="event-xhr-error">error</code>.

<p>When something is said to be an <dfn>abort error</dfn> run the
<span>request error</span> steps for exception
"<code data-anolis-spec=dom>AbortError</code>" and event
<code title="event-xhr-abort">abort</code>.


<p>When something is said to be an <dfn>timeout error</dfn> run the
<span>request error</span> steps for exception
"<code data-anolis-spec=dom>TimeoutError</code>" and event
<code title="event-xhr-timeout">timeout</code>.


<p>When something is said to be a <dfn>request error</dfn> for
exception <var>exception</var> and event <var title>event</var> run these
steps:

<ol>
 <li><p>The user agent should cancel any network
 activity for which the object is responsible.

 <li><p>If there are any
 <span data-anolis-spec=html title=concept-task>tasks</span> from the
 object's <span><code>XMLHttpRequest</code> task source</span> in one of
 the <span data-anolis-spec=html title="task queue">task queues</span>,
 then remove them.

 <li><p>Set the the <span>error flag</span>.

 <li><p>Change the state to <span title="dom-XMLHttpRequest-DONE">DONE</span>.

 <li><p>If the <span>synchronous flag</span> is set,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 <var>exception</var> exception.

 <li>
	<p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.

	<p class=note>At this point it is clear that the
	<span>synchronous flag</span> is unset.



 <li>
	<p>If the <span>upload complete flag</span> is unset, follow these
	substeps:

	<ol>
	 <li><p>Set the <span>upload complete flag</span>.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
	 <code title=event-xhr-progress>progress</code> on the <code>XMLHttpRequestUpload</code> object.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
	 <var title>event</var> on the <code>XMLHttpRequestUpload</code> object.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
	 <code title="event-xhr-loadend">loadend</code> on the <code>XMLHttpRequestUpload</code> object.
	</ol>


 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title=event-xhr-progress>progress</code>.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <var title>event</var>.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-loadend">loadend</code>.
</ol>

<hr>

<p>When it is said to
<dfn id="switch-headers-received">switch to the HEADERS_RECEIVED state</dfn>
run these steps:

<ol>
 <li><p>Change the state to <span title="dom-XMLHttpRequest-HEADERS_RECEIVED">HEADERS_RECEIVED</span>.

 <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.
</ol>

<p>When it is said to
<dfn id="switch-loading">switch to the LOADING state</dfn> run these
steps:

<ol>
 <li><p>Change the state to <span title="dom-XMLHttpRequest-LOADING">LOADING</span>.

 <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.
</ol>

<p>When it is said to
<dfn id="switch-done">switch to the DONE state</dfn> run these steps:

<ol>
 <li><p>If the <span>synchronous flag</span> is set, update the
 <span>response entity body</span>.

 <li><p>Unset the <span>synchronous flag</span>.

 <li><p>Change the state to <span title="dom-XMLHttpRequest-DONE">DONE</span>.

 <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title=event-xhr-progress>progress</code>.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-load">load</code>.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-loadend">loadend</code>.

</ol>


<hr>

<p>When it is said to <dfn>make progress notifications</dfn>, while the
download is progressing, <span data-anolis-spec=html>queue a task</span> to
<span title=concept-event-fire-progress>fire a progress event</span> named <code title="event-xhr-progress">progress</code>
about every 50ms or for every byte received, whichever is <em>least</em>
frequent.

<hr>

<p>When it is said to <dfn>make upload progress notifications</dfn> run
these steps:

<ul>
 <li><p>While the request entity body is being transmitted and the
 <span>upload complete flag</span> is unset,
 <span data-anolis-spec=html>queue a task</span> to
 <span title=concept-event-fire-progress>fire a progress event</span> named <code title="event-xhr-progress">progress</code> on
 the <code>XMLHttpRequestUpload</code> object about every 50ms or for
 every byte transmitted, whichever is <em>least</em> frequent.

 <li>
	<p>If the <span>request entity body</span> has been fully transmitted
	(irrespective of whether the server has started transmitting a response
	or the status code of such a response) and the
	<span>upload complete flag</span> is still unset,
	<span data-anolis-spec=html>queue a task</span> to run these substeps:

	<ol>
	 <li><p>Set the <span>upload complete flag</span>.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title=event-xhr-progress>progress</code>
	 on the <code>XMLHttpRequestUpload</code> object.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-load">load</code>
	 on the <code>XMLHttpRequestUpload</code> object.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-loadend">loadend</code>
	 on the <code>XMLHttpRequestUpload</code> object.
	</ol>
</ul>


<h4>The <code title>abort()</code> method</h4>

  <dl class=domintro>
   <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-abort>abort</span>()</code>
   <dd>Cancels any network activity.
  </dl>

<p>The <dfn title="dom-XMLHttpRequest-abort"><code>abort()</code></dfn> method must run
these steps (unless otherwise noted):

<ol>
 <li><p>Set the <span>error flag</span>.

 <li><p>The user agent should cancel any network
 activity for which the object is responsible.

 <li><p>If there are any
 <span data-anolis-spec=html title=concept-task>tasks</span> from the
 object's <span><code>XMLHttpRequest</code> task source</span> in one of
 the <span data-anolis-spec=html title="task queue">task queues</span>,
 then remove them.

 <li>
	<p>If the state is <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span>,
	<span title="dom-XMLHttpRequest-OPENED">OPENED</span> with the
	<span><code>send()</code> flag</span> being unset, or
	<span title="dom-XMLHttpRequest-DONE">DONE</span> go to the next step.

	<p>Otherwise run these substeps:

	<ol>
	 <li><p>Change the state to <span title="dom-XMLHttpRequest-DONE">DONE</span>.

	 <li><p>Unset the <span><code>send()</code> flag</span>.

	 <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title=event-xhr-progress>progress</code>.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-abort">abort</code>.

	 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-loadend">loadend</code>.

	 <li>
		<p>If the <span>upload complete flag</span> is false run these
		substeps:

		<ol>
		 <li><p>Set the <span>upload complete flag</span> to true.

		 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title=event-xhr-progress>progress</code>
		 on the <code>XMLHttpRequestUpload</code> object.

		 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-abort">abort</code>
		 on the <code>XMLHttpRequestUpload</code> object.

		 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-loadend">loadend</code>
		 on the <code>XMLHttpRequestUpload</code> object.
		</ol>


	</ol>

 <li>
	<p>Change the state to <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span>.

	<p class=note>No <code title="event-xhr-readystatechange">readystatechange</code> event is dispatched.
</ol>



<h3 id="response">Response</h3>

<h4>The <code title>status</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-status>status</span></code>
 <dd><p>Returns the HTTP status code.
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-status"><code>status</code></dfn>
attribute must return the result of running these
steps:

<ol>
 <li><p>If the state is <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span> or
 <span title="dom-XMLHttpRequest-OPENED">OPENED</span>, return 0.

 <li><p>If the <span>error flag</span> is set, return 0.

 <li><p>Return the HTTP status code.
</ol>


<h4>The <code title>statusText</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-statusText>statusText</span></code>
 <dd><p>Returns the HTTP status text.
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-statusText"><code>statusText</code></dfn>
attribute must return the result of running these steps:

<ol>
 <li><p>If the state is <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span> or
 <span title="dom-XMLHttpRequest-OPENED">OPENED</span>, return the empty string.

 <li><p>If the <span>error flag</span> is set, return the empty string.

 <li><p>Return the HTTP status text.
</ol>


<h4>The <code title>getResponseHeader()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-getResponseHeader>getResponseHeader</span>(<var title>header</var>)</code>
 <dd><p>Returns the header field value from the response of which the
 field name matches <var title>header</var>, unless the field name is
 <code>Set-Cookie</code> or <code>Set-Cookie2</code>.
</dl>

<p>The <code title="dom-XMLHttpRequest-getResponseHeader">getResponseHeader()</code> method returns only headers that are sent before the <span>response entity body</span>. Trailing HTTP headers are not included.

<p>The
<dfn title="dom-XMLHttpRequest-getResponseHeader"><code>getResponseHeader(<var title>header</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If the state is <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span> or
 <span title="dom-XMLHttpRequest-OPENED">OPENED</span>, return null.

 <li><p>If the <span>error flag</span> is set, return null.

 <li><p>If <var>header</var> is a case-insensitive match for
 <code>Set-Cookie</code> or <code>Set-Cookie2</code>, return null.

 <li><p>If <var>header</var> is a case-insensitive match for multiple HTTP
 response headers, return the values of these headers as a single
 concatenated string separated from each other by a
 U+002C COMMA U+0020 SPACE character pair.

 <li><p>If <var>header</var> is a case-insensitive match for a single HTTP
 response header, return the value of that header.

 <li><p>Return null.
</ol>


<p class=note>The Cross-Origin Resource Sharing specification filters
the headers that are exposed by
<code title="dom-XMLHttpRequest-getResponseHeader">getResponseHeader()</code>
for non <span data-anolis-spec=html title="same origin">same-origin</span>
requests. <span data-anolis-ref>CORS</span>


<div class="example">

 <p>For the following script:

 <pre><code>var client = new XMLHttpRequest();
client.open("GET", "unicorns-are-teh-awesome.txt", true);
client.send();
client.onreadystatechange = function() {
  if(this.readyState == 2) {
    print(client.getResponseHeader("Content-Type"));
  }
}</code></pre>

 <p>The <code>print()</code> function will get to process something
 like:

 <pre><code>text/plain; charset=UTF-8</code></pre>
</div>


<h4>The <code title>getAllResponseHeaders()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-getAllResponseHeaders>getAllResponseHeaders</span>()</code>
 <dd><p>Returns all headers from the response, with the exception of those
 whose field name is <code>Set-Cookie</code> or
 <code>Set-Cookie2</code>.
</dl>

<p>The <code title="dom-XMLHttpRequest-getAllResponseHeaders">getAllResponseHeaders()</code> method returns only headers that are sent before the <span>response entity body</span>. Trailing HTTP headers are not included.

<p>The
<dfn title="dom-XMLHttpRequest-getAllResponseHeaders"><code>getAllResponseHeaders()</code></dfn>
method must run these steps:

<ol>
 <li><p>If the state is <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span> or
 <span title="dom-XMLHttpRequest-OPENED">OPENED</span>, return the empty string.

 <li><p>If the <span>error flag</span> is set, return the empty string.

 <li><p>Return all the HTTP headers, excluding headers that are a
 case-insensitive match for <code>Set-Cookie</code> or
 <code>Set-Cookie2</code>, as a single string, with each header line
 separated by a U+000D CR U+000A LF pair, excluding the status line, and
 with each header name and header value separated by a
 U+003A COLON U+0020 SPACE pair.
</ol>


<p class=note>The Cross-Origin Resource Sharing specification filters
the headers that are exposed by
<code title="dom-XMLHttpRequest-getAllResponseHeaders">getAllResponseHeaders()</code>
for non <span data-anolis-spec=html title="same origin">same-origin</span>
requests. <span data-anolis-ref>CORS</span>


<div class="example">
 <p>For the following script:

 <pre><code>var client = new XMLHttpRequest();
client.open("GET", "narwhals-too.txt", true);
client.send();
client.onreadystatechange = function() {
  if(this.readyState == 2) {
    print(this.getAllResponseHeaders());
  }
}</code></pre>

 <p>The <code>print()</code> function will get to process something
 like:

 <pre><code>Date: Sun, 24 Oct 2004 04:58:38 GMT
Server: Apache/1.3.31 (Unix)
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/plain; charset=utf-8</code></pre>
</div>


<h4>Response entity body</h4>

<p>The <dfn id="response-mime-type">response MIME type</dfn> is the
MIME type the <code>Content-Type</code> header contains excluding any
parameters and
<span data-anolis-spec=dom>converted to ASCII lowercase</span>, or null if
the response header can not be parsed or was omitted. The
<dfn id="override-mime-type">override MIME type</dfn> is initially null
and can get a value if
<code title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType()</code>
is invoked. <dfn id="final-mime-type">Final MIME type</dfn> is the
<span>override MIME type</span> unless that is null in which case it is
the <span>response MIME type</span>.

<p>The <dfn id="response-charset">response charset</dfn> is the value of
the <code>charset</code> parameter of the <code>Content-Type</code> header
or null if there was no <code>charset</code> parameter or the header could
not be parsed or was omitted. The
<dfn id="override-charset">override charset</dfn> is initially null and
can get a value if <code title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType()</code> is invoked.
<dfn id="final-charset">Final charset</dfn> is the
<span>override charset</span> unless
that is null in which case it is the <span>response charset</span>.



<hr>

<p>The <dfn id="response-entity-body">response entity body</dfn> is the
fragment of the <span data-anolis-spec=http>entity body</span> of the
response received so far
(<span title="dom-XMLHttpRequest-LOADING">LOADING</span>) or the complete
<span data-anolis-spec=http>entity body</span> of the response
(<span title="dom-XMLHttpRequest-DONE">DONE</span>). If the response
does not have an <span data-anolis-spec=http>entity body</span>, the
<span>response entity body</span> is null.

<p class=note>The <span>response entity body</span> is updated as part
of the <code title="dom-XMLHttpRequest-send">send()</code> algorithm.

<hr>

<p>The
<dfn id="arraybuffer-response-entity-body">arraybuffer response entity body</dfn>
is an <code data-anolis-spec=typedarray>ArrayBuffer</code> representing
the <span>response entity body</span>. If the
<span>arraybuffer response entity body</span> has no value assigned to it
let it be the return value of the following algorithm:

<ol>
 <li><p>If the <span>response entity body</span> is null, return an empty
 <code data-anolis-spec=typedarray>ArrayBuffer</code> object.

 <li><p>Return an <code data-anolis-spec=typedarray>ArrayBuffer</code>
 object representing the <span>response entity body</span>.
</ol>


<p>The
<dfn id="blob-response-entity-body">blob response entity body</dfn> is a
<code data-anolis-spec=fileapi>Blob</code> representing the <span>response entity body</span>. If
the <span>blob response entity body</span> has no value assigned to it let
it be the return value of the following algorithm:

<ol>
 <li><p>If the <span>response entity body</span> is null, return an empty
 <code data-anolis-spec=fileapi>Blob</code> object.

 <li><p>Return a <code data-anolis-spec=fileapi>Blob</code> object
 representing the <span>response entity body</span>.
</ol>



<p>The
<dfn id="document-response-entity-body">document response entity body</dfn>
is either a
<span data-anolis-spec=dom title=concept-document>document</span>
representing the <span>response entity body</span> or null. If the
<span>document response entity body</span> has no value assigned to it let
it be the return value of the following algorithm:

<ol>
 <li><p>If the <span>response entity body</span> is null, return null.

 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>worker environment</span>, return null.

 <li><p>If <span>final MIME type</span> is not null,
 <code>text/html</code>, <code>text/xml</code>,
 <code>application/xml</code>, or does not end in
 <code title>+xml</code>, return null.

 <li>
	<p>If <code title=dom-XMLHttpRequest-responseType>responseType</code> is
	the empty string and <span>final MIME type</span> is
	<code>text/html</code>, return null.

	<p class=note>This is restricted to
	<code title=dom-XMLHttpRequest-responseType>responseType</code> being
	"<code title>document</code>" in order to prevent breaking legacy
	content.

 <li>
	<p>If <span>final MIME type</span> is <code>text/html</code>, run these
	substeps:

	<ol>
	 <li><p>Let <var>charset</var> be the <span>final charset</span>.

	 <li><p>If <var>charset</var> is null,
	 <span data-anolis-spec=html title="prescan a byte stream to determine its encoding">prescan</span>
	 the first 1024 bytes of the <span>response entity body</span> and if
	 that does not terminate unsuccessfully then let <var>charset</var> be
	 the return value.

	 <li><p>If <var>charset</var> is null, set <var>charset</var> to
	 <span data-anolis-spec=encoding>utf-8</span>.

	 <li><p><span data-anolis-spec=encoding>Decode</span> byte stream
	 <span>response entity body</span> using fallback encoding
	 <var>charset</var> and then let <var title>document</var> be a
	 <span data-anolis-spec=dom title=concept-document>document</span> that
	 represents the result of that, parsed following the rules set
	 forth in the HTML specification for an HTML parser with scripting
	 disabled. <span data-anolis-ref>HTML</span>

	 <li><p>Set <var title>document</var>'s
	 <span data-anolis-spec=dom title=concept-document-encoding>encoding</span>
	 to <var>charset</var>.
	</ol>

 <li>
	<p>Otherwise, let <var title>document</var> be a
	<span data-anolis-spec=dom title=concept-document>document</span>
	that represents the result of parsing the
	<span>response entity body</span> following the rules set forth in the
	XML specifications. If that fails (unsupported character encoding,
	namespace well-formedness error, etc.), return null.
	<span data-anolis-ref>XML</span> <span data-anolis-ref>XMLNS</span>

	<p class=note>Scripts in the resulting document tree will not be
	executed, resources referenced will not be loaded and no associated XSLT
	will be applied. <!-- XXX more formally?! -->

 <!-- XXX what about document's encoding? -->

 <li><p>Set <var title>document</var>'s
 <span data-anolis-spec=dom title=concept-document-content-type>content type</span>
 to <span>final MIME type</span>.

 <li><p>Set <var title>document</var>'s
 <span data-anolis-spec=dom title=concept-document-url>URL</span> to
 <span>request URL</span>.

 <li><p>Set <var title>document</var>'s <span data-anolis-spec=html>origin</span> to
 <span>source origin</span>.

 <li><p>Return <var title>document</var>.
</ol>

<p>The <dfn>JSON response entity body</dfn> is an ECMAScript value
representing the <span>response entity body</span>. The
<span>JSON response entity body</span> is the return value of the following
algorithm:

<ol>
 <li><p>If the <span>response entity body</span> is null, return null.

 <li><p>Let <var title>JSON text</var> be the result of running
 <span data-anolis-spec=encoding>utf-8 decode</span> on byte stream
 <span>response entity body</span>.

 <li><p>Return the result of invoking the <code title>parse</code> function
 of the <code title>JSON</code> object defined in ECMAScript, with
 <var title>JSON text</var> as its only argument, or null if that function
 throws an exception. <span data-anolis-ref>ECMASCRIPT</span>
</ol>


<p>The <dfn id="text-response-entity-body">text response entity body</dfn>
is a string representing the <span>response entity body</span>. The
<span>text response entity body</span> is the return value of the
following algorithm:

<ol>
 <li><p>If the <span>response entity body</span> is null, return the empty string.

 <li><p>Let <var>charset</var> be the <span>final charset</span>.

 <li>
	<p>If <code title=dom-XMLHttpRequest-responseType>responseType</code> is
	the empty string, <var>charset</var> is null, and
	<span>final MIME type</span> is either null, <code>text/xml</code>,
	<code>application/xml</code> or ends in <code title>+xml</code>, use the
	rules set forth in the XML specifications to determine the encoding. Let
	<var>charset</var> be the determined encoding.
	<span data-anolis-ref>XML</span> <span data-anolis-ref>XMLNS</span>

	<p class=note>This is restricted to
	<code title=dom-XMLHttpRequest-responseType>responseType</code> being
	the empty string to keep the non-legacy
	<code title=dom-XMLHttpRequest-responseType>responseType</code> value
	"<code title>text</code>" simple.

 <li><p>If <var>charset</var> is null, set <var>charset</var> to
 <span data-anolis-spec=encoding>utf-8</span>.

 <li><p>Return the result of running
 <span data-anolis-spec=encoding>decode</span> on byte stream
 <span>response entity body</span> using fallback encoding
 <var>charset</var>.
</ol>

<p class=note>Authors are strongly encouraged to always encode their
resources using <span data-anolis-spec=encoding>utf-8</span>.



<h4>The <code title>overrideMimeType()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-overrideMimeType>overrideMimeType</span>(<var title>mime</var>)</code>
 <dd>
	<p>Sets the <code>Content-Type</code> header for the response to
	<var title>mime</var>.

	<p>Throws an "<code data-anolis-spec=dom>InvalidStateError</code>"
	exception if the state is
	<span title="dom-XMLHttpRequest-LOADING">LOADING</span> or
	<span title="dom-XMLHttpRequest-DONE">DONE</span>.

	<p>Throws a "<code data-anolis-spec=dom>SyntaxError</code>" exception if
	<var title>mime</var> is not a valid media type.
 </dd>
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-overrideMimeType"><code>overrideMimeType(<var title>mime</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If the state is
 <span title="dom-XMLHttpRequest-LOADING">LOADING</span> or
 <span title="dom-XMLHttpRequest-DONE">DONE</span>,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.

 <li><p>If parsing <var title>mime</var> analogously to the value of
 the <code>Content-Type</code> header fails,
 <span data-anolis-spec=dom title=concept-throw>throw</span> a
 "<code data-anolis-spec=dom>SyntaxError</code>" exception.

 <li><p>If <var title>mime</var> is successfully parsed, set
 <span>override MIME type</span> to its MIME type,
 excluding any parameters, and
 <span data-anolis-spec=dom>converted to ASCII lowercase</span>.

 <li><p>If a <code>charset</code> parameter is successfully parsed, set
 <span>override charset</span> to its value.
</ol>



<h4>The <code title>responseType</code> attribute</h4>


<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-responseType>responseType</code> [ = <var title>value</var> ]</code>
 <dd>
	<p>Returns the response type.
	<p>Can be set to change the response type. Values are:
	the empty string (default),
	"<code title>arraybuffer</code>",
	"<code title>blob</code>",
	"<code title>document</code>",
	"<code title>json</code>", and
	"<code title>text</code>".
	<p>When set: setting to "<code title>document</code>" is ignored if the
	<span data-anolis-spec=html>JavaScript global environment</span> is a
	<span data-anolis-spec=html>worker environment</span>
	<p>When set: throws an
	"<code data-anolis-spec=dom>InvalidStateError</code>" exception if the
	state is <span title="dom-XMLHttpRequest-LOADING">LOADING</span> or
	<span title="dom-XMLHttpRequest-DONE">DONE</span>.
	<p>When set: throws an
	"<code data-anolis-spec=dom>InvalidAccessError</code>" exception if the
	<span>synchronous flag</span> is set and the
	<span data-anolis-spec=html>JavaScript global environment</span> is a
	<span data-anolis-spec=html>document environment</span>.
</dl>


<p>The
<dfn title="dom-XMLHttpRequest-responseType"><code>responseType</code></dfn>
attribute must return its value. Initially its value must be the empty
string.

<p>Setting the
<code title="dom-XMLHttpRequest-responseType">responseType</code>
attribute must run these steps:

<ol>
 <li><p>If the state is <span title="dom-XMLHttpRequest-LOADING">LOADING</span> or
 <span title="dom-XMLHttpRequest-DONE">DONE</span>,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.

 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>document environment</span> and the
 <span>synchronous flag</span> is set,
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidAccessError</code>" exception.

 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>worker environment</span> and the given
 value is "<code title>document</code>", terminate these steps.

 <li><p>Set the
 <code title="dom-XMLHttpRequest-responseType">responseType</code>
 attribute's value to the given value.
</ol>




<h4>The <code title>response</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-response>response</span></code>
 <dd><p>Returns the <span>response entity body</span>.
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-response"><code>response</code></dfn>
attribute must return the result of running these
steps:

<dl class=switch>
 <dt>If <code title="dom-XMLHttpRequest-responseType">responseType</code>
 is the empty string or "<code title>text</code>"</dt>
 <dd>
	<ol>
	 <li><p>If the state is not <span title="dom-XMLHttpRequest-LOADING">LOADING</span> or
	 <span title="dom-XMLHttpRequest-DONE">DONE</span>, return the empty string.

	 <li><p>If the <span>error flag</span> is set, return the empty string.

	 <li><p>Return the <span>text response entity body</span>.
	</ol>

 <dt>Otherwise</dt>
 <dd>
	<ol>
	 <li><p>If the state is not <span title="dom-XMLHttpRequest-DONE">DONE</span>, return
	 null.

	 <li><p>If the <span>error flag</span> is set, return null.

	 <li>
		<dl class=switch>
		 <dt>If
		 <code title="dom-XMLHttpRequest-responseType">responseType</code> is
		 "<code title>arraybuffer</code>"</dt>
		 <dd><p>Return the
		 <span>arraybuffer response entity body</span>.</dd>

		 <dt>If
		 <code title="dom-XMLHttpRequest-responseType">responseType</code> is
		 "<code title>blob</code>"</dt>
		 <dd><p>Return the
		 <span>blob response entity body</span>.</dd>

		 <dt>If
		 <code title="dom-XMLHttpRequest-responseType">responseType</code> is
		 "<code title>document</code>"</dt>
		 <dd><p>Return the
		 <span>document response entity body</span>.</dd>

		 <dt>If
		 <code title="dom-XMLHttpRequest-responseType">responseType</code> is
		 "<code title>json</code>"</dt>
		 <dd><p>Return the
		 <span>JSON response entity body</span>.</dd>
		</dl>
	</ol>
</dl>



<h4>The <code title>responseText</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title="dom-XMLHttpRequest-responseText">responseText</span></code>
 <dd>
	<p>Returns the <span>text response entity body</span>.

	<p>Throws an "<code data-anolis-spec=dom>InvalidStateError</code>"
	exception if
	<code title="dom-XMLHttpRequest-responseType">responseType</code> is not
	the empty string or "<code title>text</code>".
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-responseText"><code>responseText</code></dfn>
attribute must return the result of running these
steps:

<ol>

 <li><p>If <code title="dom-XMLHttpRequest-responseType">responseType</code> is not the
 empty string or "<code title>text</code>",
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.


 <li><p>If the state is not <span title="dom-XMLHttpRequest-LOADING">LOADING</span> or
 <span title="dom-XMLHttpRequest-DONE">DONE</span>, return the empty string.

 <li><p>If the <span>error flag</span> is set, return the empty string.

 <li><p>Return the <span>text response entity body</span>.
</ol>


<h4>The <code title>responseXML</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-responseXML>responseXML</span></code>
 <dd>
	<p>Returns the <span>document response entity body</span>.

	<p>Throws an "<code data-anolis-spec=dom>InvalidStateError</code>"
	exception if
	<code title="dom-XMLHttpRequest-responseType">responseType</code> is not
	the empty string or "<code title>document</code>".
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-responseXML"><code>responseXML</code></dfn>
attribute must return the result of running these steps:

<ol>

 <li><p>If
 <code title="dom-XMLHttpRequest-responseType">responseType</code> is not
 the empty string or "<code title>document</code>",
 <span data-anolis-spec=dom title=concept-throw>throw</span> an
 "<code data-anolis-spec=dom>InvalidStateError</code>" exception.


 <li><p>If the state is not <span title="dom-XMLHttpRequest-DONE">DONE</span>, return
 null.

 <li><p>If the <span>error flag</span> is set, return null.

 <li><p>Return the <span>document response entity body</span>.
</ol>


<p class=note>The
<code title="dom-XMLHttpRequest-responseXML">responseXML</code> attribute
has XML in its name for historical reasons. It also returns HTML resources
as documents.


<h3 id="events">Events summary</h3>

<p><em>This section is non-normative.</em>

<p>The following events are dispatched on <code>XMLHttpRequest</code>
and/or <code>XMLHttpRequestUpload</code> objects:

<table>
 <thead>
	<tr>
	 <th>Event name</th>
	 <th>Interface</th>
	 <th>Dispatched when&hellip;</th>
	</tr>
 </thead>
 <tbody>
	<tr>
	 <td><dfn title="event-xhr-readystatechange"><code>readystatechange</code></dfn></td>
	 <td><code data-anolis-spec=dom>Event</code></td>
	 <td>The <code title="dom-XMLHttpRequest-readyState">readyState</code>
	 attribute changes at some seemingly arbitrary times for historical
	 reasons.</td>
	</tr>
	<tr>
	 <td><dfn title="event-xhr-loadstart"><code>loadstart</code></dfn></td>
	 <td><code>ProgressEvent</code></td>
	 <td>When the request starts.</td>
	</tr>
	<tr>
	 <td><dfn title="event-xhr-progress"><code>progress</code></dfn></td>
	 <td><code>ProgressEvent</code></td>
	 <td>While sending and loading data.</td>
	</tr>
	<tr>
	 <td><dfn title="event-xhr-abort"><code>abort</code></dfn></td>
	 <td><code>ProgressEvent</code></td>
	 <td>When the request has been aborted. For instance, by invoking the
	 <code title="dom-XMLHttpRequest-abort">abort()</code> method.</td>
	</tr>
	<tr>
	 <td><dfn title="event-xhr-error"><code>error</code></dfn></td>
	 <td><code>ProgressEvent</code></td>
	 <td>When the request has failed.</td>
	</tr>
	<tr>
	 <td><dfn title="event-xhr-load"><code>load</code></dfn></td>
	 <td><code>ProgressEvent</code></td>
	 <td>When the request has successfully completed.</td>
	</tr>
	<tr>
	 <td><dfn title="event-xhr-timeout"><code>timeout</code></dfn></td>
	 <td><code>ProgressEvent</code></td>
	 <td>When the author specified timeout has passed before the request
	 could complete.</td>
	</tr>
	<tr>
	 <td><dfn title="event-xhr-loadend"><code>loadend</code></dfn></td>
	 <td><code>ProgressEvent</code></td>
	 <td>When the request has completed (either in success or failure).</td>
	</tr>
 </tbody>
</table>



<h2>Interface <code title>FormData</code></h2>

<p>The <code>FormData</code> object represents an ordered collection of
entries. Each entry has a name, a value, a type, and optionally a filename
(if type is "file").

<pre class="idl">[<span title="dom-FormData">Constructor</span>(optional <span data-anolis-spec=html>HTMLFormElement</span> <var>form</var>)]
interface <dfn>FormData</dfn> {
  void <span title="dom-FormData-append">append</span>(DOMString <var>name</var>, <span data-anolis-spec=fileapi>Blob</span> <var title>value</var>, optional DOMString <var title>filename</var>);
  void <span title="dom-FormData-append">append</span>(DOMString <var>name</var>, DOMString <var>value</var>);
};</pre>

<dl class=domintro>
 <dt><code><var title>fd</var> = new <span title="dom-FormData">FormData</span>([<var title>form</var>])</code>
 <dd><p>Returns a new <code>FormData</code> object, optionally initialized
 with the data from <var title>form</var> (if given).

 <dt><code><var title>fd</var> . <span title=dom-FormData-append>append</span>(<var title>name</var>, <var title>value</var> [, <var title>filename</var>])</code>
 <dd><p>Appends a new entry to the <code>FormData</code> object.
</dl>

<p>The
<dfn title="dom-FormData"><code>FormData(<var>form</var>)</code></dfn>
constructor must run these steps:

<ol>
 <li><p>Let <var title>fd</var> be a new <code>FormData</code> object.

 <li><p>If <var>form</var> is given, set <var title>fd</var>'s entries to
 the result of
 <span data-anolis-spec=html>constructing the form data set</span> for
 <var>form</var>.

 <li><p>Return <var title>fd</var>.
</ol>

<p>The
<dfn title="dom-FormData-append" id="dom-formdata-append"><code>append(<var>name</var>, <var>value</var>, <var>filename</var>)</code></dfn>
method must create a new entry with the following parameters set and append
it to the end of the collection the <code>FormData</code> object represents:

<ul>
 <li><p>Set its name to <var>name</var>.

 <li><p>Set its value to <var>value</var>.

 <li><p>Set its type to "text" if <var>value</var> is a string and "file" if
 it is a <code data-anolis-spec=fileapi>Blob</code>.

 <li><p>If its type is "file" set its filename to "<code title>blob</code>".

 <li><p>If its type is "file" and <var>value</var> is a
 <code data-anolis-spec=fileapi>File</code> whose
 <code data-anolis-spec=fileapi title=dom-File-name>name</code> attribute
 is not the empty string, set entry's filename to the attribute's value.

 <li><p>If the <var title>filename</var> parameter is not omitted set
 entry's filename to <var title>filename</var>.
</ul>



<h2>Interface <code title="">ProgressEvent</code></h2>

<pre class="idl">[Constructor(DOMString <var title>type</var>, optional <span>ProgressEventInit</span> <var title>eventInitDict</var>)]
interface <dfn>ProgressEvent</dfn> : <span data-anolis-spec=dom>Event</span> {
  readonly attribute boolean <span title="dom-ProgressEvent-lengthComputable">lengthComputable</span>;
  readonly attribute unsigned long long <span title="dom-ProgressEvent-loaded">loaded</span>;
  readonly attribute unsigned long long <span title="dom-ProgressEvent-total">total</span>;
};

dictionary <dfn>ProgressEventInit</dfn> : <span data-anolis-spec=dom>EventInit</span> {
  boolean <span title="dom-ProgressEventInit-lengthComputable">lengthComputable</span>;
  unsigned long long <span title="dom-ProgressEventInit-loaded">loaded</span>;
  unsigned long long <span title="dom-ProgressEventInit-total">total</span>;
}</pre>

<p><span data-anolis-spec=dom title=concept-event>Events</span> using
the <code>ProgressEvent</code> interface indicate some kind of
progression.

<p>The
<dfn id="dom-progressevent-lengthcomputable" title="dom-ProgressEvent-lengthComputable"><code>lengthComputable</code></dfn>
attribute must return the value it was initialized to. When an
<span data-anolis-spec=dom title=concept-event>event</span> is created
the attribute must be initialized to false.

<p>The
<dfn id="dom-progressevent-loaded" title="dom-ProgressEvent-loaded"><code>loaded</code></dfn> and
<dfn id="dom-progressevent-total" title="dom-ProgressEvent-total"><code>total</code></dfn>
attributes must return the value they were initialized to. When an
<span data-anolis-spec=dom title=concept-event>event</span> is created
the attributes must be initialized to 0.


<h3>Firing events using the <code title="">ProgressEvent</code> interface for HTTP</h3>

<p>To
<dfn id=concept-event-fire-progress title=concept-event-fire-progress>fire a progress event named <var>e</var></dfn>
means to
<span data-anolis-spec=dom title=concept-event-fire>fire an event named <var>e</var></span>
with an <span data-anolis-spec=dom title=concept-event>event</span>
using the <code>ProgressEvent</code> interface that also meets these
conditions:

<ul>
 <li>Initialize the <code title=dom-ProgressEvent-loaded>loaded</code>
 attribute to the number of HTTP
 <span data-anolis-spec=http>entity body</span> bytes transferred.
 <li>If the length of the HTTP
 <span data-anolis-spec=http>entity body</span> is known through the
 <code data-anolis-spec=http title=http-content-length>Content-Length</code>
 header, initialize the
 <code title=dom-ProgressEvent-lengthComputable>lengthComputable</code>
 attribute to true and initialize the
 <code title=dom-ProgressEvent-total>total</code> attribute to the length.
</ul>


<h3>Firing events using the <code title="">ProgressEvent</code> interface for other contexts</h3>

<p>This is left as an exercise for the editor of the specification that
introduces such a context. The editor is encouraged to define it in a way
consistent with this and other specifications that utilize
<span data-anolis-spec=dom title=concept-event>events</span> using the
<code>ProgressEvent</code> interface.


<h3>Suggested names for events using the <code title="">ProgressEvent</code> interface</h3>

<p><em>This section is non-normative.</em>

<p>The suggested <code data-anolis-spec=dom title=dom-Event-type>type</code>
attribute values for use with
<span data-anolis-spec=dom title=concept-event>events</span> using the
<code>ProgressEvent</code> interface are summarized in the table below.
Specification editors are free to tune the details to their specific
scenarios, though are strongly encouraged to discuss their usage with the
WHATWG community to ensure input from people familiar with the subject.

<table>
 <tbody>
  <tr>
   <th><code data-anolis-spec=dom title=dom-Event-type>type</code> attribute value
   <th>Description
   <th>Times
   <th>When
  <tr>
   <th><code title="">loadstart</code>
   <td>Progress has begun.
   <td>Once.
   <td>First.
  <tr>
   <th><code title="">progress</code>
   <td>In progress.
   <td>Zero or more.
   <td>After <code title="">loadstart</code> has been
    <span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>.
  <tr>
   <th><code title="">error</code>
   <td>Progression failed.
   <td>Zero or once.
   <td rowspan="3">After the last <code title="">progress</code> has
    been
    <span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>,
    or after <code title="">loadstart</code> has been
    <span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>
    if <code title="">progress</code> has not been
    <span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>.
  <tr>
   <th><code>abort</code>
   <td>Progression is terminated.
   <td>Zero or once.
  <tr>
   <th><code>load</code>
   <td>Progression is successful.
   <td>Zero or once.
  <tr>
   <th><code title="">loadend</code>
   <td>Progress has stopped.
   <td>Once.</td>
   <td>After one of <code title="">error</code>,
    <code title="">abort</code>, or <code title="">load</code> has been
    <span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>.
</table>

<p>The <code title="">error</code>, <code title="">abort</code>, and
<code title="">load</code> event types are mutually exclusive.

<p>Throughout the web platform the <code title="">error</code>,
<code title="">abort</code>, and <code title="">load</code> event types have
their <code data-anolis-spec=dom title=dom-Event-bubbles>bubbles</code> and
<code data-anolis-spec=dom title=dom-Event-cancelable>cancelable</code>
attributes initialized to false, so it is suggested that for consistency all
<span data-anolis-spec=dom title=concept-event>events</span> using the
<code>ProgressEvent</code> interface do the same.


<h3>Security Considerations</h3>

<p>For cross-origin requests some kind of opt-in, e.g.
Cross-Origin Resource Sharing, has to be used before
<span data-anolis-spec=dom title=concept-event>events</span> using the
<code>ProgressEvent</code> interface are
<span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>
as information (e.g. size) would be revealed that cannot be obtained
otherwise. <span data-anolis-ref class=informative>CORS</span>


<h3>Example</h3>

<div class="example">
 <p>In this example <code>XMLHttpRequest</code>, combined with concepts
 defined in the sections before, and the HTML
 <code data-anolis-spec=html>progress</code> element are used together to
 display the process of
 <span data-anolis-spec=html title=fetch>fetching</span> a resource.

 <pre>&lt;!DOCTYPE html>
&lt;title>Waiting for Magical Unicorns&lt;/title>
&lt;progress id=p>&lt;/progress>
&lt;script>
  var progressBar = document.getElementById("p"),
      client = new XMLHttpRequest()
  client.open("GET", "magical-unicorns")
  client.onprogress = function(pe) {
    if(pe.lengthComputable) {
      progressBar.max = pe.total
      progressBar.value = pe.loaded
    }
  }
  client.onloadend = function(pe) {
    progressBar.value = pe.loaded
  }
  client.send()
&lt;/script></pre>

 <p>Fully working code would of course be more elaborate and deal with more
 scenarios, such as network errors or the end user terminating the request.
</div>



<h2><code>data:</code> URLs and HTTP</h2>

<p class=note>To ensure
<span data-anolis-spec=html title=data-protocol><code>data:</code> URLs</span>
can function in APIs designed around HTTP, such as
<code>XMLHttpRequest</code>, this section details how they work.
Specifications defining similar URL schemes ought to take inspiration from
this section.

<p>When a
<span data-anolis-spec=html title=data-protocol><code>data:</code> URL</span> is
<span data-anolis-spec=html title=fetch>fetched</span> using the HTTP method
<code>GET</code>, determine the response as follows:

<ul>
 <li><p>Ignore any request headers.

 <li><p>Set the HTTP status code to 200.

 <li><p>Set the HTTP status text to "<code title>OK</code>".

 <li><p>Include a single response header whose header field name is
 "<code title>content-type</code>" and whose value is the
 MIME type (including any parameters) given in the
 <span data-anolis-spec=html title=data-protocol><code>data:</code> URL</span>,
 or the default otherwise.

 <li><p>Set the <span>response entity body</span> to the data the
 <span data-anolis-spec=url>URL</span> encodes, base64 decoded if the
 "<code title>;base64</code>" flag is present.
</ul>

<p>Otherwise, including when the
<span data-anolis-spec=html title=data-protocol><code>data:</code> URL</span> cannot be
parsed, this is a network error.



<h2 class=no-num>References</h2>
<div id=anolis-references></div>



<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

<p>The editor would like to thank

Addison Phillips,
Adrian Bateman,
Ahmed Kamel,
Alex Hopmann,
Alex Vincent,
Alexey Proskuryakov,
Andrea Marchesini,
Asbj&oslash;rn Ulsberg,
Boris Zbarsky,
Bj&ouml;rn H&ouml;hrmann,
Cameron McCormack,
Chris Marrin,
Christophe Jolif,
Charles McCathieNevile,
Dan Winship,
David Andersson,
David Flanagan,
David H&aring;s&auml;ther,
David Levin,
Dean Jackson,
Denis Sureau,
Dominik Rttsches,
Doug Schepers,
Douglas Livingstone,
Elliotte Harold,
Eric Lawrence,
Eric Uhrhane,
Erik Dahlstr&ouml;m,
Feras Moussa,
Geoffrey Sneddon,
Gideon Cohn,
Glenn Adams,
Gorm Haug Eriksen,
H&aring;kon Wium Lie,
Hallvord R. M. Steen,
Henri Sivonen,
Huub Schaeks,
Ian Davis,
Ian Hickson,
Ivan Herman,
Jarred Nicholls,
Jeff Walden,
Jens Lindstr&ouml;m,
Jim Deegan,
Jim Ley,
Joe Farro,
Jonas Sicking,
Julian Reschke,
 (Kang-Hao Lu),
Karl Dubost,
Lachlan Hunt,
Maciej Stachowiak,
Magnus Kristiansen,
Marc Hadley,
Marcos Caceres,
Mark Baker,
Mark Birbeck,
Mark Nottingham,
Mark S. Miller,
Martin Hassman,
Mohamed Zergaoui,
Ms2ger,
Odin H&oslash;rthe Omdal,
Olli Pettay,
Pawel Glowacki,
Peter Michaux,
Philip Taylor,
Robin Berjon,
Rune Halvorsen,
Ruud Steltenpool,
Sergiu Dumitriu,
Sigbj&oslash;rn Finne,
Simon Pieters,
Stewart Brodie,
Sunava Dutta,
Thomas Roessler,
Tom Magliery,
Travis Leithead,
Yehuda Katz, and
Zhenbin Xu

for their contributions to this specification.

<p>Special thanks to the Microsoft employees who first implemented the
<code title>XMLHttpRequest</code> interface, which was first widely
deployed by the Windows Internet Explorer browser.

<p>Special thanks also to the WHATWG for drafting an initial version of
this specification in their Web Applications 1.0 document (now renamed to
HTML). <span data-anolis-ref>HTML</span>

<p>Special thanks to the SVG WG for drafting the original
<code title="">ProgressEvent</code> interface as part of the
<a href="http://www.w3.org/TR/2008/REC-SVGTiny12-20081222/svgudom.html">SVG Micro DOM</a>.

<p>Thanks also to all those who have helped to improve this specification by
sending suggestions and corrections. (Please, keep bugging us with your
issues!)

<script id=head src=http://www.whatwg.org/specs/web-apps/current-work/dfn.js></script>
