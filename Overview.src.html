<!doctype html><html lang=en-US><meta charset=utf-8>
<title>XMLHttpRequest Standard</title>
<link href=//whatwg.org/style/specification rel=stylesheet>
<link href=//resources.whatwg.org/logo-xhr.svg rel=icon>

<div class="head">

<p><a class=logo href=//whatwg.org/><img alt=WHATWG src=//resources.whatwg.org/logo-xhr.svg width=100 height=100></a>
<h1 id="xmlhttprequest-ls">XMLHttpRequest</h1>
<h2 class="no-num no-toc">Living Standard &mdash; Last Updated [DATE: 3 August 2002]</h2>

<dl>
 <dt>Participate:
 <dd>Send feedback to
  <a href="mailto:public-webapps@w3.org?subject=%5Bxhr%5D%20">public-webapps@w3.org</a>
  (<a href="http://lists.w3.org/Archives/Public/public-webapps/">archives</a>) or
  <a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WebAppsWG&amp;component=XHR">file a bug</a>
  (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WebAppsWG&amp;component=XHR&amp;resolution=---">open bugs</a>)
 <dd><a href="https://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt id=xmlhttprequest-tests>Tests:
 <dd><a href="http://w3c-test.org/XMLHttpRequest/">XMLHttpRequest tests</a> are hosted in
  the <a href="https://github.com/w3c/web-platform-tests/">W3C Web platform testsuite</a>
  &mdash; contributions welcome!

 <dt>Commits:
 <dd><a href=https://github.com/whatwg/xhr/commits>https://github.com/whatwg/xhr/commits</a>
 <dd><a href=https://twitter.com/xhrstandard>@xhrstandard</a>
</dl>

<script src=//resources.whatwg.org/file-bug.js async></script>
<script src=annotate_spec.js async></script>

</div>



<h2 class="no-num no-toc" id="specabstract">Abstract</h2>

<p>XMLHttpRequest defines an API that provides scripted client functionality for
transferring data between a client and a server.



<h2 class="no-num no-toc" id="toc">Table of Contents</h2>

<!--toc-->



<h2 id="introduction">Introduction</h2>

<p><em>This section is non-normative.</em>

<p>The <code>XMLHttpRequest</code> object is an API for
<span data-anolis-spec=fetch title=concept-fetch>fetching</span> resources.

<p>The name <code>XMLHttpRequest</code> is historical and has no bearing on its
functionality.

<div class="example">
 <p>Some simple code to do something with data from an XML document
 fetched over the network:

 <pre><code>function processData(data) {
  // taking care of data
}

function handler() {
  if(this.status == 200 &amp;&amp;
    this.responseXML != null &amp;&amp;
    this.responseXML.getElementById('test').textContent) {
    // success!
    processData(this.responseXML.getElementById('test').textContent);
  } else {
    // something went wrong
    &hellip;
  }
}

var client = new XMLHttpRequest();
client.onload = handler;
client.open("GET", "unicorn.xml");
client.send();</code></pre>

 <p>If you just want to log a message to the server:

 <pre><code>function log(message) {
  var client = new XMLHttpRequest();
  client.open("POST", "/log");
  client.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
  client.send(message);
}</code></pre>

 <p>Or if you want to check the status of a document on the server:

 <pre><code>function fetchStatus(address) {
  var client = new XMLHttpRequest();
  client.onload = function() {
    // in case of network errors this might not give reliable results
    returnStatus(this.status);
  }
  client.open("HEAD", address);
  client.send();
}</code></pre>
</div>


<h3>Specification history</h3>

<p>The <code>XMLHttpRequest</code> object was initially defined as part of
the WHATWG's HTML effort. (Based on Microsoft's implementation many years prior.)
It moved to the W3C in 2006. Extensions (e.g. progress events and
cross-origin requests) to <code>XMLHttpRequest</code> were developed in a
separate draft (XMLHttpRequest Level 2) until end of 2011, at which point
the two drafts were merged and <code>XMLHttpRequest</code> became a single
entity again from a standards perspective. End of 2012 it moved back to the
WHATWG.

<p>Discussion that led to the current draft can be found in the following mailing list
archives:

<ul class=brief>
 <li><a href="http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/">whatwg@whatwg.org</a>
 <li><a href="http://lists.w3.org/Archives/Public/public-webapps/">public-webapps@w3.org</a>
 <li><a href="http://lists.w3.org/Archives/Public/public-webapi/">public-webapi@w3.org</a>
 <li><a href="http://lists.w3.org/Archives/Public/public-appformats/">public-appformats@w3.org</a>
</ul>



<h2 id="conformance">Conformance</h2>

<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<span data-anolis-ref>RFC2119</span>


<h3 id="extensibility">Extensibility</h3>

<p>User agents, Working Groups, and other interested parties are
<em>strongly encouraged</em> to discuss new features with the WHATWG
community.



<h2 id="terminology">Terminology</h2>

<p>This specification uses terminology, cross-linked throughout, from DOM,
DOM Parsing and Serialization, Encoding, Fetch, File API, HTML, HTTP, URL, Web IDL, and
XML.

<span data-anolis-ref>DOM</span>
<span data-anolis-ref>DOMPS</span>
<span data-anolis-ref>ENCODING</span>
<span data-anolis-ref>FETCH</span>
<span data-anolis-ref>FILEAPI</span>
<span data-anolis-ref>HTML</span>
<span data-anolis-ref>HTTP</span>
<span data-anolis-ref>URL</span>
<span data-anolis-ref>WEBIDL</span>
<span data-anolis-ref>XML</span> <span data-anolis-ref>XMLNS</span>

<p>It uses the typographic conventions from HTML. <span data-anolis-ref>HTML</span>

<p>The term <dfn>user credentials</dfn> for the purposes of this
specification means cookies, HTTP authentication, and client-side SSL
certificates. Specifically it does not refer to proxy authentication or the
<code title="http-origin">Origin</code> header.
<span data-anolis-ref>COOKIES</span> <!-- XXX ref? -->



<h2>Interface <code title>XMLHttpRequest</code></h2>

<pre class="idl">[Exposed=(Window,Worker)]
interface <dfn id="xmlhttprequesteventtarget">XMLHttpRequestEventTarget</dfn> : <span data-anolis-spec=dom>EventTarget</span> {
  // <a href="#event-handlers">event handlers</a>
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onloadstart">onloadstart</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onprogress">onprogress</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onabort">onabort</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onerror">onerror</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onload">onload</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-ontimeout">ontimeout</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onloadend">onloadend</span>;
};

[Exposed=(Window,Worker)]
interface <dfn id="xmlhttprequestupload">XMLHttpRequestUpload</dfn> : <span>XMLHttpRequestEventTarget</span> {
};

enum <dfn>XMLHttpRequestResponseType</dfn> {
  "",
  "arraybuffer",
  "blob",
  "document",
  "json",
  "text"
};

[<span title="dom-XMLHttpRequest">Constructor</span>,
 Exposed=(Window,Worker)]
interface <dfn id="xmlhttprequest">XMLHttpRequest</dfn> : <span>XMLHttpRequestEventTarget</span> {
  // <a href="#event-handlers">event handler</a>
  attribute <span data-anolis-spec=html>EventHandler</span> <span title="handler-xhr-onreadystatechange">onreadystatechange</span>;

  // <a href="#states">states</a>
  const unsigned short <span title="dom-XMLHttpRequest-UNSENT">UNSENT</span> = 0;
  const unsigned short <span title="dom-XMLHttpRequest-OPENED">OPENED</span> = 1;
  const unsigned short <span title="dom-XMLHttpRequest-HEADERS_RECEIVED">HEADERS_RECEIVED</span> = 2;
  const unsigned short <span title="dom-XMLHttpRequest-LOADING">LOADING</span> = 3;
  const unsigned short <span title="dom-XMLHttpRequest-DONE">DONE</span> = 4;
  readonly attribute unsigned short <span title="dom-XMLHttpRequest-readyState">readyState</span>;

  // <a href="#request">request</a>
  void <span title="dom-XMLHttpRequest-open">open</span>(ByteString <var>method</var>, USVString <var title>url</var>);
  void <span title="dom-XMLHttpRequest-open">open</span>(ByteString <var>method</var>, USVString <var title>url</var>, boolean <var>async</var>, optional USVString? <var>username</var> = null, optional USVString? <var>password</var> = null);
  void <span title="dom-XMLHttpRequest-setRequestHeader">setRequestHeader</span>(ByteString <var>name</var>, ByteString <var>value</var>);
           attribute unsigned long <span title="dom-XMLHttpRequest-timeout">timeout</span>;
           attribute boolean <span title="dom-XMLHttpRequest-withCredentials">withCredentials</span>;
  readonly attribute <span>XMLHttpRequestUpload</span> <span title="dom-XMLHttpRequest-upload">upload</span>;
  void <span title="dom-XMLHttpRequest-send">send</span>(optional (<span data-anolis-spec=dom>Document</span> or <span data-anolis-spec=fetch>BodyInit</span>)? <var>body</var> = null);
  void <span title="dom-XMLHttpRequest-abort">abort</span>();

  // <a href="#response">response</a>
  readonly attribute USVString <span title=dom-XMLHttpRequest-responseURL>responseURL</span>;
  readonly attribute unsigned short <span title="dom-XMLHttpRequest-status">status</span>;
  readonly attribute ByteString <span title="dom-XMLHttpRequest-statusText">statusText</span>;
  ByteString? <span title="dom-XMLHttpRequest-getResponseHeader">getResponseHeader</span>(ByteString <var>name</var>);
  ByteString <span title="dom-XMLHttpRequest-getAllResponseHeaders">getAllResponseHeaders</span>();
  void <span title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType</span>(DOMString <var>mime</var>);
           attribute <span>XMLHttpRequestResponseType</span> <span title="dom-XMLHttpRequest-responseType">responseType</span>;
  readonly attribute any <span title="dom-XMLHttpRequest-response">response</span>;
  readonly attribute USVString <span title="dom-XMLHttpRequest-responseText">responseText</span>;
  [Exposed=Window] readonly attribute <span data-anolis-spec=dom>Document</span>? <span title="dom-XMLHttpRequest-responseXML">responseXML</span>;
};</pre>

<p>An <code>XMLHttpRequest</code> object has an associated
<code>XMLHttpRequestUpload</code> object.

<p>An <code>XMLHttpRequest</code> object has an associated
<dfn title=concept-XMLHttpRequest-state>state</dfn>, which is one of
<i title>unsent</i>,
<i title>opened</i>,
<i title>headers received</i>,
<i title>loading</i>, and
<i title>done</i>. Unless stated otherwise it is <i title>unsent</i>.

<p>An <code>XMLHttpRequest</code> object has an associated
<dfn id=send-flag><code>send()</code> flag</dfn>. Unless stated otherwise it is unset.

<p>An <code>XMLHttpRequest</code> object has an associated <dfn>stop timeout flag</dfn>.
Unless stated otherwise it is unset.


<h3 id="constructors">Constructors</h3>

<p>The <code>XMLHttpRequest</code> object has an associated
<dfn title=concept-XMLHttpRequest-settings-object>settings object</dfn>.

<dl class=domintro>
 <dt><code><var title>client</var> = new <span title=dom-XMLHttpRequest>XMLHttpRequest</span>()</code>
 <dd>Returns a new <code>XMLHttpRequest</code> object.
</dl>

<p>The
<dfn title="dom-XMLHttpRequest"><code>XMLHttpRequest()</code></dfn>
constructor must run these steps:

<ol>
 <li><p>Let <var title>xhr</var> be a new <code>XMLHttpRequest</code>
 object.

 <li><p>Set <var title>xhr</var>'s
 <span title=concept-XMLHttpRequest-settings-object>settings object</span> to the
 <span data-anolis-spec=html title="relevant settings object for a global object">relevant settings object</span>
 for the global object of <var title>xhr</var>'s interface object.

 <li><p>Return <var title>xhr</var>.
</ol>


<h3>Garbage collection</h3>
<!-- Based on EventSource and WebSocket. Not sure what I am doing. -->

<p>An <code>XMLHttpRequest</code> object must not be garbage collected if its
<span title=concept-XMLHttpRequest-state>state</span> is either
<i title>opened</i> with the <span><code>send()</code> flag</span> set,
<i title>headers received</i>, or <i title>loading</i>, and it has one or more
<span data-anolis-spec=dom title=concept-event-listener>event listeners</span>
registered whose <b>type</b> is one of
<code title=event-xhr-readystatechange>readystatechange</code>,
<code title=event-xhr-progress>progress</code>,
<code title=event-xhr-abort>abort</code>,
<code title=event-xhr-error>error</code>,
<code title=event-xhr-load>load</code>,
<code title=event-xhr-timeout>timeout</code>, and
<code title=event-xhr-loadend>loadend</code>.
<!-- No need to mention upload event listeners as they happen during /opened/. -->

<p>If an <code>XMLHttpRequest</code> object is garbage collected while its
connection is still open, the user agent must <span>terminate the request</span>.


<h3 id="event-handlers">Event handlers</h3>

<p>The following are the
<span data-anolis-spec=html>event handlers</span> (and their corresponding
<span data-anolis-spec=html title="event handler event type">event handler event types</span>)
that must be supported on objects implementing an interface that inherits
from <code>XMLHttpRequestEventTarget</code> as attributes:

<table>
 <thead>
  <tr>
   <th><span data-anolis-spec=html title="event handlers">event handler</span>
   <th><span data-anolis-spec=html>event handler event type</span>
 <tbody>
  <tr>
   <td><dfn title="handler-xhr-onloadstart"><code>onloadstart</code></dfn>
   <td><code title="event-xhr-loadstart">loadstart</code>
  <tr>
   <td><dfn title="handler-xhr-onprogress"><code>onprogress</code></dfn>
   <td><code title="event-xhr-progress">progress</code>
  <tr>
   <td><dfn title="handler-xhr-onabort"><code>onabort</code></dfn>
   <td><code title="event-xhr-abort">abort</code>
  <tr>
   <td><dfn title="handler-xhr-onerror"><code>onerror</code></dfn>
   <td><code title="event-xhr-error">error</code>
  <tr>
   <td><dfn title="handler-xhr-onload"><code>onload</code></dfn>
   <td><code title="event-xhr-load">load</code>
  <tr>
   <td><dfn title="handler-xhr-ontimeout"><code>ontimeout</code></dfn>
   <td><code title="event-xhr-timeout">timeout</code>
  <tr>
   <td><dfn title="handler-xhr-onloadend"><code>onloadend</code></dfn>
   <td><code title="event-xhr-loadend">loadend</code>
</table>

<p>The following is the
<span data-anolis-spec=html title="event handlers">event handler</span>
(and its corresponding
<span data-anolis-spec=html>event handler event type</span>) that must be
supported as attribute solely by the
<code>XMLHttpRequest</code> object:

<table>
 <thead>
  <tr>
   <th><span data-anolis-spec=html title="event handlers">event handler</span>
   <th><span data-anolis-spec=html>event handler event type</span>
 <tbody>
  <tr>
   <td><dfn title="handler-xhr-onreadystatechange"><code>onreadystatechange</code></dfn>
   <td><code title="event-xhr-readystatechange">readystatechange</code></td>
</table>


<h3 id="states">States</h3>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title="dom-XMLHttpRequest-readyState">readyState</span></code>
 <dd><p>Returns <var title>client</var>'s
 <span title=concept-XMLHttpRequest-state>state</span>.
</dl>

<p>The <dfn title="dom-XMLHttpRequest-readyState"><code>readyState</code></dfn>
attribute's getter must return the value from the table below in the cell of the second
column, from the row where the value in the cell in the first column is
<span data-anolis-spec=dom>context object</span>'s
<span title=concept-XMLHttpRequest-state>state</span>:

<table>
 <tr>
  <td><i title>unsent</i>
  <td><dfn title="dom-XMLHttpRequest-UNSENT"><code>UNSENT</code></dfn> (numeric value 0)
  <td>The object has been constructed.
 <tr>
  <td><i title>opened</i>
  <td><dfn title="dom-XMLHttpRequest-OPENED"><code>OPENED</code></dfn> (numeric value 1)
  <td>The <code title="dom-XMLHttpRequest-open">open()</code> method has been successfully
   invoked. During this state request headers can be set using
   <code title="dom-XMLHttpRequest-setRequestHeader">setRequestHeader()</code> and the
   fetch can be initiated using the <code title="dom-XMLHttpRequest-send">send()</code>
   method.
 <tr>
  <td><i title>headers received</i>
  <td><dfn title="dom-XMLHttpRequest-HEADERS_RECEIVED"><code>HEADERS_RECEIVED</code></dfn>
   (numeric value 2)
  <td>All redirects (if any) have been followed and all HTTP headers of the
   <span>response</span> have been received.
 <tr>
  <td><i title>loading</i>
  <td><dfn title="dom-XMLHttpRequest-LOADING"><code>LOADING</code></dfn> (numeric value 3)
  <td>The <span>response</span>'s
  <span data-anolis-spec=fetch title=concept-response-body>body</span> is being received.
 <tr>
  <td><i title>done</i>
  <td><dfn title="dom-XMLHttpRequest-DONE"><code>DONE</code></dfn> (numeric value 4)
  <td>The data transfer has been completed or something went wrong during the transfer
   (e.g. infinite redirects).
</table>


<h3 id="request">Request</h3>

<p>Each <code>XMLHttpRequest</code> object has the following
request-associated concepts:

<dfn>request method</dfn>,
<dfn>request URL</dfn>,
<dfn id="author-request-headers">author request headers</dfn>,
<dfn>request body</dfn>,
<dfn>synchronous flag</dfn>, and
<dfn id="upload-complete-flag">upload complete flag</dfn>.

<p>The <span>author request headers</span> is an initially empty
<span data-anolis-spec=fetch title=concept-header-list>header list</span>.

<p>The <span>request body</span> is initially null.

<p>The <span>synchronous flag</span> and <span>upload complete flag</span> are initially
unset.

<hr>

<p>To <dfn>terminate the request</dfn>,
<span data-anolis-spec=fetch title=concept-fetch-terminate>terminate</span> the
<span data-anolis-spec=fetch title=concept-fetch>fetch</span> algorithm operated by the
<code>XMLHttpRequest</code> object with reason <i title>fatal</i>.



<h4>The <code title>open()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-open>open</span>(<var title>method</var>, <var title>url</var> [, <var title>async</var> = true [, <var title>username</var> = null [, <var title>password</var> = null]]])</code>

 <dd>
  <p>Sets the <span>request method</span>, <span>request URL</span>, and
  <span>synchronous flag</span>.

  <p>Throws a <code>SyntaxError</code> exception if
  either <var title>method</var> is not a valid HTTP method or
  <var title>url</var> cannot be parsed.

  <p>Throws a <code>SecurityError</code> exception
  if <var title>method</var> is a case-insensitive match for
  `<code title>CONNECT</code>`, `<code title>TRACE</code>` or `<code title>TRACK</code>`.

  <p>Throws an <code>InvalidAccessError</code>
  exception if <var title>async</var> is false, the
  <span data-anolis-spec=html>JavaScript global environment</span> is a
  <span data-anolis-spec=html>document environment</span>, and either the
  <code title=dom-XMLHttpRequest-timeout>timeout</code> attribute is not
  zero, the
  <code title=dom-XMLHttpRequest-withCredentials>withCredentials</code>
  attribute is true, or the
  <code title=dom-XMLHttpRequest-responseType>responseType</code>
  attribute is not the empty string.
</dl>

<p class="critical no-backref" id=sync-warning>Synchronous <code>XMLHttpRequest</code>
outside of workers is in the process of being removed from the web platform as it has
detrimental effects to the end user's experience. (This is a long process that takes many
years.) Developers must not pass false for the <var title>async</var> argument  when the
<span data-anolis-spec=html>JavaScript global environment</span> is a
<span data-anolis-spec=html>document environment</span>. User agents are strongly encouraged to warn about such usage in developer tools and may experiment with
<span data-anolis-spec=webidl title=throw>throwing</span> an
<code>InvalidAccessError</code> exception when it occurs.

<p>The
<dfn id="dom-xmlhttprequest-open" title="dom-XMLHttpRequest-open"><code>open(<var title>method</var>, <var title>url</var>, <var title>async</var>, <var title>username</var>, <var title>password</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <span title=concept-XMLHttpRequest-settings-object>settings object</span>'s
 <span data-anolis-spec=html>responsible document</span> is not
 <span data-anolis-spec=html>fully active</span>,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li><p>Set <var title>base</var> to
 <span title=concept-XMLHttpRequest-settings-object>settings object</span>'s
 <span data-anolis-spec=html>API base URL</span>.

 <li><p>If <var>method</var> is not a
 <span data-anolis-spec=fetch title=concept-method>method</span>,
 <span data-anolis-spec=webidl title=throw>throw</span> a
 <code>SyntaxError</code> exception.

 <li><p>If <var>method</var> is a <span data-anolis-spec=fetch>forbidden method</span>,
 <span data-anolis-spec=webidl title=throw>throw</span> a
 <code>SecurityError</code> exception.

 <li><p><span data-anolis-spec=fetch title=concept-method-normalize>Normalize</span>
 <var>method</var>.

 <li><p>Let <var title>parsedURL</var> be the result of
 <span data-anolis-spec=url title=concept-url-parser>parsing</span> <var title>url</var>
 with <var title>base</var>.

 <li><p>If <var title>parsedURL</var> is failure,
 <span data-anolis-spec=webidl title=throw>throw</span> a
 <code>SyntaxError</code> exception.

 <li>
  <p>If the <var>async</var> argument is omitted, set <var>async</var> to true, and set
  <var title>username</var> and <var title>password</var> to null.

  <p class=note>Unfortunately legacy content prevents treating the <var>async</var>
  argument being <code title>undefined</code> identical from it being omitted.

 <li>
  <p>If <var title>parsedURL</var>'s <span data-anolis-spec=url>relative flag</span> is
  set, run these substeps:

  <ol>
   <li><p>If the <var title>username</var> argument is not null,
   <span data-anolis-spec=url>set the username</span> given <var title>parsedURL</var> and
   <var>username</var>.

   <li><p>If the <var title>password</var> argument is not null,
   <span data-anolis-spec=url>set the password</span> given <var title>parsedURL</var> and
   <var>password</var>.
  </ol>

 <li><p>If <var>async</var> is false, the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>document environment</span>, and either the
 <code title=dom-XMLHttpRequest-timeout>timeout</code> attribute value is not zero, the
 <code title=dom-XMLHttpRequest-withCredentials>withCredentials</code> attribute value is
 true, or the <code title=dom-XMLHttpRequest-responseType>responseType</code> attribute
 value is not the empty string,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidAccessError</code> exception.

 <li>
  <p><span>Terminate the request</span>.

  <p class=note>A <span data-anolis-spec=fetch title=concept-fetch>fetch</span> can be
  ongoing at this point.
  <!-- also unsets the send() flag -->

 <li>
  <p>Set variables associated with the object as follows:

  <ul>
   <li><p>Unset the <span>stop timeout flag</span>.
   <li><p>Set <span>request method</span> to <var>method</var>.
   <li><p>Set <span>request URL</span> to <var title>parsedURL</var>.
   <li><p>Set the <span>synchronous flag</span>, if <var>async</var> is false, and unset
   the <span>synchronous flag</span> otherwise.
   <li><p>Empty <span>author request headers</span>.
   <li><p>Set <span>response</span> to a
   <span data-anolis-spec=fetch title=concept-network-error>network error</span>.
   <li><p>Set <span>response <code>ArrayBuffer</code> object</span> to null.
   <li><p>Set <span>response <code>Blob</code> object</span> to null.
   <li><p>Set <span>response <code>Document</code> object</span> to null.
   <li><p>Set <span>response JSON object</span> to null.
  </ul>

 <li>
  <p>If the <span title=concept-XMLHttpRequest-state>state</span> is not
  <i title>opened</i>, run these substeps:

  <ol>
   <li><p>Set <span title=concept-XMLHttpRequest-state>state</span> to
   <i title>opened</i>.

   <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.
  </ol>
</ol>



<h4>The <code title>setRequestHeader()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-setRequestHeader>setRequestHeader</span>(<var>name</var>, <var>value</var>)</code>

 <dd>
  <p>Combines a <span data-anolis-spec=fetch title=concept-header>header</span> in
  <span>author request headers</span>.

  <p>Throws an <code>InvalidStateError</code>
  exception if either <span title=concept-XMLHttpRequest-state>state</span> is not
  <i title>opened</i> or the <span><code>send()</code> flag</span> is set.

  <p>Throws a <code>SyntaxError</code> exception if
  <var>name</var> is not a header name or if <var>value</var> is not a header value.
 </dd>
</dl>

<p class=note>As indicated in the algorithm below certain headers cannot
be set and are left up to the user agent. In addition there are certain
other headers the user agent will take control of if they are not set by
the author as indicated at the end of the
<code title="dom-XMLHttpRequest-send">send()</code> method section.

<p>The
<dfn id="dom-xmlhttprequest-setrequestheader" title="dom-XMLHttpRequest-setRequestHeader"><code>setRequestHeader(<var>name</var>, <var>value</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is not
 <i title>opened</i>, <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li><p>If the <span><code>send()</code> flag</span> is set,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li>
  <p>If <var>name</var> is not a
  <span data-anolis-spec=fetch title=concept-header-name>name</span> or <var>value</var>
  is not a <span data-anolis-spec=fetch title=concept-header-value>value</span>,
  <span data-anolis-spec=webidl title=throw>throw</span> a
  <code>SyntaxError</code> exception.

  <p class="note no-backref">An empty byte sequence represents an empty
  <span data-anolis-spec=fetch title=concept-header>header</span>
  <span data-anolis-spec=fetch title=concept-header-value>value</span>.

 <li><p>Terminate these steps if <var>name</var> is a
 <span data-anolis-spec=fetch>forbidden header name</span>.

 <li><p><span data-anolis-spec=fetch title=concept-header-list-combine>Combine</span>
 <var>name</var>/<var>value</var> in <span>author request headers</span>.
</ol>

<div class="example">
 <p>Some simple code demonstrating what happens when setting the same
 header twice:

 <pre><code>// The following script:
var client = new XMLHttpRequest();
client.open('GET', 'demo.cgi');
client.setRequestHeader('X-Test', 'one');
client.setRequestHeader('X-Test', 'two');
client.send();

// &hellip;results in the following header being sent:
X-Test: one, two</code></pre>
</div>


<h4>The <code title>timeout</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title="dom-XMLHttpRequest-timeout">timeout</span></code>
 <dd>
  <p>Can be set to a time in milliseconds. When set to a non-zero value
  will cause <span data-anolis-spec=fetch title=concept-fetch>fetching</span> to
  terminate after the given time has passed. When the time has passed, the request has
  not yet completed, and the <span>synchronous flag</span> is unset, a
  <code title=event-xhr-timeout>timeout</code> event will then be
  <span title=concept-event-dispatch data-anolis-spec=dom>dispatched</span>,
  or a <code>TimeoutError</code> exception will be
  <span data-anolis-spec=webidl title=throw>thrown</span> otherwise
  (for the <code title=dom-XMLHttpRequest-send>send()</code> method).
  <p>When set: throws an
  <code>InvalidAccessError</code> exception if
  the <span>synchronous flag</span> is set and the
  <span data-anolis-spec=html>JavaScript global environment</span> is a
  <span data-anolis-spec=html>document environment</span>.
 </dd>
</dl>

<p>The
<dfn id="dom-xmlhttprequest-timeout" title="dom-XMLHttpRequest-timeout"><code>timeout</code></dfn>
attribute must return its value. Initially its value must be zero.

<p>Setting the <code title="dom-XMLHttpRequest-timeout">timeout</code>
attribute must run these steps:

<ol>
 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>document environment</span> and the
 <span>synchronous flag</span> is set,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidAccessError</code> exception.

 <li><p>Set its value to the new value.
</ol>

<p class=note>This implies that the
<code title="dom-XMLHttpRequest-timeout">timeout</code> attribute can be
set while <span data-anolis-spec=fetch title=concept-fetch>fetching</span> is in
progress. If that occurs it will still be measured relative to the start
of <span data-anolis-spec=fetch title=concept-fetch>fetching</span>.


<h4>The <code title>withCredentials</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-withCredentials>withCredentials</span></code>
 <dd>
  <p>True when <span>user credentials</span> are to be included in a
  cross-origin request. False when they are to be excluded in a
  cross-origin request and when cookies are to be ignored in its response.
  Initially false.

  <p>When set: throws an
  <code>InvalidStateError</code> exception if
  <span title=concept-XMLHttpRequest-state>state</span> is not <i title>unsent</i> or
  <i title>opened</i>, or if the <span><code>send()</code> flag</span> is set.
  <p>When set: throws an
  <code>InvalidAccessError</code> exception if
  either the <span>synchronous flag</span> is set and the
  <span data-anolis-spec=html>JavaScript global environment</span> is a
  <span data-anolis-spec=html>document environment</span>.
 </dd>
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-withCredentials"><code>withCredentials</code></dfn>
attribute must return its value. Initially its value must be false.

<p>Setting the
<code title="dom-XMLHttpRequest-withCredentials">withCredentials</code>
attribute must run these steps:

<ol>
 <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is not
 <i title>unsent</i> or <i title>opened</i>,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li><p>If the <span><code>send()</code> flag</span> is set,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>document environment</span> and the
 <span>synchronous flag</span> is set,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidAccessError</code> exception.

 <li><p>Set the <code title="dom-XMLHttpRequest-withCredentials">withCredentials</code>
 attribute's value to the given value.
</ol>

<p class=note>The <code title="dom-XMLHttpRequest-withCredentials">withCredentials</code>
attribute has no effect when
<span data-anolis-spec=fetch title=concept-fetch>fetching</span>
<span data-anolis-spec=html title="same origin">same-origin</span> resources.


<h4>The <code title>upload</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-upload>upload</span></code>
 <dd><p>Returns the associated <code>XMLHttpRequestUpload</code>
 object. It can be used to gather transmission information when data is
 transferred to a server.
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-upload"><code>upload</code></dfn>
attribute must return the associated
<code>XMLHttpRequestUpload</code> object.

<p class=note>As indicated earlier, each <code>XMLHttpRequest</code>
object has an associated <code>XMLHttpRequestUpload</code> object.


<h4>The <code title>send()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-send>send</span>([<var title>body</var> = null])</code>
 <dd>
  <p>Initiates the request. The optional argument provides the
  <span>request body</span>. The argument is ignored if
  <span>request method</span> is <code>GET</code> or
  <code>HEAD</code>.

  <p>Throws an <code>InvalidStateError</code> exception if either
  <span title=concept-XMLHttpRequest-state>state</span> is not <i title>opened</i> or the
  <span><code>send()</code> flag</span> is set.
</dl>

<p>The <dfn title="dom-XMLHttpRequest-send"><code>send(<var>body</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is not
 <i title>opened</i>, <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li><p>If the <span><code>send()</code> flag</span> is set,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li><p>If the <span>request method</span> is <code>GET</code> or
 <code>HEAD</code>, set <var title>body</var> to null.

 <li>
  <p>If <var title>body</var> is null, go to the next step.

  <p>Otherwise, let <var>encoding</var> be null, <var>Content-Type</var> be null, and then
  follow these rules, depending on <var title>body</var>:

  <dl class=switch>
   <dt id=dom-xmlhttprequest-send-document><code data-anolis-spec=dom>Document</code>
   <dd>
    <p>Set <var>encoding</var> to `<code title>UTF-8</code>`.

    <p>If <var>body</var> is an <span data-anolis-spec=dom>HTML document</span>, set
    <var>Content-Type</var> to `<code>text/html</code>`, and set <var>Content-Type</var>
    to `<code>application/xml</code>` otherwise. Then append `<code>;charset=UTF-8</code>`
    to <var>Content-Type</var>.

    <p>Set <span>request body</span> to <var>body</var>,
    <span data-anolis-spec=domps title=concept-serialize>serialized</span> with the
    <i title>require well-formed flag</i> set,
    <span data-anolis-spec=webidl title="convert a DOMString to a sequence of Unicode characters">converted to Unicode</span>,
    and <span data-anolis-spec=encoding title="utf-8 encode">utf-8 encoded</span>.
    Rethrow any exceptions.

    <p class=note>If <var>body</var> cannot be
    <span data-anolis-spec=domps title=concept-serialize>serialized</span>, an
    <code>InvalidStateError</code> exception is thrown.

   <dt id=dom-xmlhttprequest-send-bodyinit><code data-anolis-spec=fetch>BodyInit</code>
   <dd>
    <p>If <var>body</var> is a string, set <var>encoding</var> to
    `<code title>UTF-8</code>`.

    <p>Set <span>request body</span> and <var>Content-Type</var> to the result of
    <span data-anolis-spec=fetch title=concept-BodyInit-extract>extracting</span>
    <var>body</var>.
  </dl>

  <p>If <var>Content-Type</var> is non-null and <span>author request headers</span>
  contains no <span data-anolis-spec=fetch title=concept-header>header</span>
  <span data-anolis-spec=fetch title=concept-header-name>named</span>
  `<code>Content-Type</code>`,
  <span data-anolis-spec=fetch title=concept-header-list-append>append</span>
  `<code>Content-Type</code>`/<var title>Content-Type</var> to
  <span>author request headers</span>.

  <p>Otherwise, if the <span data-anolis-spec=fetch title=concept-header>header</span>
  <span data-anolis-spec=fetch title=concept-header-name>named</span>
  `<code>Content-Type</code>` in <span>author request headers</span> has a
  <span data-anolis-spec=fetch title=concept-header-value>value</span> that is a
  <span data-anolis-spec=html>valid MIME type</span>, which has a
  `<code>charset</code>` parameter whose value is not a case-insensitive
  match for <var title>encoding</var>, and <var title>encoding</var>
  is not null, set all the `<code>charset</code>` parameters of that
  `<code>Content-Type</code>`
  <span data-anolis-spec=fetch title=concept-header>header</span>'s
  <span data-anolis-spec=fetch title=concept-header-value>value</span> to
  <var title>encoding</var>.
  <!-- XXX could still be better with case-insensitive and parameter cross-ref -->

  <!-- reminder: if we ever change this to always include charset it has
  to be included as the first parameter for compatibility reasons -->

 <li>
  <p>Let <var title>req</var> be a new
  <span data-anolis-spec=fetch title=concept-request>request</span>, initialized as
  follows:

  <dl>
   <dt><span data-anolis-spec=fetch title=concept-request-method>method</span>
   <dd><span>request method</span>
   <dt><span data-anolis-spec=fetch title=concept-request-url>url</span>
   <dd><span>request URL</span>
   <dt><span data-anolis-spec=fetch title=concept-request-header-list>header list</span>
   <dd><span>author request headers</span>
   <dt><span data-anolis-spec=fetch>unsafe request flag</span>
   <dd>Set.
   <dt><span data-anolis-spec=fetch title=concept-request-origin>origin</span>
   <dd><span title=concept-XMLHttpRequest-settings-object>settings object</span>'s
   <span data-anolis-spec=html>origin</span>
   <dt><span data-anolis-spec=fetch>force <code title>Origin</code> header flag</span>
   <dd>Set.
   <dt><span data-anolis-spec=fetch title=concept-request-referrer>referrer</span>
   <dd><span title=concept-XMLHttpRequest-settings-object>settings object</span>'s
   <span data-anolis-spec=html>referrer source</span>'s
   <span data-anolis-spec=dom title=concept-document-url>URL</span> if
   <span title=concept-XMLHttpRequest-settings-object>settings object</span>'s
   <span data-anolis-spec=html>referrer source</span> is a
   <span data-anolis-spec=dom title=concept-document>document</span>, and
   <span title=concept-XMLHttpRequest-settings-object>settings object</span>'s
   <span data-anolis-spec=html>referrer source</span> otherwise
   <dt><span data-anolis-spec=fetch title=concept-request-body>body</span>
   <dd><span>request body</span>
   <dt><span data-anolis-spec=fetch title=concept-request-client>client</span>
   <dd><span title=concept-XMLHttpRequest-settings-object>settings object</span>'s
   <span data-anolis-spec=html>global object</span>
   <dt><span data-anolis-spec=fetch title=concept-request-context>context</span>
   <dd><i title>xmlhttprequest</i>
   <dt><span data-anolis-spec=fetch>authentication flag</span>
   <dd>Set.
   <dt><span data-anolis-spec=fetch>synchronous flag</span>
   <dd>Set if the <span>synchronous flag</span> is set.
   <dt><span data-anolis-spec=fetch title=concept-request-mode>mode</span>
   <dd><i title>CORS-with-forced-preflight</i> if one or more event listeners are
   registered on the associated <code>XMLHttpRequestUpload</code> object and
   <i title>CORS</i> otherwise.
   <dt><span data-anolis-spec=fetch title=concept-request-credentials-mode>credentials mode</span>
   <dd>If the <code title=dom-XMLHttpRequest-withCredentials>withCredentials</code>
   attribute value is true, <i title>include</i>, and <i title>same-origin</i> otherwise.
   <dt><span data-anolis-spec=fetch title=concept-request-use-url-credentials-flag>use URL credentials flag</span>
   <dd>Set if either <span>request URL</span>'s
   <span data-anolis-spec=url title=concept-url-username>username</span>
   is not the empty string or <span>request URL</span>'s
   <span data-anolis-spec=url title=concept-url-password>password</span> is non-null.
  </dl>

 <li><p>If a <span data-anolis-spec=fetch title=concept-header>header</span>
 <span data-anolis-spec=fetch title=concept-header-name>named</span>
 `<code>Accept-Language</code>` is not in <var title>req</var>'s
 <span data-anolis-spec=fetch title=concept-request-header-list>header list</span>,
 <span data-anolis-spec=fetch title=concept-header-list-append>append</span>
 `<code>Accept-Language</code>`/an appropriate
 <span data-anolis-spec=fetch title=concept-header-value>value</span> to it.

 <li><p>If a <span data-anolis-spec=fetch title=concept-header>header</span>
 <span data-anolis-spec=fetch title=concept-header-name>named</span>
 `<code>Accept</code>` is not in <var title>req</var>'s
 <span data-anolis-spec=fetch title=concept-request-header-list>header list</span>,
 <span data-anolis-spec=fetch title=concept-header-list-append>append</span>
 `<code>Accept</code>`/`<code title>*/*</code>` to it.

 <li><p>Unset the <span>upload complete flag</span>.

 <li><p>If <var title>req</var>'s
 <span data-anolis-spec=fetch title=concept-request-body>body</span> is null,
 set the <span>upload complete flag</span>.

 <li><p>Set the <span><code>send()</code> flag</span>.

 <li>
  <p>If the <span>synchronous flag</span> is unset, run these substeps:

  <ol>
   <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-loadstart">loadstart</code> with 0 and 0.

   <li><p>If the <span>upload complete flag</span> is unset,
   <span title=concept-event-fire-progress>fire a progress event</span> named
   <code title="event-xhr-loadstart">loadstart</code> on the
   <code>XMLHttpRequestUpload</code> object with 0 and <var title>req</var>'s
   <span data-anolis-spec=fetch title=concept-request-body>body</span>'s
   <span data-anolis-spec=fetch title=concept-body-length>length</span>.

   <li>
    <p><span data-anolis-spec=fetch title=concept-fetch>Fetch</span> <var title>req</var>.
    Handle the <span data-anolis-spec=html title=concept-task>tasks</span>
    <span data-anolis-spec=html title="queue a task">queued</span> on the
    <span data-anolis-spec=html>networking task source</span> per below.

    <p>Run these subsubsteps <span data-anolis-spec=html>in parallel</span>:

    <ol>
     <li><p>Let <var title>seconds</var> be zero.

     <li>
      <p>Every millisecond, as long as the <span>stop timeout flag</span> is unset,
      <span data-anolis-spec=html>queue a microtask</span> to run these subsubsubsteps:

      <ol>
       <li><p>Increase <var title>seconds</var> by one.

       <li><p>If <var title>seconds</var> is equal or greater than
       the <code title="dom-XMLHttpRequest-timeout">timeout</code> attribute value and
       the <code title="dom-XMLHttpRequest-timeout">timeout</code> attribute value is not
       zero, <span data-anolis-spec=fetch title=concept-fetch-terminate>terminate</span>
       <span data-anolis-spec=fetch title=concept-fetch>fetching</span> with reason
       <i title>timeout</i>.
      </ol>
    </ol>

    <p>To <span data-anolis-spec=fetch>process request body</span> for
    <var title>request</var>, run these subsubsteps:

    <ol>
     <li><p>If not roughly 50ms have passed since these subsubsteps were last invoked,
     terminate these subsubsteps.

     <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
     <code title="event-xhr-progress">progress</code> on the
     <code>XMLHttpRequestUpload</code> object with <var title>request</var>'s
     <span data-anolis-spec=fetch title=concept-request-body>body</span>'s
     <span data-anolis-spec=fetch title=concept-body-transmitted>transmitted</span> and
     <var title>request</var>'s
     <span data-anolis-spec=fetch title=concept-request-body>body</span>'s
     <span data-anolis-spec=fetch title=concept-body-length>length</span>.
     <!-- upload complete flag can never be set here I hope -->
    </ol>

    <p>To <span data-anolis-spec=fetch>process request end-of-file</span> for
    <var title>request</var>, run these subsubsteps:

    <ol>
     <li><p>Set the <span>upload complete flag</span>.

     <li><p>Let <var title>transmitted</var> be <var title>request</var>'s
     <span data-anolis-spec=fetch title=concept-request-body>body</span>'s
     <span data-anolis-spec=fetch title=concept-body-transmitted>transmitted</span>.

     <li><p>Let <var title>length</var> be <var title>request</var>'s
     <span data-anolis-spec=fetch title=concept-request-body>body</span>'s
     <span data-anolis-spec=fetch title=concept-body-length>length</span>.

     <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
     <code title=event-xhr-progress>progress</code> on the
     <code>XMLHttpRequestUpload</code> object with <var title>transmitted</var> and
     <var title>length</var>.

     <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
     <code title="event-xhr-load">load</code> on the
     <code>XMLHttpRequestUpload</code> object with <var title>transmitted</var> and
     <var title>length</var>.

     <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
     <code title="event-xhr-loadend">loadend</code> on the
     <code>XMLHttpRequestUpload</code> object with <var title>transmitted</var> and
     <var title>length</var>.
    </ol>
    <!-- upload complete flag can never be set here I hope -->

    <p>To <span data-anolis-spec=fetch>process response</span> for <var title>response</var>,
    run these subsubsteps:

    <ol>
     <li><p>If the <span>stop timeout flag</span> is unset, set the
     <span>stop timeout flag</span>.

     <li><p>Set <span>response</span> to <var title>response</var>.

     <li><p><span>Handle errors</span> for <var title>response</var>.

     <li><p>If <span>response</span> is a
     <span data-anolis-spec=fetch title=concept-network-error>network error</span>,
     return.

     <li><p>Set <span title=concept-XMLHttpRequest-state>state</span> to
     <i title>headers received</i>.

     <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.
    </ol>

    <p>To <span data-anolis-spec=fetch>process response body</span> for
    <var title>response</var>, run these subsubsteps:

    <ol>
     <li><p>If not roughly 50ms have passed since these subsubsteps were last invoked,
     terminate these subsubsteps.

     <li><p><span>Handle errors</span> for <var title>response</var>.

     <li><p>If <span>response</span> is a
     <span data-anolis-spec=fetch title=concept-network-error>network error</span>,
     return.

     <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is
     <i title>headers received</i>, set
     <span title=concept-XMLHttpRequest-state>state</span> to <i title>loading</i> and
     <span data-anolis-spec=dom title=concept-event-fire>fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.

     <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-progress">progress</code> with <var title>response</var>'s
     <span data-anolis-spec=fetch title=concept-response-body>body</span>'s
     <span data-anolis-spec=fetch title=concept-body-transmitted>transmitted</span> and
     <var title>response</var>'s
     <span data-anolis-spec=fetch title=concept-response-body>body</span>'s
     <span data-anolis-spec=fetch title=concept-body-length>length</span>.
    </ol>

    <p>To <span data-anolis-spec=fetch>process response end-of-file</span> for
    <var title>response</var>, run <span>handle response end-of-file</span> for
    <var title>response</var>.
  </ol>

 <li>
  <p>Otherwise, if the <span>synchronous flag</span> is set, run these substeps:

  <ol>
   <li><p>Release the <span data-anolis-spec=html>storage mutex</span>.

   <li>
    <p>Let <var title>response</var> be the result of
    <span data-anolis-spec=fetch title=concept-fetch>fetching</span> <var title>req</var>.

    <p>If the <code title=dom-XMLHttpRequest-timeout>timeout</code> attribute value is not
    zero, <span data-anolis-spec=fetch title=concept-fetch-terminate>terminate</span> this
    <span data-anolis-spec=fetch title=concept-fetch>fetch</span> if it has not returned
    within the amount of milliseconds from the
    <code title=dom-XMLHttpRequest-timeout>timeout</code> attribute value with reason
    <i title>timeout</i>.

   <li><p>Run <span>handle response end-of-file</span> for <var title>response</var>.
  </ol>
</ol>

<p>To <dfn>handle response end-of-file</dfn> for <var title>response</var>, run these
steps:

<ol>
 <li><p>If the <span>synchronous flag</span> is set, set <span>response</span> to
 <var title>response</var>.

 <li><p><span>Handle errors</span> for <var title>response</var>.

 <li><p>If <span>response</span> is a
 <span data-anolis-spec=fetch title=concept-network-error>network error</span>, return.

 <li><p>If the <span>synchronous flag</span> is unset, update <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span> using
 <var title>response</var>.

 <li><p>Set <span title=concept-XMLHttpRequest-state>state</span> to <i title>done</i>.

 <li><p>Unset the <span><code>send()</code> flag</span>.

 <li><p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.

 <li><p>Let <var title>transmitted</var> be <var title>response</var>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span>'s
 <span data-anolis-spec=fetch title=concept-body-transmitted>transmitted</span>.

 <li><p>Let <var title>length</var> be <var title>response</var>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span>'s
 <span data-anolis-spec=fetch title=concept-body-length>length</span>.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title=event-xhr-progress>progress</code>
 with <var title>transmitted</var> and <var title>length</var>.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-load">load</code>
 with <var title>transmitted</var> and <var title>length</var>.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named <code title="event-xhr-loadend">loadend</code>
 with <var title>transmitted</var> and <var title>length</var>.
</ol>

<p>To <dfn>handle errors</dfn> for <var title>response</var> run these steps:

<ol>
 <li><p>If the <span><code>send()</code> flag</span> is unset, return.

 <li><p>If <var title>response</var> is a
 <span data-anolis-spec=fetch title=concept-network-error>network error</span>, run the
 <span>request error steps</span> for event <code title="event-xhr-error">error</code> and
 exception <code>NetworkError</code>.

 <li>
  <p>Otherwise, if <var title>response</var> has a
  <span data-anolis-spec=fetch title=concept-response-termination-reason>termination reason</span>:

  <dl class=switch>
   <dt><i title>end-user abort</i>
   <dd><p>Run the <span>request error steps</span> for event
   <code title="event-xhr-abort">abort</code> and exception
   <code>AbortError</code>.

   <dt><i title>fatal</i>
   <dd>
    <ol>
     <li><p>Set <span title=concept-XMLHttpRequest-state>state</span> to
     <i title>done</i>.

     <li><p>Unset the <span><code>send()</code> flag</span>.

     <li><p>Set <span>response</span> to a
     <span data-anolis-spec=fetch title=concept-network-error>network error</span>.
    </ol>

   <dt><i title>timeout</i>
   <dd><p>Run the <span>request error steps</span> for event
   <code title="event-xhr-timeout">timeout</code> and exception
   <code>TimeoutError</code>.
  </dl>
</ol>

<p>The <dfn>request error steps</dfn> for event <var title>event</var> and optionally an
exception <var>exception</var> are:

<ol>
 <li><p>Set <span title=concept-XMLHttpRequest-state>state</span> to <i title>done</i>.

 <li><p>Unset the <span><code>send()</code> flag</span>.

 <li><p>Set <span>response</span> to a
 <span data-anolis-spec=fetch title=concept-network-error>network error</span>.

 <li><p>If the <span>synchronous flag</span> is set,
 <span data-anolis-spec=webidl title=throw>throw</span> an <var>exception</var>
 exception.

 <li>
  <p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named <code title=event-xhr-readystatechange>readystatechange</code>.

  <p class=note>At this point it is clear that the <span>synchronous flag</span> is unset.

 <li>
  <p>If the <span>upload complete flag</span> is unset, follow these substeps:

  <ol>
   <li><p>Set the <span>upload complete flag</span>.

   <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
   <code title=event-xhr-progress>progress</code> on the <code>XMLHttpRequestUpload</code>
   object with 0 and 0.

   <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
   <var title>event</var> on the <code>XMLHttpRequestUpload</code> object with 0 and 0.

   <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
   <code title="event-xhr-loadend">loadend</code> on the <code>XMLHttpRequestUpload</code>
   object with 0 and 0.
  </ol>

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
 <code title=event-xhr-progress>progress</code> with 0 and 0.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
 <var title>event</var> with 0 and 0.

 <li><p><span title=concept-event-fire-progress>Fire a progress event</span> named
 <code title="event-xhr-loadend">loadend</code> with 0 and 0.
</ol>


<h4>The <code title>abort()</code> method</h4>

  <dl class=domintro>
   <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-abort>abort</span>()</code>
   <dd>Cancels any network activity.
  </dl>

<p>The <dfn title="dom-XMLHttpRequest-abort"><code>abort()</code></dfn> method must run
these steps:

<ol>
 <li><p><span>Terminate the request</span>.

 <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is either
 <i title>opened</i> with the <span><code>send()</code> flag</span> set,
 <i title>headers received</i>, or <i title>loading</i>, run the
 <span>request error steps</span> for event <code title=event-xhr-abort>abort</code>.

 <li>
  <p>Set <span title=concept-XMLHttpRequest-state>state</span> to <i title>unsent</i>.

  <p class=note>No <code title="event-xhr-readystatechange">readystatechange</code> event
  is dispatched.
</ol>



<h3 id=xmlhttprequest-response>Response</h3>

<p>An <code>XMLHttpRequest</code> has an associated <dfn>response</dfn>. Unless stated
otherwise it is a
<span data-anolis-spec=fetch title=concept-network-error>network error</span>.


<h4>The <code title>responseURL</code> attribute</h4>

<p>The <dfn title=dom-XMLHttpRequest-responseURL><code>responseURL</code></dfn> attribute
must return the empty string if <span>response</span>'s
<span data-anolis-spec=fetch title=concept-response-url>url</span> is null and its
<span data-anolis-spec=url title=concept-url-serializer>serialization</span> with the
<i title>exclude fragment flag</i> set otherwise.


<h4>The <code title>status</code> attribute</h4>

<p>The
<dfn title="dom-XMLHttpRequest-status"><code>status</code></dfn>
attribute must return the <span>response</span>'s
<span data-anolis-spec=fetch title=concept-response-status>status</span>.


<h4>The <code title>statusText</code> attribute</h4>

<p>The
<dfn title="dom-XMLHttpRequest-statusText"><code>statusText</code></dfn>
attribute must return the <span>response</span>'s
<span data-anolis-spec=fetch title=concept-response-status-message>status message</span>.


<h4>The <code title>getResponseHeader()</code> method</h4>

<p>The
<dfn title="dom-XMLHttpRequest-getResponseHeader"><code>getResponseHeader(<var>name</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-header-list>header list</span> has
 multiple <span data-anolis-spec=fetch title=concept-header>headers</span> whose
 <span data-anolis-spec=fetch title=concept-header-name>name</span> is <var>name</var>,
 return their <span data-anolis-spec=fetch title=concept-header-value>values</span> in
 list order as a single byte sequence separated from each other by a 0x2C 0x20 byte pair.

 <li><p>If <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-header-list>header list</span> has
 one <span data-anolis-spec=fetch title=concept-header>header</span> whose
 <span data-anolis-spec=fetch title=concept-header-name>name</span> is <var>name</var>,
 return its <span data-anolis-spec=fetch title=concept-header-value>value</span>.

 <li><p>Return null.
</ol>

<p class="note no-backref">The Fetch Standard filters <span>response</span>'s
<span data-anolis-spec=fetch title=concept-response-header-list>header list</span>.
<span data-anolis-ref>FETCH</span>

<div class="example">

 <p>For the following script:

 <pre><code>var client = new XMLHttpRequest();
client.open("GET", "unicorns-are-teh-awesome.txt", true);
client.send();
client.onreadystatechange = function() {
  if(this.readyState == this.HEADERS_RECEIVED) {
    print(client.getResponseHeader("Content-Type"));
  }
}</code></pre>

 <p>The <code>print()</code> function will get to process something
 like:

 <pre><code>text/plain; charset=UTF-8</code></pre>
</div>


<h4>The <code title>getAllResponseHeaders()</code> method</h4>

<p>The
<dfn title="dom-XMLHttpRequest-getAllResponseHeaders"><code>getAllResponseHeaders()</code></dfn>
method must return <span>response</span>'s
<span data-anolis-spec=fetch title=concept-response-header-list>header list</span>, in
list order, as a single byte sequence with each
<span data-anolis-spec=fetch title=concept-header>header</span> separated by a 0x0D 0x0A
byte pair, and each <span data-anolis-spec=fetch title=concept-header-name>name</span> and
<span data-anolis-spec=fetch title=concept-header-value>value</span> of a
<span data-anolis-spec=fetch title=concept-header>header</span> separated by a 0x3A 0x20
byte pair.

<p class="note no-backref">The Fetch Standard filters <span>response</span>'s
<span data-anolis-spec=fetch title=concept-response-header-list>header list</span>.
<span data-anolis-ref>FETCH</span>

<div class="example">
 <p>For the following script:

 <pre><code>var client = new XMLHttpRequest();
client.open("GET", "narwhals-too.txt", true);
client.send();
client.onreadystatechange = function() {
  if(this.readyState == this.HEADERS_RECEIVED) {
    print(this.getAllResponseHeaders());
  }
}</code></pre>

 <p>The <code>print()</code> function will get to process something
 like:

 <pre><code>Date: Sun, 24 Oct 2004 04:58:38 GMT
Server: Apache/1.3.31 (Unix)
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/plain; charset=utf-8</code></pre>
</div>


<h4>Response body</h4>

<p>The <dfn id="response-mime-type">response MIME type</dfn> is the
MIME type the `<code title>Content-Type</code>` header contains excluding any
parameters and
<span data-anolis-spec=dom>converted to ASCII lowercase</span>, or null if
the response header can not be parsed or was omitted. The
<dfn id="override-mime-type">override MIME type</dfn> is initially null
and can get a value if
<code title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType()</code>
is invoked. <dfn id="final-mime-type">Final MIME type</dfn> is the
<span>override MIME type</span> unless that is null in which case it is
the <span>response MIME type</span>.

<p>The <dfn id="response-charset">response charset</dfn> is the value of
the <code>charset</code> parameter of the `<code title>Content-Type</code>` header
or null if there was no `<code title>charset</code>` parameter or the header could
not be parsed or was omitted. The
<dfn id="override-charset">override charset</dfn> is initially null and
can get a value if <code title="dom-XMLHttpRequest-overrideMimeType">overrideMimeType()</code> is invoked.
<dfn id="final-charset">Final charset</dfn> is the
<span>override charset</span> unless
that is null in which case it is the <span>response charset</span>.

<hr>

<p>An <code>XMLHttpRequest</code> object has an associated
<dfn>response <code>ArrayBuffer</code> object</dfn>,
<dfn>response <code>Blob</code> object</dfn>,
<dfn>response <code>Document</code> object</dfn>, and a
<dfn>response JSON object</dfn>. Their shared initial value is null.


<p>An <dfn>arraybuffer response</dfn> is the return value of these steps:

<ol>
 <li><p>If <span>response <code>ArrayBuffer</code> object</span> is non-null, return it.

 <li><p>Let <var>bytes</var> be the empty byte sequence, if <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span> is null, and
 <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span> otherwise.

 <li><p>Set <span>response <code>ArrayBuffer</code> object</span> to a new
 <code>ArrayBuffer</code> object representing <var>bytes</var> and return it.
</ol>


<p>A <dfn>blob response</dfn> is the return value of these steps:

<ol>
 <li><p>If <span>response <code>Blob</code> object</span> is non-null, return it.

 <li><p>Let <var title>type</var> be the empty string, if <span>final MIME type</span> is
 null, and <span>final MIME type</span> otherwise.

 <li><p>Let <var>bytes</var> be the empty byte sequence, if <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span> is null, and
 <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span> otherwise.

 <li><p>Set <span>response <code>Blob</code> object</span> to a new
 <code data-anolis-spec=fileapi>Blob</code> object representing <var>bytes</var> with
 <code data-anolis-spec=fileapi title=dom-Blob-type>type</code> <var title>type</var> and
 return it.
</ol>


<p>A <dfn>document response</dfn> is the return value of these steps:

<ol>
 <li><p>If <span>response <code>Document</code> object</span> is non-null, return it.

 <li><p>Let <var>bytes</var> be <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span>.

 <li><p>If <var>bytes</var> is null, return null.

 <li><p>If <span>final MIME type</span> is not null,
 <code>text/html</code>, <code>text/xml</code>,
 <code>application/xml</code>, or does not end in
 <code title>+xml</code>, return null.

 <li>
  <p>If <code title=dom-XMLHttpRequest-responseType>responseType</code> is
  the empty string and <span>final MIME type</span> is
  <code>text/html</code>, return null.

  <p class=note>This is restricted to
  <code title=dom-XMLHttpRequest-responseType>responseType</code> being
  "<code title>document</code>" in order to prevent breaking legacy
  content.

 <li>
  <p>If <span>final MIME type</span> is <code>text/html</code>, run these
  substeps:

  <ol>
   <li><p>Let <var>charset</var> be the <span>final charset</span>.

   <li><p>If <var>charset</var> is null,
   <span data-anolis-spec=html title="prescan a byte stream to determine its encoding">prescan</span>
   the first 1024 bytes of <var>bytes</var> and if
   that does not terminate unsuccessfully then let <var>charset</var> be
   the return value.

   <li><p>If <var>charset</var> is null, set <var>charset</var> to
   <span data-anolis-spec=encoding>utf-8</span>.

   <li><p>Let <var title>document</var> be a
   <span data-anolis-spec=dom title=concept-document>document</span> that
   represents the result parsing <var>bytes</var> following the rules set
   forth in the HTML Standard for an HTML parser with scripting disabled and
   <span data-anolis-spec=html>a known definite encoding</span> <var>charset</var>.
   <span data-anolis-ref>HTML</span>

   <li><p>Flag <var title>document</var> as an
   <span data-anolis-spec=dom>HTML document</span>.
  </ol>

 <li>
  <p>Otherwise, let <var title>document</var> be a
  <span data-anolis-spec=dom title=concept-document>document</span>
  that represents the result of running the <span data-anolis-spec=html>XML parser</span>
  with <span data-anolis-spec=html>XML scripting support disabled</span> on
  <var>bytes</var>. If that fails (unsupported character encoding,
  namespace well-formedness error, etc.), return null.
  <span data-anolis-ref>HTML</span>

  <p class=note>Resources referenced will not be loaded and no associated XSLT will be
  applied. <!-- XXX more formally?! -->

 <li><p>If <var>charset</var> is null, set <var>charset</var> to
 <span data-anolis-spec=encoding>utf-8</span>.
 <!-- can only happen in the XML case -->

 <li><p>Set <var title>document</var>'s
 <span data-anolis-spec=dom title=concept-document-encoding>encoding</span> to
 <var>charset</var>.

 <li><p>Set <var title>document</var>'s
 <span data-anolis-spec=dom title=concept-document-content-type>content type</span>
 to <span>final MIME type</span>.

 <li><p>Set <var title>document</var>'s
 <span data-anolis-spec=dom title=concept-document-url>URL</span> to
 <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-url>url</span>.

 <li><p>Set <var title>document</var>'s <span data-anolis-spec=html>origin</span> to
 <span title=concept-XMLHttpRequest-settings-object>settings object</span>'s
 <span data-anolis-spec=html>origin</span>.

 <li><p>Set <span>response <code>Document</code> object</span> to
 <var title>document</var> and return it.
</ol>


<p>A <dfn>JSON response</dfn> is the return value of these steps:

<ol>
 <li><p>If <span>response JSON object</span> is non-null, return it.

 <li><p>Let <var>bytes</var> be <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span>.

 <li><p>If <var>bytes</var> is null, return null.

 <li><p>Let <var>JSON text</var> be the result of running
 <span data-anolis-spec=encoding>utf-8 decode</span> on byte stream <var>bytes</var>.

 <li><p>Let <var>JSON object</var> be the result of invoking the initial value of the
 <code title>parse</code> property of the <code title>JSON</code> object, with
 <var>JSON text</var> as its only argument. If that threw an exception, return null.
 <span data-anolis-ref>ECMASCRIPT</span>

 <li><p>Set <span>response JSON object</span> to <var>JSON object</var> and return it.
</ol>


<p>A <dfn>text response</dfn> is the return value of these steps:

<ol>
 <li><p>Let <var>bytes</var> be <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span>.

 <li><p>If <var>bytes</var> is null, return the empty string.

 <li><p>Let <var>charset</var> be the <span>final charset</span>.

 <li>
  <p>If <code title=dom-XMLHttpRequest-responseType>responseType</code> is
  the empty string, <var>charset</var> is null, and
  <span>final MIME type</span> is either null, <code>text/xml</code>,
  <code>application/xml</code> or ends in <code title>+xml</code>, use the
  rules set forth in the XML specifications to determine the encoding. Let
  <var>charset</var> be the determined encoding.
  <span data-anolis-ref>XML</span> <span data-anolis-ref>XMLNS</span>

  <p class=note>This is restricted to
  <code title=dom-XMLHttpRequest-responseType>responseType</code> being
  the empty string to keep the non-legacy
  <code title=dom-XMLHttpRequest-responseType>responseType</code> value
  "<code title>text</code>" simple.

 <li><p>If <var>charset</var> is null, set <var>charset</var> to
 <span data-anolis-spec=encoding>utf-8</span>.

 <li><p>Return the result of running
 <span data-anolis-spec=encoding>decode</span> on byte stream
 <var>bytes</var> using fallback encoding
 <var>charset</var>.
</ol>

<p class=note>Authors are strongly encouraged to always encode their
resources using <span data-anolis-spec=encoding>utf-8</span>.



<h4>The <code title>overrideMimeType()</code> method</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-overrideMimeType>overrideMimeType</span>(<var title>mime</var>)</code>
 <dd>
  <p>Sets the `<code title>Content-Type</code>` header for <span>response</span> to
  <var title>mime</var>.

  <p>Throws an <code>InvalidStateError</code> exception if
  <span title=concept-XMLHttpRequest-state>state</span> is
  <i title>loading</i> or <i title>done</i>.

  <p>Throws a <code>SyntaxError</code> exception if
  <var title>mime</var> is not a valid MIME type.
 </dd>
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-overrideMimeType"><code>overrideMimeType(<var title>mime</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is
 <i title>loading</i> or <i title>done</i>,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li><p>If parsing <var title>mime</var> analogously to the value of
 the `<code title>Content-Type</code>` header fails,
 <span data-anolis-spec=webidl title=throw>throw</span> a
 <code>SyntaxError</code> exception.

 <li><p>If <var title>mime</var> is successfully parsed, set
 <span>override MIME type</span> to its MIME type,
 excluding any parameters, and
 <span data-anolis-spec=dom>converted to ASCII lowercase</span>.

 <li><p>If a `<code title>charset</code>` parameter is successfully parsed, set
 <span>override charset</span> to its value.
</ol>



<h4>The <code title>responseType</code> attribute</h4>


<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-responseType>responseType</code> [ = <var>value</var> ]</code>
 <dd>
  <p>Returns the response type.
  <p>Can be set to change the response type. Values are:
  the empty string (default),
  "<code title>arraybuffer</code>",
  "<code title>blob</code>",
  "<code title>document</code>",
  "<code title>json</code>", and
  "<code title>text</code>".
  <p>When set: setting to "<code title>document</code>" is ignored if the
  <span data-anolis-spec=html>JavaScript global environment</span> is a
  <span data-anolis-spec=html>worker environment</span>
  <p>When set: throws an
  <code>InvalidStateError</code> exception if
  <span title=concept-XMLHttpRequest-state>state</span> is <i title>loading</i> or
  <i title>done</i>.
  <p>When set: throws an
  <code>InvalidAccessError</code> exception if the
  <span>synchronous flag</span> is set and the
  <span data-anolis-spec=html>JavaScript global environment</span> is a
  <span data-anolis-spec=html>document environment</span>.
</dl>


<p>The
<dfn title="dom-XMLHttpRequest-responseType"><code>responseType</code></dfn>
attribute must return its value. Initially its value must be the empty
string.

<p>Setting the
<code title="dom-XMLHttpRequest-responseType">responseType</code>
attribute must run these steps:

<ol>
 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>worker environment</span> and the given
 value is "<code title>document</code>", terminate these steps.

 <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is
 <i title>loading</i> or <i title>done</i>,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li><p>If the
 <span data-anolis-spec=html>JavaScript global environment</span> is a
 <span data-anolis-spec=html>document environment</span> and the
 <span>synchronous flag</span> is set,
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidAccessError</code> exception.

 <li><p>Set the
 <code title="dom-XMLHttpRequest-responseType">responseType</code>
 attribute's value to the given value.
</ol>




<h4>The <code title>response</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-response>response</span></code>
 <dd><p>Returns the <span>response</span>'s
 <span data-anolis-spec=fetch title=concept-response-body>body</span>.
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-response"><code>response</code></dfn>
attribute must return the result of running these
steps:

<dl class=switch>
 <dt>If <code title="dom-XMLHttpRequest-responseType">responseType</code>
 is the empty string or "<code title>text</code>"</dt>
 <dd>
  <ol>
   <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is not
   <i title>loading</i> or <i title>done</i>, return the empty string.

   <li><p>Return the <span>text response</span>.
  </ol>

 <dt>Otherwise</dt>
 <dd>
  <ol>
   <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is not
   <i title>done</i>, return null.

   <li>
    <dl class=switch>
     <dt>If
     <code title="dom-XMLHttpRequest-responseType">responseType</code> is
     "<code title>arraybuffer</code>"</dt>
     <dd><p>Return the <span>arraybuffer response</span>.

     <dt>If
     <code title="dom-XMLHttpRequest-responseType">responseType</code> is
     "<code title>blob</code>"</dt>
     <dd><p>Return the <span>blob response</span>.

     <dt>If
     <code title="dom-XMLHttpRequest-responseType">responseType</code> is
     "<code title>document</code>"</dt>
     <dd><p>Return the <span>document response</span>.

     <dt>If
     <code title="dom-XMLHttpRequest-responseType">responseType</code> is
     "<code title>json</code>"</dt>
     <dd><p>Return the <span>JSON response</span>.
    </dl>
  </ol>
</dl>



<h4>The <code title>responseText</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title="dom-XMLHttpRequest-responseText">responseText</span></code>
 <dd>
  <p>Returns the <span>text response</span>.

  <p>Throws an <code>InvalidStateError</code>
  exception if
  <code title="dom-XMLHttpRequest-responseType">responseType</code> is not
  the empty string or "<code title>text</code>".
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-responseText"><code>responseText</code></dfn>
attribute must return the result of running these
steps:

<ol>

 <li><p>If <code title="dom-XMLHttpRequest-responseType">responseType</code> is not the
 empty string or "<code title>text</code>",
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.


 <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is not
 <i title>loading</i> or <i title>done</i>, return the empty string.

 <li><p>Return the <span>text response</span>.
</ol>


<h4>The <code title>responseXML</code> attribute</h4>

<dl class=domintro>
 <dt><code><var title>client</var> . <span title=dom-XMLHttpRequest-responseXML>responseXML</span></code>
 <dd>
  <p>Returns the <span>document response</span>.

  <p>Throws an <code>InvalidStateError</code>
  exception if
  <code title="dom-XMLHttpRequest-responseType">responseType</code> is not
  the empty string or "<code title>document</code>".
</dl>

<p>The
<dfn title="dom-XMLHttpRequest-responseXML"><code>responseXML</code></dfn>
attribute must return the result of running these steps:

<ol>
 <li><p>If
 <code title="dom-XMLHttpRequest-responseType">responseType</code> is not
 the empty string or "<code title>document</code>",
 <span data-anolis-spec=webidl title=throw>throw</span> an
 <code>InvalidStateError</code> exception.

 <li><p>If <span title=concept-XMLHttpRequest-state>state</span> is not <i title>done</i>,
 return null.

 <li><p>Return the <span>document response</span>.
</ol>

<p class=note>The
<code title="dom-XMLHttpRequest-responseXML">responseXML</code> attribute
has XML in its name for historical reasons. It also returns HTML resources
as <span data-anolis-spec=dom title=concept-document>documents</span>.


<h3 id="events">Events summary</h3>

<p><em>This section is non-normative.</em>

<p>The following events are dispatched on <code>XMLHttpRequest</code>
and/or <code>XMLHttpRequestUpload</code> objects:

<table>
 <thead>
  <tr>
   <th>Event name</th>
   <th>Interface</th>
   <th>Dispatched when&hellip;</th>
 <tbody>
  <tr>
   <td><dfn title="event-xhr-readystatechange"><code>readystatechange</code></dfn></td>
   <td><code data-anolis-spec=dom>Event</code></td>
   <td>The <code title="dom-XMLHttpRequest-readyState">readyState</code> attribute changes
   value, except when it changes to <span title=dom-XMLHttpRequest-UNSENT>UNSENT</span>.
  <tr>
   <td><dfn title="event-xhr-loadstart"><code>loadstart</code></dfn></td>
   <td><code>ProgressEvent</code></td>
   <td>The fetch initiates.
  <tr>
   <td><dfn title="event-xhr-progress"><code>progress</code></dfn></td>
   <td><code>ProgressEvent</code></td>
   <td>Transmitting data.
  <tr>
   <td><dfn title="event-xhr-abort"><code>abort</code></dfn></td>
   <td><code>ProgressEvent</code></td>
   <td>When the fetch has been aborted. For instance, by invoking the
   <code title="dom-XMLHttpRequest-abort">abort()</code> method.</td>
  <tr>
   <td><dfn title="event-xhr-error"><code>error</code></dfn></td>
   <td><code>ProgressEvent</code></td>
   <td>The fetch failed.
  <tr>
   <td><dfn title="event-xhr-load"><code>load</code></dfn></td>
   <td><code>ProgressEvent</code></td>
   <td>The fetch succeeded.
  <tr>
   <td><dfn title="event-xhr-timeout"><code>timeout</code></dfn></td>
   <td><code>ProgressEvent</code></td>
   <td>The author specified timeout has passed before the fetch completed.
  <tr>
   <td><dfn title="event-xhr-loadend"><code>loadend</code></dfn></td>
   <td><code>ProgressEvent</code></td>
   <td>The fetch completed (success or failure).
</table>



<h2>Interface <code title>FormData</code></h2>

<pre class="idl">typedef (<span data-anolis-spec=fileapi>File</span> or USVString) <dfn>FormDataEntryValue</dfn>;

[<span title="dom-FormData">Constructor</span>(optional <span data-anolis-spec=html>HTMLFormElement</span> <var>form</var>),
 Exposed=(Window,Worker)]
interface <dfn>FormData</dfn> {
  void <span title="dom-FormData-append">append</span>(USVString <var>name</var>, <span data-anolis-spec=fileapi>Blob</span> <var>value</var>, optional USVString <var>filename</var>);
  void <span title="dom-FormData-append">append</span>(USVString <var>name</var>, USVString <var>value</var>);
  void <span title=dom-FormData-delete>delete</span>(USVString <var>name</var>);
  <span>FormDataEntryValue</span>? <span title=dom-FormData-get>get</span>(USVString <var>name</var>);
  sequence&lt;<span>FormDataEntryValue</span>> <span title=dom-FormData-getAll>getAll</span>(USVString <var>name</var>);
  boolean <span title=dom-FormData-has>has</span>(USVString <var>name</var>);
  void <span title=dom-FormData-append>set</span>(USVString <var>name</var>, <span data-anolis-spec=fileapi>Blob</span> <var>value</var>, optional USVString <var>filename</var>);
  void <span title=dom-FormData-set>set</span>(USVString <var>name</var>, USVString <var>value</var>);
  iterable&lt;USVString, <span>FormDataEntryValue</span>>;
};</pre>

<p>The <code>FormData</code> object represents an ordered list of
<dfn title=concept-FormData-entry>entries</dfn>. Each
<span title=concept-FormData-entry>entry</span> consists of a
<dfn title=concept-FormData-entry-name>name</dfn> and a
<dfn title=concept-FormData-entry-value>value</dfn>.

<p>For the purposes of interaction with other algorithms, an
<span title=concept-FormData-entry>entry</span>'s type is "string" if
<span title=concept-FormData-entry-value>value</span> is a string and "file" otherwise. If
an <span title=concept-FormData-entry>entry</span>'s type is "file", its filename is the
value of <span title=concept-FormData-entry>entry</span>'s
<span title=concept-FormData-entry-value>value</span>'s
<code data-anolis-spec=fileapi title=dom-File-name>name</code> attribute.

<p>To <dfn>create an entry</dfn> for <var>name</var>, <var>value</var>, and optionally a
<var>filename</var>, run these steps:

<ol>
 <li><p>Let <var>entry</var> be a new
 <span title=concept-FormData-entry>entry</span>.

 <li><p>Set <var>entry</var>'s <span title=concept-FormData-entry-name>name</span>
 to <var>name</var>.

 <li><p>If <var>value</var> is a <code data-anolis-spec=fileapi>Blob</code> object and not
 a <code data-anolis-spec=fileapi>File</code> object, set <var>value</var> to a new
 <code data-anolis-spec=fileapi>File</code> object, representing the same bytes, whose
 <code data-anolis-spec=fileapi title=dom-File-name>name</code> attribute value is
 "<code title>blob</code>".

 <li><p>If <var>value</var> is a <code data-anolis-spec=fileapi>File</code> object and
 <var title>filename</var> is given, set <var>value</var> to a new
 <code data-anolis-spec=fileapi>File</code> object, representing
 the same bytes, whose <code data-anolis-spec=fileapi title=dom-File-name>name</code>
 attribute value is <var>filename</var>.

 <li><p>Set <var>entry</var>'s <span title=concept-FormData-entry-value>value</span> to
 <var>value</var>.

 <li><p>Return <var>entry</var>.
</ol>


<p>The
<dfn title="dom-FormData"><code>FormData(<var>form</var>)</code></dfn>
constructor must run these steps:

<ol>
 <li><p>Let <var title>fd</var> be a new <code>FormData</code> object.

 <li><p>If <var>form</var> is given, set <var title>fd</var>'s
 <span title=concept-FormData-entry>entries</span> to the result of
 <span data-anolis-spec=html>constructing the form data set</span> for <var>form</var>.

 <li><p>Return <var title>fd</var>.
</ol>

<p>The
<dfn title="dom-FormData-append" id="dom-formdata-append"><code>append(<var>name</var>, <var>value</var>, <var>filename</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var title>entry</var> be the result of <span>create an entry</span> with
 <var>name</var>, <var>value</var>, and <var>filename</var> if given.

 <li><p>Append <var title>entry</var> to <code>FormData</code> object's list of
 <span title=concept-FormData-entry>entries</span>.
</ol>

<p>The
<dfn title=dom-FormData-delete><code>delete(<var>name</var>)</code></dfn>
method must remove all <span title=concept-FormData-entry>entries</span> whose
<span title=concept-FormData-entry-name>name</span> is <var>name</var>.

<p>The
<dfn title=dom-FormData-get><code>get(<var>name</var>)</code></dfn>
method must return the <span title=concept-FormData-entry-value>value</span> of the first
<span title=concept-FormData-entry>entry</span> whose
<span title=concept-FormData-entry-name>name</span> is <var>name</var>, and null
otherwise.

<p>The
<dfn title=dom-FormData-getAll><code>getAll(<var>name</var>)</code></dfn>
method must return the <span title=concept-FormData-entry-value>values</span> of all
<span title=concept-FormData-entry>entries</span> whose
<span title=concept-FormData-entry-name>name</span> is <var>name</var>, in list
order, and the empty sequence otherwise.

<p>The
<dfn title=dom-FormData-set><code>set(<var>name</var>, <var>value</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Let <var>entry</var> be the result of <span>create an entry</span> with
 <var>name</var>, <var>value</var>, and <var>filename</var> if given.

 <li><p>If there are any <span title=concept-FormData-entry>entries</span> whose
 <span title=concept-FormData-entry-name>name</span> is <var>name</var>, replace
 the first such <span title=concept-FormData-entry>entry</span> with <var>entry</var> and
 remove the others.

 <li><p>Otherwise, append <var>entry</var> to <code>FormData</code> object's list of
 <span title=concept-FormData-entry>entries</span>.
</ol>

<p>The <dfn title=dom-FormData-has><code>has(<var>name</var>)</code></dfn> method must
return true if there is an <span title=concept-FormData-entry>entry</span> whose
<span title=concept-FormData-entry-name>name</span> is <var>name</var>, and false
otherwise.

<p>The <span data-anolis-spec=webidl>value pairs to iterate over</span> are the
<span title=concept-FormData-entry>entries</span> with the key being the
<span title=concept-FormData-entry-name>name</span> and the value the
<span title=concept-FormData-entry-value>value</span>.



<h2>Interface <code title>ProgressEvent</code></h2>

<pre class="idl">[<span data-anolis-spec=dom title=concept-event-constructor>Constructor</span>(DOMString <var title>type</var>, optional <span>ProgressEventInit</span> <var title>eventInitDict</var>),
 Exposed=(Window,Worker)]
interface <dfn>ProgressEvent</dfn> : <span data-anolis-spec=dom>Event</span> {
  readonly attribute boolean <span title="dom-ProgressEvent-lengthComputable">lengthComputable</span>;
  readonly attribute unsigned long long <span title="dom-ProgressEvent-loaded">loaded</span>;
  readonly attribute unsigned long long <span title="dom-ProgressEvent-total">total</span>;
};

dictionary <dfn>ProgressEventInit</dfn> : <span data-anolis-spec=dom>EventInit</span> {
  boolean <span title="dom-ProgressEventInit-lengthComputable">lengthComputable</span> = false;
  unsigned long long <span title="dom-ProgressEventInit-loaded">loaded</span> = 0;
  unsigned long long <span title="dom-ProgressEventInit-total">total</span> = 0;
};</pre>

<p><span data-anolis-spec=dom title=concept-event>Events</span> using
the <code>ProgressEvent</code> interface indicate some kind of
progression.

<p>The
<dfn id="dom-progressevent-lengthcomputable" title="dom-ProgressEvent-lengthComputable"><code>lengthComputable</code></dfn>,
<dfn id="dom-progressevent-loaded" title="dom-ProgressEvent-loaded"><code>loaded</code></dfn>, and
<dfn id="dom-progressevent-total" title="dom-ProgressEvent-total"><code>total</code></dfn>
attributes must return the value they were initialized to.


<h3>Firing events using the <code title>ProgressEvent</code> interface</h3>

<p>To
<dfn title=concept-event-fire-progress>fire an progress event named <var>e</var></dfn>
given <var title>transmitted</var> and <var title>length</var>,
<span data-anolis-spec=dom title=concept-event-fire>fire an event named <var>e</var></span>
with an <span data-anolis-spec=dom title=concept-event>event</span>
using the <code>ProgressEvent</code> interface that also meets these
conditions:

<ul class=brief>
 <li><p>Set the <code title=dom-ProgressEvent-loaded>loaded</code> attribute value to
 <var title>transmitted</var>.

 <li><p>If <var title>length</var> is not 0, set the
 <code title=dom-ProgressEvent-lengthComputable>lengthComputable</code> attribute value to
 true and the <code title=dom-ProgressEvent-total>total</code> attribute value to
 <var title>length</var>.
</ul>


<h3>Suggested names for events using the <code title>ProgressEvent</code> interface</h3>

<p><em>This section is non-normative.</em>

<p>The suggested <code data-anolis-spec=dom title=dom-Event-type>type</code>
attribute values for use with
<span data-anolis-spec=dom title=concept-event>events</span> using the
<code>ProgressEvent</code> interface are summarized in the table below.
Specification editors are free to tune the details to their specific
scenarios, though are strongly encouraged to discuss their usage with the
WHATWG community to ensure input from people familiar with the subject.

<table>
 <tbody>
  <tr>
   <th><code data-anolis-spec=dom title=dom-Event-type>type</code> attribute value
   <th>Description
   <th>Times
   <th>When
  <tr>
   <th><code title>loadstart</code>
   <td>Progress has begun.
   <td>Once.
   <td>First.
  <tr>
   <th><code title>progress</code>
   <td>In progress.
   <td>Once or more.
   <td>After <code title>loadstart</code> has been
    <span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>.
  <tr>
   <th><code title>error</code>
   <td>Progression failed.
   <td rowspan=4>Zero or once (mutually exclusive).
   <td rowspan=4>After the last <code title>progress</code> has
    been
    <span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>.
  <tr>
   <th><code>abort</code>
   <td>Progression is terminated.
  <tr>
   <th><code title>timeout</code>
   <td>Progression is terminated due to preset time expiring.
  <tr>
   <th><code>load</code>
   <td>Progression is successful.
  <tr>
   <th><code title>loadend</code>
   <td>Progress has stopped.
   <td>Once.</td>
   <td>After one of <code title>error</code>, <code title>abort</code>,
    <code title>timeout</code> or <code title>load</code> has been
    <span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>.
</table>

<p>The <code title>error</code>, <code title>abort</code>, <code title>timeout</code>, and
<code title>load</code> event types are mutually exclusive.

<p>Throughout the web platform the <code title>error</code>, <code title>abort</code>,
<code title>timeout</code> and <code title>load</code> event types have
their <code data-anolis-spec=dom title=dom-Event-bubbles>bubbles</code> and
<code data-anolis-spec=dom title=dom-Event-cancelable>cancelable</code>
attributes initialized to false, so it is suggested that for consistency all
<span data-anolis-spec=dom title=concept-event>events</span> using the
<code>ProgressEvent</code> interface do the same.


<h3>Security Considerations</h3>

<p>For cross-origin requests some kind of opt-in, e.g. the
<span data-anolis-spec=fetch>CORS protocol</span> defined in the Fetch Standard, has to be
used before <span data-anolis-spec=dom title=concept-event>events</span> using the
<code>ProgressEvent</code> interface are
<span data-anolis-spec=dom title=concept-event-dispatch>dispatched</span>
as information (e.g. size) would be revealed that cannot be obtained
otherwise. <span data-anolis-ref class=informative>FETCH</span>


<h3>Example</h3>

<div class="example">
 <p>In this example <code>XMLHttpRequest</code>, combined with concepts
 defined in the sections before, and the HTML
 <code data-anolis-spec=html>progress</code> element are used together to
 display the process of
 <span data-anolis-spec=fetch title=concept-fetch>fetching</span> a resource.

 <pre>&lt;!DOCTYPE html>
&lt;title>Waiting for Magical Unicorns&lt;/title>
&lt;progress id=p>&lt;/progress>
&lt;script>
  var progressBar = document.getElementById("p"),
      client = new XMLHttpRequest()
  client.open("GET", "magical-unicorns")
  client.onprogress = function(pe) {
    if(pe.lengthComputable) {
      progressBar.max = pe.total
      progressBar.value = pe.loaded
    }
  }
  client.onloadend = function(pe) {
    progressBar.value = pe.loaded
  }
  client.send()
&lt;/script></pre>

 <p>Fully working code would of course be more elaborate and deal with more
 scenarios, such as network errors or the end user terminating the request.
</div>



<h2 class=no-num>References</h2>
<div id=anolis-references></div>



<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

<p>Thanks to
Addison Phillips,
Adrian Bateman,
Ahmed Kamel,
Alan Thomas,
Alex Hopmann,
Alex Vincent,
Alexey Proskuryakov,
Andrea Marchesini,
Asbj&oslash;rn Ulsberg,
Boris Zbarsky,
Bj&ouml;rn H&ouml;hrmann,
Caitlin Potter,
Cameron McCormack,
Chris Marrin,
Christophe Jolif,
Charles McCathieNevile,
Dan Winship,
David Andersson,
David Flanagan,
David H&aring;s&auml;ther,
David Levin,
Dean Jackson,
Denis Sureau,
Dominik Röttsches,
Doug Schepers,
Douglas Livingstone,
Elliott Sprehn,
Elliotte Harold,
Eric Lawrence,
Eric Uhrhane,
Erik Arvidsson,
Erik Dahlstr&ouml;m,
Feras Moussa,
Geoffrey Sneddon,
Gideon Cohn,
Glenn Adams,
Gorm Haug Eriksen,
H&aring;kon Wium Lie,
Hallvord R. M. Steen,
Henri Sivonen,
Huub Schaeks,
Ian Davis,
Ian Hickson,
Ivan Herman,
Jared Jacobs,
Jarred Nicholls,
Jeff Walden,
Jens Lindstr&ouml;m,
Jim Deegan,
Jim Ley,
Joe Farro,
Jonas Sicking,
Julian Reschke,
송정기 (Jungkee Song),
呂康豪 (Kang-Hao Lu),
Karl Dubost,
Lachlan Hunt,
Maciej Stachowiak,
Magnus Kristiansen,
Manish Goregaokar,
Marc Hadley,
Marcos Caceres,
Mark Baker,
Mark Birbeck,
Mark Nottingham,
Mark S. Miller,
Martin Hassman,
Mohamed Zergaoui,
Ms2ger,
Odin H&oslash;rthe Omdal,
Olli Pettay,
Pawel Glowacki,
Peter Michaux,
Philip Taylor,
Robin Berjon,
Rune <span title=Fabulous>F.</span> Halvorsen,
Ruud Steltenpool,
Sergiu Dumitriu,
Shivakumar Jagalur Matt,
Sigbj&oslash;rn Finne,
Simon Pieters,
Stewart Brodie,
Sunava Dutta,
Takeshi Yoshino,
Thomas Roessler,
Tom Magliery,
Travis Leithead,
Yehuda Katz, and
Zhenbin Xu
for their contributions to this standard.

<p>Special thanks to the Microsoft employees who first implemented the
<code title>XMLHttpRequest</code> interface, which was first widely deployed by the
Windows Internet Explorer browser.

<p>Special thanks to Ian Hickson for drafting an initial version of this specification in
the HTML Standard (then Web Applications 1.0). <span data-anolis-ref>HTML</span>

<p>Special thanks to the W3C SVG WG for drafting the original
<code>ProgressEvent</code> class as part of the
<a href="http://www.w3.org/TR/2008/REC-SVGTiny12-20081222/svgudom.html">SVG Micro DOM</a>.

<p>This standard is written by
<a lang=nl href=//annevankesteren.nl/>Anne van Kesteren</a>
(<a href=//www.mozilla.org/>Mozilla</a>,
<a href=mailto:annevk@annevk.nl>annevk@annevk.nl</a>).

<p>Per <a rel="license" href="//creativecommons.org/publicdomain/zero/1.0/">CC0</a>, to
the extent possible under law, the editor has waived all copyright and related or
neighboring rights to this work.

<script id=head src=//resources.whatwg.org/dfn.js></script>
